================================================================================
基于SSM框架的网上村委会业务办理系统 - 源代码
================================================================================

--------------------------------------------------------------------------------
文件路径: build.gradle
--------------------------------------------------------------------------------

plugins {
    id 'java'
    id 'war'
}

group = 'com.village'
version = '0.1.0-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(25)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Framework 7.0.2 (NO Spring Boot)
    implementation platform("org.springframework:spring-framework-bom:7.0.2")
    implementation "org.springframework:spring-webmvc"
    implementation "org.springframework:spring-jdbc"
    implementation "org.springframework:spring-tx"

    // MyBatis
    implementation "org.mybatis:mybatis:3.5.19"
    implementation "org.mybatis:mybatis-spring:4.0.0"

    // DataSource / DB driver
    implementation "com.zaxxer:HikariCP:7.0.2"
    runtimeOnly "com.mysql:mysql-connector-j:9.5.0"

    // Jackson 3
    implementation "tools.jackson.core:jackson-databind:3.0.3"

    // JSP + JSTL (Jakarta JSTL 3.0.1) - MUST be packaged into WAR
    implementation "jakarta.servlet.jsp.jstl:jakarta.servlet.jsp.jstl-api:3.0.1"
    implementation "org.glassfish.web:jakarta.servlet.jsp.jstl:3.0.1"

    // Logging
    implementation "org.slf4j:slf4j-api:2.0.16"
    runtimeOnly "org.slf4j:slf4j-simple:2.0.16"

    // Provided by Tomcat 11 (Servlet 6.1 / JSP 4.0 / EL 6.0 / Annotations)
    compileOnly "jakarta.servlet:jakarta.servlet-api:6.1.0"
    compileOnly "jakarta.servlet.jsp:jakarta.servlet.jsp-api:4.0.0"
    compileOnly "jakarta.el:jakarta.el-api:6.0.1"
    compileOnly "jakarta.annotation:jakarta.annotation-api:3.0.0"

    testImplementation "org.junit.jupiter:junit-jupiter:5.11.0"
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = "UTF-8"
    options.release.set(25)

    // ✅ 关键：让 Spring 通过反射能拿到方法参数名（避免 @PathVariable/@RequestParam 报 “Name for argument...not available”）
    options.compilerArgs.add("-parameters")
}

test {
    useJUnitPlatform()
}

war {
    archiveFileName = "YXK.war"
}



--------------------------------------------------------------------------------
文件路径: gradlew
--------------------------------------------------------------------------------

#!/bin/sh

#
# Copyright © 2015 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions «$var», «${var}», «${var:-default}», «${var+SET}»,
#           «${var#prefix}», «${var%suffix}», and «$( cmd )»;
#         * compound commands having a testable exit status, especially «case»;
#         * various built-in commands including «command», «set», and «ulimit».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s\n' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac



# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -jar "$APP_HOME/gradle/wrapper/gradle-wrapper.jar" \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"




--------------------------------------------------------------------------------
文件路径: gradlew.bat
--------------------------------------------------------------------------------

@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line



@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -jar "%APP_HOME%\gradle\wrapper\gradle-wrapper.jar" %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega




--------------------------------------------------------------------------------
文件路径: settings.gradle
--------------------------------------------------------------------------------

rootProject.name = 'YXK'




--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\common\PageResult.java
--------------------------------------------------------------------------------

package com.village.committee.common;

import java.util.Collections;
import java.util.List;

public class PageResult<T> {
    private final List<T> items;
    private final int page;   // 1-based
    private final int size;
    private final long total;

    public PageResult(List<T> items, int page, int size, long total) {
        this.items = items == null ? Collections.emptyList() : items;
        this.page = page;
        this.size = size;
        this.total = total;
    }

    public List<T> getItems() {
        return items;
    }

    public int getPage() {
        return page;
    }

    public int getSize() {
        return size;
    }

    public long getTotal() {
        return total;
    }

    public long getTotalPages() {
        if (size <= 0) return 0;
        return (total + size - 1) / size;
    }

    public boolean isHasPrev() {
        return page > 1;
    }

    public boolean isHasNext() {
        return page < getTotalPages();
    }
}



--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\common\Paging.java
--------------------------------------------------------------------------------


package com.village.committee.common;

/**
 * 分页参数处理工具
 */
public final class Paging {

    private Paging() {}

    /**
     * 规范化搜索关键词
     * - null 或空白字符串返回 null
     * - 去除首尾空格
     * - 限制最大长度100
     */
    public static String normalizeQuery(String q) {
        if (q == null || q.trim().isEmpty()) {
            return null;
        }
        String trimmed = q.trim();
        if (trimmed.length() > 100) {
            trimmed = trimmed.substring(0, 100);
        }
        return trimmed;
    }

    /**
     * 规范化页码（从1开始）
     * - null 或 小于1 返回 1
     * - 最大限制10000页
     */
    public static int normalizePage(Integer page) {
        if (page == null || page < 1) {
            return 1;
        }
        if (page > 10000) {
            return 10000;
        }
        return page;
    }

    /**
     * 规范化每页数量
     * @param size 输入值
     * @param defaultSize 默认值
     * @param maxSize 最大值
     */
    public static int normalizeSize(Integer size, int defaultSize, int maxSize) {
        if (size == null || size < 1) {
            return defaultSize;
        }
        if (size > maxSize) {
            return maxSize;
        }
        return size;
    }

    /**
     * 计算偏移量（数据库 OFFSET）
     */
    public static int offset(int page, int size) {
        return (page - 1) * size;
    }

    /**
     * 计算总页数
     */
    public static int totalPages(long total, int size) {
        if (total <= 0 || size <= 0) {
            return 0;
        }
        return (int) Math.ceil((double) total / size);
    }

    /**
     * 判断是否有下一页
     */
    public static boolean hasNext(int page, int size, long total) {
        return (long) page * size < total;
    }

    /**
     * 判断是否有上一页
     */
    public static boolean hasPrev(int page) {
        return page > 1;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\common\ValidationUtils.java
--------------------------------------------------------------------------------


package com.village.committee.common;

import java.util.regex.Pattern;
import java.time.LocalDate;
import java.time.Period;
import java.time.format.DateTimeFormatter;

/**
 * 通用验证工具类
 * 提供身份证、手机号、中文名字等中国特色字段的校验
 */
public final class ValidationUtils {

    private ValidationUtils() {}

    // ==================== 身份证号验证 ====================

    /**
     * 18位身份证号正则（不含校验码验证）
     * 格式：6位地区码 + 8位生日 + 3位顺序码 + 1位校验码
     */
    private static final Pattern ID_CARD_PATTERN = Pattern.compile(
            "^[1-9]\\d{5}(19|20)\\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])\\d{3}[0-9Xx]$"
    );

    /**
     * 身份证校验码加权因子
     */
    private static final int[] ID_CARD_WEIGHTS = {7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2};

    /**
     * 身份证校验码映射
     */
    private static final char[] ID_CARD_CHECK_CODES = {'1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'};

    /**
     * 验证18位身份证号是否有效
     *
     * @param idCard 身份证号（允许为空，空值返回 true）
     * @return true=有效或为空，false=格式错误
     */
    public static boolean isValidIdCard(String idCard) {
        if (idCard == null || idCard.trim().isEmpty()) {
            return true; // 允许为空
        }

        String id = idCard.trim().toUpperCase();

        // 1. 基本格式校验
        if (!ID_CARD_PATTERN.matcher(id).matches()) {
            return false;
        }

        // 2. 校验码验证
        int sum = 0;
        for (int i = 0; i < 17; i++) {
            sum += (id.charAt(i) - '0') * ID_CARD_WEIGHTS[i];
        }
        char expectedCheckCode = ID_CARD_CHECK_CODES[sum % 11];
        char actualCheckCode = id.charAt(17);

        return expectedCheckCode == actualCheckCode;
    }

    /**
     * 获取身份证验证失败的原因
     */
    public static String getIdCardErrorMessage(String idCard) {
        if (idCard == null || idCard.trim().isEmpty()) {
            return null;
        }

        String id = idCard.trim().toUpperCase();

        if (id.length() != 18) {
            return "身份证号必须为18位";
        }

        if (!ID_CARD_PATTERN.matcher(id).matches()) {
            // 进一步细化错误信息
            String regionCode = id.substring(0, 6);
            if (!regionCode.matches("[1-9]\\d{5}")) {
                return "身份证号地区码无效";
            }

            String birthDate = id.substring(6, 14);
            String year = birthDate.substring(0, 4);
            String month = birthDate.substring(4, 6);
            String day = birthDate.substring(6, 8);

            int y = Integer.parseInt(year);
            int m = Integer.parseInt(month);
            int d = Integer.parseInt(day);

            if (y < 1900 || y > 2100) {
                return "身份证号出生年份无效";
            }
            if (m < 1 || m > 12) {
                return "身份证号出生月份无效";
            }
            if (d < 1 || d > 31) {
                return "身份证号出生日期无效";
            }

            return "身份证号格式不正确";
        }

        // 校验码错误
        int sum = 0;
        for (int i = 0; i < 17; i++) {
            sum += (id.charAt(i) - '0') * ID_CARD_WEIGHTS[i];
        }
        char expectedCheckCode = ID_CARD_CHECK_CODES[sum % 11];
        char actualCheckCode = id.charAt(17);

        if (expectedCheckCode != actualCheckCode) {
            return "身份证号校验码错误（末位应为 " + expectedCheckCode + "）";
        }

        return null;
    }

    // ==================== 手机号验证 ====================

    /**
     * 中国大陆手机号正则
     * 支持：13x, 14x, 15x, 16x, 17x, 18x, 19x
     */
    private static final Pattern PHONE_PATTERN = Pattern.compile(
            "^1[3-9]\\d{9}$"
    );

    /**
     * 座机号正则（区号-号码 或 纯号码）
     */
    private static final Pattern LANDLINE_PATTERN = Pattern.compile(
            "^(0\\d{2,3}-?)?\\d{7,8}$"
    );

    /**
     * 验证手机号是否有效
     *
     * @param phone 手机号（允许为空，空值返回 true）
     * @return true=有效或为空
     */
    public static boolean isValidPhone(String phone) {
        if (phone == null || phone.trim().isEmpty()) {
            return true; // 允许为空
        }

        String p = phone.trim().replaceAll("[\\s-]", "");

        // 手机号或座机号都可以
        return PHONE_PATTERN.matcher(p).matches() || LANDLINE_PATTERN.matcher(p).matches();
    }

    /**
     * 验证是否为有效的手机号（严格模式，仅手机号）
     */
    public static boolean isValidMobilePhone(String phone) {
        if (phone == null || phone.trim().isEmpty()) {
            return true;
        }
        String p = phone.trim().replaceAll("[\\s-]", "");
        return PHONE_PATTERN.matcher(p).matches();
    }

    /**
     * 获取手机号验证失败的原因
     */
    public static String getPhoneErrorMessage(String phone) {
        if (phone == null || phone.trim().isEmpty()) {
            return null;
        }

        String p = phone.trim().replaceAll("[\\s-]", "");

        if (p.length() < 7) {
            return "电话号码太短";
        }

        if (p.length() > 12) {
            return "电话号码太长";
        }

        if (p.length() == 11 && !p.startsWith("1")) {
            return "手机号必须以1开头";
        }

        if (p.length() == 11 && !PHONE_PATTERN.matcher(p).matches()) {
            return "手机号格式不正确（应为11位有效手机号）";
        }

        if (!PHONE_PATTERN.matcher(p).matches() && !LANDLINE_PATTERN.matcher(p).matches()) {
            return "电话号码格式不正确";
        }

        return null;
    }

    // ==================== 通用字符串验证 ====================

    /**
     * 判断字符串是否为空白
     */
    public static boolean isBlank(String s) {
        return s == null || s.trim().isEmpty();
    }

    /**
     * 判断字符串是否非空白
     */
    public static boolean isNotBlank(String s) {
        return !isBlank(s);
    }

    /**
     * 安全裁剪字符串
     */
    public static String trimToNull(String s) {
        if (s == null) return null;
        String trimmed = s.trim();
        return trimmed.isEmpty() ? null : trimmed;
    }

    /**
     * 安全裁剪字符串（空值转为空字符串）
     */
    public static String trimToEmpty(String s) {
        if (s == null) return "";
        return s.trim();
    }

    // ==================== 中文名字验证 ====================

    /**
     * 中文名字正则，支持2-4个汉字，可包含间隔号·
     */
    private static final Pattern CHINESE_NAME_PATTERN = Pattern.compile(
            "^[\u4e00-\u9fa5]{2,4}$|^[\u4e00-\u9fa5]{1,3}·[\u4e00-\u9fa5]{1,3}$"
    );

    /**
     * 验证是否为有效的中文名字
     *
     * @param name 名字（允许为空，空值返回 true）
     * @return true=有效或为空，false=格式错误
     */
    public static boolean isValidChineseName(String name) {
        if (name == null || name.trim().isEmpty()) {
            return true; // 允许为空
        }

        String n = name.trim();
        return CHINESE_NAME_PATTERN.matcher(n).matches();
    }

    /**
     * 获取中文名字验证失败的原因
     */
    public static String getChineseNameErrorMessage(String name) {
        if (name == null || name.trim().isEmpty()) {
            return null;
        }

        String n = name.trim();

        if (n.length() < 2) {
            return "姓名至少需要2个字符";
        }

        if (n.length() > 4) {
            return "姓名不能超过4个字符";
        }

        if (!CHINESE_NAME_PATTERN.matcher(n).matches()) {
            return "姓名只能包含中文和间隔号";
        }

        return null;
    }

    // ==================== 地址验证 ====================

    /**
     * 中国地址正则，简单验证地址格式
     */
    private static final Pattern CHINESE_ADDRESS_PATTERN = Pattern.compile(
            "^[\u4e00-\u9fa5]{2,}(省|市|区|县|镇|乡|街道|村|路|巷|号|室|栋|单元|层)[\u4e00-\u9fa50-9()（）#号-]*$"
    );

    /**
     * 验证是否为有效的中国地址
     *
     * @param address 地址（允许为空，空值返回 true）
     * @return true=有效或为空，false=格式错误
     */
    public static boolean isValidChineseAddress(String address) {
        if (address == null || address.trim().isEmpty()) {
            return true; // 允许为空
        }

        String a = address.trim();
        return CHINESE_ADDRESS_PATTERN.matcher(a).matches();
    }

    /**
     * 获取地址验证失败的原因
     */
    public static String getAddressErrorMessage(String address) {
        if (address == null || address.trim().isEmpty()) {
            return null;
        }

        String a = address.trim();

        if (a.length() < 5) {
            return "地址过于简短，请输入详细地址";
        }

        if (!CHINESE_ADDRESS_PATTERN.matcher(a).matches()) {
            return "地址格式不正确，应包含省市区县等行政区划信息";
        }

        return null;
    }

    // ==================== 年龄验证 ====================

    /**
     * 根据身份证号计算年龄
     *
     * @param idCard 身份证号
     * @return 年龄，如果身份证号无效返回null
     */
    public static Integer calculateAgeFromIdCard(String idCard) {
        if (!isValidIdCard(idCard)) {
            return null;
        }

        try {
            String id = idCard.trim().toUpperCase();
            String birthDateStr = id.substring(6, 14);
            LocalDate birthDate = LocalDate.parse(birthDateStr, DateTimeFormatter.ofPattern("yyyyMMdd"));
            return Period.between(birthDate, LocalDate.now()).getYears();
        } catch (Exception e) {
            return null;
        }
    }

    /**
     * 验证年龄是否在合理范围内
     *
     * @param age 年龄
     * @return true=年龄合理，false=年龄不合理
     */
    public static boolean isValidAge(Integer age) {
        if (age == null) {
            return true; // 允许为空
        }
        return age >= 0 && age <= 150;
    }

    /**
     * 获取年龄验证失败的原因
     */
    public static String getAgeErrorMessage(Integer age) {
        if (age == null) {
            return null;
        }

        if (age < 0) {
            return "年龄不能为负数";
        }

        if (age > 150) {
            return "年龄不能超过150岁";
        }

        return null;
    }

    // ==================== 内容安全验证 ====================

    /**
     * 简单的敏感词列表（实际项目中应该使用更完善的敏感词库）
     */
    private static final String[] SENSITIVE_WORDS = {
        "敏感词1", "敏感词2", "敏感词3" // 示例，实际应替换为真实敏感词
    };

    /**
     * 检查文本是否包含敏感词
     *
     * @param text 文本内容
     * @return true=不包含敏感词，false=包含敏感词
     */
    public static boolean isContentSafe(String text) {
        if (text == null || text.trim().isEmpty()) {
            return true; // 允许为空
        }

        String t = text.trim().toLowerCase();
        for (String word : SENSITIVE_WORDS) {
            if (t.contains(word.toLowerCase())) {
                return false;
            }
        }
        return true;
    }

    /**
     * 获取内容安全验证失败的原因
     */
    public static String getContentSafetyErrorMessage(String text) {
        if (text == null || text.trim().isEmpty()) {
            return null;
        }

        String t = text.trim().toLowerCase();
        for (String word : SENSITIVE_WORDS) {
            if (t.contains(word.toLowerCase())) {
                return "内容包含敏感词：" + word;
            }
        }
        return null;
    }

    // ==================== HTML标签过滤 ====================

    /**
     * 简单的HTML标签正则
     */
    private static final Pattern HTML_TAG_PATTERN = Pattern.compile("<[^>]+>");

    /**
     * 检查文本是否包含HTML标签
     *
     * @param text 文本内容
     * @param allowAllowedTags 是否允许白名单中的标签
     * @param allowedTags 允许的HTML标签白名单
     * @return true=不包含非法HTML标签，false=包含非法HTML标签
     */
    public static boolean isHtmlSafe(String text, boolean allowAllowedTags, String... allowedTags) {
        if (text == null || text.trim().isEmpty()) {
            return true; // 允许为空
        }

        // 如果不允许任何HTML标签
        if (!allowAllowedTags) {
            return !HTML_TAG_PATTERN.matcher(text).find();
        }

        // 允许白名单中的HTML标签
        // 这里简化处理，实际项目中应使用更完善的HTML解析器
        String lowerText = text.toLowerCase();
        for (String tag : allowedTags) {
            lowerText = lowerText.replaceAll("<" + tag.toLowerCase() + "[^>]*>", "");
            lowerText = lowerText.replaceAll("</" + tag.toLowerCase() + ">", "");
        }

        return !HTML_TAG_PATTERN.matcher(lowerText).find();
    }

    /**
     * 获取HTML安全验证失败的原因
     */
    public static String getHtmlSafetyErrorMessage(String text, boolean allowAllowedTags, String... allowedTags) {
        if (text == null || text.trim().isEmpty()) {
            return null;
        }

        if (!isHtmlSafe(text, allowAllowedTags, allowedTags)) {
            if (allowAllowedTags && allowedTags.length > 0) {
                return "内容包含不允许的HTML标签，仅允许: " + String.join(", ", allowedTags);
            } else {
                return "内容不允许包含HTML标签";
            }
        }

        return null;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\config\DatabaseInitializer.java
--------------------------------------------------------------------------------


package com.village.committee.config;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ClassPathResource;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;
import jakarta.annotation.PostConstruct;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.stream.Collectors;

/**
 * 数据库初始化器
 * 在应用启动时自动创建数据库和表
 */
@Component
public class DatabaseInitializer {

    private static final Logger logger = LoggerFactory.getLogger(DatabaseInitializer.class);

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @PostConstruct
    public void init() {
        try {
            logger.info("开始初始化数据库...");

            // 读取schema.sql文件
            ClassPathResource resource = new ClassPathResource("schema.sql");
            try (BufferedReader reader = new BufferedReader(
                    new InputStreamReader(resource.getInputStream(), StandardCharsets.UTF_8))) {

                // 读取整个SQL文件内容
                String sql = reader.lines().collect(Collectors.joining("\n"));
                
                // 分割SQL语句
                String[] statements = sql.split(";\s*\n");
                
                // 逐个执行SQL语句
                for (String statement : statements) {
                    if (!statement.trim().isEmpty()) {
                        jdbcTemplate.execute(statement);
                    }
                }

                logger.info("数据库初始化完成");
            }
        } catch (Exception e) {
            logger.error("数据库初始化失败", e);
        }
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\config\RootConfig.java
--------------------------------------------------------------------------------

package com.village.committee.config;

import com.zaxxer.hikari.HikariConfig;
import com.zaxxer.hikari.HikariDataSource;
import javax.sql.DataSource;
import org.apache.ibatis.session.SqlSessionFactory;
import org.mybatis.spring.SqlSessionFactoryBean;
import org.mybatis.spring.SqlSessionTemplate;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import org.springframework.jdbc.core.JdbcTemplate;

@Configuration
@PropertySource("classpath:db.properties")
@EnableTransactionManagement
@MapperScan(basePackages = "com.village.committee.mapper")
@ComponentScan(basePackages = {"com.village.committee.service", "com.village.committee.config"})
public class RootConfig {

    @Bean
    public DataSource dataSource(Environment env) {
        HikariConfig cfg = new HikariConfig();
        cfg.setJdbcUrl(env.getRequiredProperty("db.url"));
        cfg.setUsername(env.getRequiredProperty("db.username"));
        cfg.setPassword(env.getRequiredProperty("db.password"));
        cfg.setDriverClassName(env.getRequiredProperty("db.driverClassName"));

        cfg.setMaximumPoolSize(env.getProperty("db.maxPoolSize", Integer.class, 10));
        cfg.setMinimumIdle(env.getProperty("db.minIdle", Integer.class, 2));

        // 允许应用在 DB 暂不可用时也能启动
        cfg.setInitializationFailTimeout(-1);

        cfg.setPoolName("VillageHikariCP");
        return new HikariDataSource(cfg);
    }

    @Bean
    public PlatformTransactionManager transactionManager(DataSource ds) {
        return new DataSourceTransactionManager(ds);
    }

    @Bean
    public SqlSessionFactory sqlSessionFactory(DataSource ds) throws Exception {
        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
        factoryBean.setDataSource(ds);

        org.apache.ibatis.session.Configuration mybatisCfg = new org.apache.ibatis.session.Configuration();
        // 不自动转换下划线为驼峰，保持表名原样
        mybatisCfg.setMapUnderscoreToCamelCase(false);
        factoryBean.setConfiguration(mybatisCfg);

        SqlSessionFactory factory = factoryBean.getObject();
        if (factory == null) {
            throw new IllegalStateException("SqlSessionFactory is null (unexpected).");
        }
        return factory;
    }

    @Bean
    public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory factory) {
        return new SqlSessionTemplate(factory);
    }

    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}



--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\config\WebAppInitializer.java
--------------------------------------------------------------------------------

package com.village.committee.config;

import com.village.committee.web.filter.CsrfTokenFilter;
import com.village.committee.web.filter.RequestIdFilter;
import jakarta.servlet.Filter;
import org.springframework.web.filter.CharacterEncodingFilter;
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class WebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class<?>[] getRootConfigClasses() {
        return new Class<?>[]{RootConfig.class};
    }

    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class<?>[]{WebMvcConfig.class};
    }

    @Override
    protected String[] getServletMappings() {
        return new String[]{"/"};
    }

    @Override
    protected Filter[] getServletFilters() {
        CharacterEncodingFilter encoding = new CharacterEncodingFilter();
        encoding.setEncoding("UTF-8");
        encoding.setForceEncoding(true);

        return new Filter[]{
                encoding,
                new RequestIdFilter(),
                new CsrfTokenFilter()
        };
    }
}



--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\config\WebMvcConfig.java
--------------------------------------------------------------------------------

package com.village.committee.config;


import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.CacheControl;
import org.springframework.http.converter.HttpMessageConverters;
import org.springframework.http.converter.json.JacksonJsonHttpMessageConverter;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.resource.VersionResourceResolver;
import org.springframework.web.servlet.view.InternalResourceViewResolver;
import org.springframework.web.servlet.view.JstlView;
import tools.jackson.databind.json.JsonMapper;

@Configuration
@EnableWebMvc
@ComponentScan(basePackages = "com.village.committee.web")
public class WebMvcConfig implements WebMvcConfigurer {
    @Bean
    public ViewResolver viewResolver() {
        InternalResourceViewResolver vr = new InternalResourceViewResolver();
        vr.setViewClass(JstlView.class);
        vr.setPrefix("/WEB-INF/views/");
        vr.setSuffix(".jsp");
        return vr;
    }

    @Bean
    public JsonMapper.Builder jsonMapperBuilder() {
        return JsonMapper.builder().findAndAddModules();
    }

    @Override
    public void configureMessageConverters(HttpMessageConverters.ServerBuilder builder) {
        builder.withJsonConverter(new JacksonJsonHttpMessageConverter(jsonMapperBuilder()));
    }
    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        VersionResourceResolver versionResolver = new VersionResourceResolver();
        versionResolver.addContentVersionStrategy("/**");
        
        registry.addResourceHandler("/static/**")
                .addResourceLocations("/static/")
                .setCacheControl(CacheControl.noCache())
                .resourceChain(false);
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\domain\Announcement.java
--------------------------------------------------------------------------------

package com.village.committee.domain;

import java.time.LocalDateTime;

public class Announcement {

    private Long id;
    private String title;
    private String content;
    private String publisher;
    private LocalDateTime publishTime;
    private Boolean isTop;
    private Integer status; // 0-草稿, 1-发布

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public String getPublisher() {
        return publisher;
    }

    public void setPublisher(String publisher) {
        this.publisher = publisher;
    }

    public LocalDateTime getPublishTime() {
        return publishTime;
    }

    public void setPublishTime(LocalDateTime publishTime) {
        this.publishTime = publishTime;
    }

    public Boolean getIsTop() {
        return isTop;
    }

    public void setIsTop(Boolean isTop) {
        this.isTop = isTop;
    }

    public Integer getStatus() {
        return status;
    }

    public void setStatus(Integer status) {
        this.status = status;
    }

    /**
     * 是否已发布
     */
    public boolean isPublished() {
        return status != null && status == 1;
    }

    /**
     * 状态文本
     */
    public String getStatusText() {
        if (status == null || status == 0) {
            return "草稿";
        }
        return "已发布";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\domain\CommitteeMember.java
--------------------------------------------------------------------------------

package com.village.committee.domain;

import java.time.LocalDateTime;

/**
 * 村委会成员实体类
 */
public class CommitteeMember {
    private Long id;
    private String name;
    private String position;  // 职务
    private String phone;     // 联系电话
    private String duties;    // 职责描述
    private LocalDateTime joinTime;  // 任职时间
    private Boolean isActive; // 是否在职
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPosition() {
        return position;
    }

    public void setPosition(String position) {
        this.position = position;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getDuties() {
        return duties;
    }

    public void setDuties(String duties) {
        this.duties = duties;
    }

    public LocalDateTime getJoinTime() {
        return joinTime;
    }

    public void setJoinTime(LocalDateTime joinTime) {
        this.joinTime = joinTime;
    }

    public Boolean getIsActive() {
        return isActive;
    }

    public void setIsActive(Boolean isActive) {
        this.isActive = isActive;
    }

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public void setCreatedAt(LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }

    public LocalDateTime getUpdatedAt() {
        return updatedAt;
    }

    public void setUpdatedAt(LocalDateTime updatedAt) {
        this.updatedAt = updatedAt;
    }

    /**
     * 是否在职
     */
    public boolean isActiveMember() {
        return isActive != null && isActive;
    }

    /**
     * 状态文本
     */
    public String getStatusText() {
        if (isActive == null || !isActive) {
            return "离职";
        }
        return "在职";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\domain\OperationLog.java
--------------------------------------------------------------------------------

package com.village.committee.domain;

import java.time.LocalDateTime;

public class OperationLog {
    private Long id;
    private String operator;
    private String operationType;
    private String targetType;
    private Long targetId;
    private String description;
    private String ipAddress;
    private String userAgent;
    private LocalDateTime createdAt;

    // Getters and Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getOperator() { return operator; }
    public void setOperator(String operator) { this.operator = operator; }
    public String getOperationType() { return operationType; }
    public void setOperationType(String operationType) { this.operationType = operationType; }
    public String getTargetType() { return targetType; }
    public void setTargetType(String targetType) { this.targetType = targetType; }
    public Long getTargetId() { return targetId; }
    public void setTargetId(Long targetId) { this.targetId = targetId; }
    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }
    public String getIpAddress() { return ipAddress; }
    public void setIpAddress(String ipAddress) { this.ipAddress = ipAddress; }
    public String getUserAgent() { return userAgent; }
    public void setUserAgent(String userAgent) { this.userAgent = userAgent; }
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\domain\Resident.java
--------------------------------------------------------------------------------

package com.village.committee.domain;

import java.time.LocalDateTime;

public class Resident {
    private Long id;
    private String name;
    private String idCard;
    private String phone;
    private String address;
    private LocalDateTime createdAt;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getIdCard() {
        return idCard;
    }

    public void setIdCard(String idCard) {
        this.idCard = idCard;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public void setCreatedAt(LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\mapper\AnnouncementMapper.java
--------------------------------------------------------------------------------

package com.village.committee.mapper;

import com.village.committee.domain.Announcement;
import java.time.LocalDateTime;
import java.util.List;
import org.apache.ibatis.annotations.*;

@Mapper
public interface AnnouncementMapper {

    @Select("SELECT * FROM announcements ORDER BY is_top DESC, publish_time DESC")
    List<Announcement> findAll();

    @Select("SELECT COUNT(*) FROM announcements")
    long count();

    /**
     * 统计指定时间之后的公告数量
     * 说明：表结构没有 created_at，这里使用 publish_time 作为时间字段
     */
    @Select("SELECT COUNT(*) FROM announcements WHERE publish_time >= #{from}")
    long countSince(@Param("from") LocalDateTime from);

    /**
     * 获取最新的N条公告（已发布）
     */
    @Select("SELECT * FROM announcements WHERE status = 1 ORDER BY is_top DESC, publish_time DESC LIMIT #{limit}")
    List<Announcement> findLatest(@Param("limit") int limit);

    @Select("SELECT * FROM announcements WHERE id = #{id}")
    Announcement findById(@Param("id") Long id);

    @Select("""
        <script>
        SELECT * FROM announcements
        <where>
            <if test="q != null and q != ''">
                AND (title LIKE CONCAT('%', #{q}, '%') OR content LIKE CONCAT('%', #{q}, '%'))
            </if>
        </where>
        ORDER BY is_top DESC, publish_time DESC
        LIMIT #{offset}, #{limit}
        </script>
        """)
    List<Announcement> findPage(@Param("q") String q, @Param("offset") int offset, @Param("limit") int limit);

    @Select("""
        <script>
        SELECT COUNT(*) FROM announcements
        <where>
            <if test="q != null and q != ''">
                AND (title LIKE CONCAT('%', #{q}, '%') OR content LIKE CONCAT('%', #{q}, '%'))
            </if>
        </where>
        </script>
        """)
    long countByQuery(@Param("q") String q);

    /**
     * 新增公告
     * 修复：announcements 表无 created_at 字段，INSERT 去掉 created_at
     * 同时：publishTime 允许为空时用 NOW()（和“留空则使用当前时间”一致）
     */
    @Insert("""
        INSERT INTO announcements (title, content, publisher, publish_time, is_top, status)
        VALUES (#{title}, #{content}, #{publisher}, IFNULL(#{publishTime}, NOW()), #{isTop}, #{status})
        """)
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insert(Announcement announcement);

    @Update("""
        UPDATE announcements
        SET title = #{title}, content = #{content}, publisher = #{publisher},
            publish_time = #{publishTime}, is_top = #{isTop}, status = #{status}
        WHERE id = #{id}
        """)
    int update(Announcement announcement);

    @Delete("DELETE FROM announcements WHERE id = #{id}")
    int deleteById(@Param("id") Long id);
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\mapper\CommitteeMemberMapper.java
--------------------------------------------------------------------------------

package com.village.committee.mapper;

import com.village.committee.domain.CommitteeMember;
import org.apache.ibatis.annotations.*;
import java.time.LocalDateTime;
import java.util.List;

/**
 * 村委会成员数据访问接口
 */
@Mapper
public interface CommitteeMemberMapper {

    /**
     * 查询所有成员
     */
    @Select("SELECT * FROM village_committee.committee_members ORDER BY join_time DESC")
    List<CommitteeMember> findAll();

    /**
     * 根据ID查询成员
     */
    @Select("SELECT * FROM village_committee.committee_members WHERE id = #{id}")
    CommitteeMember findById(Long id);

    /**
     * 查询在职成员
     */
    @Select("SELECT * FROM village_committee.committee_members WHERE is_active = 1 ORDER BY join_time DESC")
    List<CommitteeMember> findActive();

    /**
     * 分页查询成员
     */
    @Select("SELECT * FROM village_committee.committee_members WHERE " +
            "(name LIKE CONCAT('%', #{query}, '%') OR " +
            "position LIKE CONCAT('%', #{query}, '%') OR " +
            "duties LIKE CONCAT('%', #{query}, '%')) " +
            "ORDER BY join_time DESC " +
            "LIMIT #{offset}, #{limit}")
    List<CommitteeMember> findPage(@Param("query") String query, 
                                   @Param("offset") int offset, 
                                   @Param("limit") int limit);

    /**
     * 统计成员总数
     */
    @Select("SELECT COUNT(*) FROM village_committee.committee_members WHERE " +
            "(#{query} IS NULL OR #{query} = '' OR " +
            "name LIKE CONCAT('%', #{query}, '%') OR " +
            "position LIKE CONCAT('%', #{query}, '%') OR " +
            "duties LIKE CONCAT('%', #{query}, '%'))")
    long count(@Param("query") String query);

    /**
     * 统计指定时间之后的成员数量
     */
    @Select("SELECT COUNT(*) FROM village_committee.committee_members WHERE created_at >= #{from}")
    long countSince(@Param("from") LocalDateTime from);

    /**
     * 插入新成员
     */
    @Insert("INSERT INTO village_committee.committee_members (name, position, phone, duties, join_time, is_active, created_at, updated_at) " +
            "VALUES (#{name}, #{position}, #{phone}, #{duties}, #{joinTime}, #{isActive}, NOW(), NOW())")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insert(CommitteeMember member);

    /**
     * 更新成员信息
     */
    @Update("UPDATE village_committee.committee_members SET " +
            "name = #{name}, " +
            "position = #{position}, " +
            "phone = #{phone}, " +
            "duties = #{duties}, " +
            "join_time = #{joinTime}, " +
            "is_active = #{isActive}, " +
            "updated_at = NOW() " +
            "WHERE id = #{id}")
    int update(CommitteeMember member);

    /**
     * 删除成员
     */
    @Delete("DELETE FROM village_committee.committee_members WHERE id = #{id}")
    int deleteById(Long id);
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\mapper\HealthMapper.java
--------------------------------------------------------------------------------

package com.village.committee.mapper;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;

@Mapper
public interface HealthMapper {

    @Select("SELECT 'OK'")
    String ping();
}



--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\mapper\OperationLogMapper.java
--------------------------------------------------------------------------------

package com.village.committee.mapper;

import com.village.committee.domain.OperationLog;
import org.apache.ibatis.annotations.*;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Map;

@Mapper
public interface OperationLogMapper {

    @Insert("""
            INSERT INTO operation_logs (operator, operation_type, target_type, target_id, description, ip_address, user_agent, created_at)
            VALUES (#{operator}, #{operationType}, #{targetType}, #{targetId}, #{description}, #{ipAddress}, #{userAgent}, #{createdAt})
            """)
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insert(OperationLog operationLog);

    @Select("SELECT * FROM operation_logs ORDER BY created_at DESC")
    List<OperationLog> findAll();

    @Select("SELECT * FROM operation_logs WHERE id = #{id}")
    OperationLog findById(@Param("id") Long id);

    @Select("""
            <script>
            SELECT * FROM operation_logs
            <where>
                <if test="q != null and q != ''">
                    AND (operator LIKE CONCAT('%', #{q}, '%')
                         OR operation_type LIKE CONCAT('%', #{q}, '%')
                         OR target_type LIKE CONCAT('%', #{q}, '%')
                         OR description LIKE CONCAT('%', #{q}, '%'))
                </if>
                <if test="operationType != null and operationType != ''">
                    AND operation_type = #{operationType}
                </if>
                <if test="targetType != null and targetType != ''">
                    AND target_type = #{targetType}
                </if>
            </where>
            ORDER BY created_at DESC
            LIMIT #{offset}, #{limit}
            </script>
            """)
    List<OperationLog> findPage(@Param("q") String q,
                                 @Param("operationType") String operationType,
                                 @Param("targetType") String targetType,
                                 @Param("offset") int offset,
                                 @Param("limit") int limit);

    @Select("""
            <script>
            SELECT COUNT(*) FROM operation_logs
            <where>
                <if test="q != null and q != ''">
                    AND (operator LIKE CONCAT('%', #{q}, '%')
                         OR operation_type LIKE CONCAT('%', #{q}, '%')
                         OR target_type LIKE CONCAT('%', #{q}, '%')
                         OR description LIKE CONCAT('%', #{q}, '%'))
                </if>
                <if test="operationType != null and operationType != ''">
                    AND operation_type = #{operationType}
                </if>
                <if test="targetType != null and targetType != ''">
                    AND target_type = #{targetType}
                </if>
            </where>
            </script>
            """)
    long count(@Param("q") String q,
               @Param("operationType") String operationType,
               @Param("targetType") String targetType);

    @Select("SELECT * FROM operation_logs ORDER BY created_at DESC LIMIT #{limit}")
    List<OperationLog> findLatest(@Param("limit") int limit);

    @Select("SELECT COUNT(*) FROM operation_logs WHERE created_at >= #{from}")
    long countSince(@Param("from") LocalDateTime from);

    @Select("SELECT DISTINCT operation_type FROM operation_logs ORDER BY operation_type")
    List<String> findDistinctOperationTypes();

    @Select("SELECT DISTINCT target_type FROM operation_logs ORDER BY target_type")
    List<String> findDistinctTargetTypes();

    @Select("SELECT COUNT(*) FROM operation_logs")
    long countAll();

    @Select("SELECT COUNT(*) FROM operation_logs WHERE operation_type = #{operationType}")
    long countByOperationType(@Param("operationType") String operationType);

    @Select("SELECT COUNT(*) FROM operation_logs WHERE target_type = #{targetType}")
    long countByTargetType(@Param("targetType") String targetType);

    @Select("""
            SELECT DATE_FORMAT(created_at, '%Y-%m-%d') as date, COUNT(*) as count
            FROM operation_logs
            WHERE created_at >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
            GROUP BY DATE_FORMAT(created_at, '%Y-%m-%d')
            ORDER BY date
            """)
    List<Map<String, Object>> getRecentOperationStats(@Param("days") int days);
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\mapper\ResidentMapper.java
--------------------------------------------------------------------------------

package com.village.committee.mapper;

import com.village.committee.domain.Resident;
import java.util.List;
import org.apache.ibatis.annotations.*;

@Mapper
public interface ResidentMapper {

    @Select("""
            SELECT id, name, id_card, phone, address, created_at
            FROM residents
            ORDER BY id DESC
            """)
    List<Resident> findAll();

    @Select("""
            SELECT id, name, id_card, phone, address, created_at
            FROM residents
            WHERE id = #{id}
            """)
    Resident findById(@Param("id") Long id);

    @Select("""
            <script>
            SELECT id, name, id_card, phone, address, created_at
            FROM residents
            <where>
              <if test="q != null and q != ''">
                AND (
                    name LIKE CONCAT(#{q}, '%')
                    OR id_card = #{q}
                    OR phone = #{q}
                    OR MATCH(name, phone, address) AGAINST(#{q} IN BOOLEAN MODE)
                )
              </if>
            </where>
            ORDER BY id DESC
            LIMIT #{limit} OFFSET #{offset}
            </script>
            """)
    List<Resident> findPage(@Param("q") String q,
                           @Param("offset") int offset,
                           @Param("limit") int limit);

    @Select("""
            <script>
            SELECT COUNT(1)
            FROM residents
            <where>
              <if test="q != null and q != ''">
                AND (
                    name LIKE CONCAT(#{q}, '%')
                    OR id_card = #{q}
                    OR phone = #{q}
                    OR MATCH(name, phone, address) AGAINST(#{q} IN BOOLEAN MODE)
                )
              </if>
            </where>
            </script>
            """)
    long count(@Param("q") String q);

    @Select("SELECT COUNT(1) FROM residents WHERE created_at >= #{from}")
    long countSince(@Param("from") java.time.LocalDateTime from);

    @Insert("""
            INSERT INTO residents (name, id_card, phone, address)
            VALUES (#{name}, #{idCard}, #{phone}, #{address})
            """)
    @Options(useGeneratedKeys = true, keyProperty = "id", keyColumn = "id")
    int insert(Resident resident);

    @Update("""
            UPDATE residents
            SET name = #{name},
                id_card = #{idCard},
                phone = #{phone},
                address = #{address}
            WHERE id = #{id}
            """)
    int update(Resident resident);

    @Delete("DELETE FROM residents WHERE id = #{id}")
    int deleteById(@Param("id") Long id);
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\service\AnnouncementService.java
--------------------------------------------------------------------------------

package com.village.committee.service;

import com.village.committee.common.PageResult;
import com.village.committee.common.Paging;
import com.village.committee.common.ValidationUtils;
import com.village.committee.domain.Announcement;
import com.village.committee.mapper.AnnouncementMapper;
import java.time.LocalDateTime;
import java.time.temporal.TemporalAdjusters;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

@Service
public class AnnouncementService {

    private final AnnouncementMapper announcementMapper;

    public AnnouncementService(AnnouncementMapper announcementMapper) {
        this.announcementMapper = announcementMapper;
    }

    @Transactional(readOnly = true)
    public List<Announcement> list() {
        return announcementMapper.findAll();
    }

    @Transactional(readOnly = true)
    public long countAll() {
        return announcementMapper.count();
    }

    /**
     * 统计指定时间之后的公告数量
     */
    @Transactional(readOnly = true)
    public long countSince(LocalDateTime from) {
        return announcementMapper.countSince(from);
    }

    /**
     * 统计本月新增公告数量
     */
    @Transactional(readOnly = true)
    public long countThisMonth() {
        LocalDateTime firstDayOfMonth = LocalDateTime.now()
                .with(TemporalAdjusters.firstDayOfMonth())
                .withHour(0).withMinute(0).withSecond(0).withNano(0);
        return announcementMapper.countSince(firstDayOfMonth);
    }

    /**
     * 获取最新的N条公告
     */
    @Transactional(readOnly = true)
    public List<Announcement> latest(int limit) {
        if (limit <= 0) {
            limit = 5;
        }
        if (limit > 100) {
            limit = 100;
        }
        return announcementMapper.findLatest(limit);
    }

    @Transactional(readOnly = true)
    public PageResult<Announcement> page(String q, Integer page, Integer size) {
        String query = Paging.normalizeQuery(q);
        int p = Paging.normalizePage(page);
        int s = Paging.normalizeSize(size, 10, 100);

        long total = announcementMapper.countByQuery(query);
        int offset = Paging.offset(p, s);

        if (total > 0 && offset >= total) {
            return new PageResult<>(List.of(), p, s, total);
        }

        List<Announcement> items = announcementMapper.findPage(query, offset, s);
        return new PageResult<>(items, p, s, total);
    }

    @Transactional(readOnly = true)
    public Announcement get(Long id) {
        return announcementMapper.findById(id);
    }

    /**
     * 验证公告数据（抛异常）
     */
    public void validate(Announcement announcement) {
        if (announcement == null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "公告信息不能为空");
        }

        // 标题校验
        if (ValidationUtils.isBlank(announcement.getTitle())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "标题不能为空");
        }

        String title = announcement.getTitle().trim();
        if (title.length() > 100) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "标题不能超过100个字符");
        }
        
        // 标题安全校验
        String titleSafetyError = ValidationUtils.getContentSafetyErrorMessage(title);
        if (titleSafetyError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "标题" + titleSafetyError);
        }
        
        // 标题HTML校验
        String titleHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(title, false);
        if (titleHtmlError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "标题" + titleHtmlError);
        }

        // 内容校验
        if (ValidationUtils.isBlank(announcement.getContent())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "内容不能为空");
        }

        if (announcement.getContent().length() > 10000) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "内容不能超过10000个字符");
        }
        
        // 内容安全校验
        String contentSafetyError = ValidationUtils.getContentSafetyErrorMessage(announcement.getContent());
        if (contentSafetyError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "内容" + contentSafetyError);
        }
        
        // 内容HTML校验 - 允许基本HTML标签
        String contentHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(
            announcement.getContent(), true, "p", "br", "div", "span", "strong", "em", "ul", "ol", "li", "h1", "h2", "h3", "h4", "h5", "h6");
        if (contentHtmlError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "内容" + contentHtmlError);
        }

        // 发布人校验
        if (ValidationUtils.isBlank(announcement.getPublisher())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "发布人不能为空");
        }

        String publisherError = ValidationUtils.getChineseNameErrorMessage(announcement.getPublisher());
        if (publisherError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "发布人" + publisherError);
        }
        
        // 发布时间校验
        if (announcement.getPublishTime() != null && announcement.getPublishTime().isAfter(java.time.LocalDateTime.now().plusDays(1))) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "发布时间不能是未来时间");
        }
    }

    /**
     * 验证并返回错误消息（用于MVC控制器）
     */
    public String validateAndGetError(Announcement announcement) {
        if (announcement == null) {
            return "公告信息不能为空";
        }

        // 标题校验
        if (ValidationUtils.isBlank(announcement.getTitle())) {
            return "标题不能为空";
        }

        if (announcement.getTitle().trim().length() > 100) {
            return "标题不能超过100个字符";
        }
        
        // 标题安全校验
        String titleSafetyError = ValidationUtils.getContentSafetyErrorMessage(announcement.getTitle());
        if (titleSafetyError != null) {
            return "标题" + titleSafetyError;
        }
        
        // 标题HTML校验
        String titleHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(announcement.getTitle(), false);
        if (titleHtmlError != null) {
            return "标题" + titleHtmlError;
        }

        // 内容校验
        if (ValidationUtils.isBlank(announcement.getContent())) {
            return "内容不能为空";
        }

        if (announcement.getContent().length() > 10000) {
            return "内容不能超过10000个字符";
        }
        
        // 内容安全校验
        String contentSafetyError = ValidationUtils.getContentSafetyErrorMessage(announcement.getContent());
        if (contentSafetyError != null) {
            return "内容" + contentSafetyError;
        }
        
        // 内容HTML校验 - 允许基本HTML标签
        String contentHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(
            announcement.getContent(), true, "p", "br", "div", "span", "strong", "em", "ul", "ol", "li", "h1", "h2", "h3", "h4", "h5", "h6");
        if (contentHtmlError != null) {
            return "内容" + contentHtmlError;
        }

        // 发布人校验
        if (ValidationUtils.isBlank(announcement.getPublisher())) {
            return "发布人不能为空";
        }

        String publisherError = ValidationUtils.getChineseNameErrorMessage(announcement.getPublisher());
        if (publisherError != null) {
            return "发布人" + publisherError;
        }
        
        // 发布时间校验
        if (announcement.getPublishTime() != null && announcement.getPublishTime().isAfter(java.time.LocalDateTime.now().plusDays(1))) {
            return "发布时间不能是未来时间";
        }

        return null;
    }

    /**
     * 规范化数据
     */
    private void normalize(Announcement announcement) {
        if (announcement.getTitle() != null) {
            announcement.setTitle(announcement.getTitle().trim());
        }
        if (announcement.getPublisher() != null) {
            announcement.setPublisher(announcement.getPublisher().trim());
        }
        if (announcement.getPublishTime() == null) {
            announcement.setPublishTime(LocalDateTime.now());
        }
        if (announcement.getIsTop() == null) {
            announcement.setIsTop(false);
        }
        if (announcement.getStatus() == null) {
            announcement.setStatus(1);
        }
    }

    @Transactional
    public Announcement create(Announcement announcement) {
        validate(announcement);
        normalize(announcement);
        announcementMapper.insert(announcement);
        return announcement;
    }

    @Transactional
    public boolean update(Long id, Announcement announcement) {
        validate(announcement);
        normalize(announcement);
        announcement.setId(id);
        return announcementMapper.update(announcement) > 0;
    }

    @Transactional
    public boolean delete(Long id) {
        return announcementMapper.deleteById(id) > 0;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\service\CommitteeMemberService.java
--------------------------------------------------------------------------------

package com.village.committee.service;

import com.village.committee.common.PageResult;
import com.village.committee.common.Paging;
import com.village.committee.common.ValidationUtils;
import com.village.committee.domain.CommitteeMember;
import com.village.committee.mapper.CommitteeMemberMapper;
import java.time.LocalDateTime;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

/**
 * 村委会成员服务类
 */
@Service
public class CommitteeMemberService {

    private final CommitteeMemberMapper committeeMemberMapper;

    public CommitteeMemberService(CommitteeMemberMapper committeeMemberMapper) {
        this.committeeMemberMapper = committeeMemberMapper;
    }

    @Transactional(readOnly = true)
    public List<CommitteeMember> list() {
        return committeeMemberMapper.findAll();
    }

    @Transactional(readOnly = true)
    public List<CommitteeMember> listActive() {
        return committeeMemberMapper.findActive();
    }

    @Transactional(readOnly = true)
    public long countAll() {
        return committeeMemberMapper.count(null);
    }

    @Transactional(readOnly = true)
    public long countSince(LocalDateTime from) {
        return committeeMemberMapper.countSince(from);
    }

    @Transactional(readOnly = true)
    public PageResult<CommitteeMember> page(String q, Integer page, Integer size) {
        String query = Paging.normalizeQuery(q);
        int p = Paging.normalizePage(page);
        int s = Paging.normalizeSize(size, 10, 100);

        long total = committeeMemberMapper.count(query);
        int offset = Paging.offset(p, s);

        // 超出页码时，返回空列表（不抛异常）
        if (total > 0 && offset >= total) {
            return new PageResult<>(List.of(), p, s, total);
        }

        List<CommitteeMember> items = committeeMemberMapper.findPage(query, offset, s);
        return new PageResult<>(items, p, s, total);
    }

    @Transactional(readOnly = true)
    public CommitteeMember get(Long id) {
        return committeeMemberMapper.findById(id);
    }

    /**
     * 验证村委会成员数据（抛异常）
     */
    public void validate(CommitteeMember member) {
        if (member == null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "成员信息不能为空");
        }

        // 姓名必填且必须是中文
        if (ValidationUtils.isBlank(member.getName())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "姓名不能为空");
        }

        String nameError = ValidationUtils.getChineseNameErrorMessage(member.getName());
        if (nameError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, nameError);
        }

        // 职务必填
        if (ValidationUtils.isBlank(member.getPosition())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职务不能为空");
        }

        String position = member.getPosition().trim();
        if (position.length() > 50) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职务不能超过50个字符");
        }

        // 职务安全校验
        String positionSafetyError = ValidationUtils.getContentSafetyErrorMessage(position);
        if (positionSafetyError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职务" + positionSafetyError);
        }

        // 电话号码校验（可选，但填了就必须正确）
        String phoneError = ValidationUtils.getPhoneErrorMessage(member.getPhone());
        if (phoneError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, phoneError);
        }

        // 职责描述校验（可选）
        if (member.getDuties() != null && !member.getDuties().trim().isEmpty()) {
            if (member.getDuties().length() > 500) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职责描述不能超过500个字符");
            }

            // 职责描述安全校验
            String dutiesSafetyError = ValidationUtils.getContentSafetyErrorMessage(member.getDuties());
            if (dutiesSafetyError != null) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职责描述" + dutiesSafetyError);
            }

            // 职责描述HTML校验 - 允许基本HTML标签
            String dutiesHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(
                member.getDuties(), true, "p", "br", "div", "span", "strong", "em", "ul", "ol", "li");
            if (dutiesHtmlError != null) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "职责描述" + dutiesHtmlError);
            }
        }

        // 任职时间校验
        if (member.getJoinTime() != null && member.getJoinTime().isAfter(LocalDateTime.now().plusDays(1))) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "任职时间不能是未来时间");
        }
    }

    /**
     * 验证并返回错误消息（用于MVC控制器）
     * @return 错误消息，null表示验证通过
     */
    public String validateAndGetError(CommitteeMember member) {
        if (member == null) {
            return "成员信息不能为空";
        }

        // 姓名必填且必须是中文
        if (ValidationUtils.isBlank(member.getName())) {
            return "姓名不能为空";
        }

        String nameError = ValidationUtils.getChineseNameErrorMessage(member.getName());
        if (nameError != null) {
            return nameError;
        }

        // 职务必填
        if (ValidationUtils.isBlank(member.getPosition())) {
            return "职务不能为空";
        }

        String position = member.getPosition().trim();
        if (position.length() > 50) {
            return "职务不能超过50个字符";
        }

        // 职务安全校验
        String positionSafetyError = ValidationUtils.getContentSafetyErrorMessage(position);
        if (positionSafetyError != null) {
            return "职务" + positionSafetyError;
        }

        // 电话号码校验（可选，但填了就必须正确）
        String phoneError = ValidationUtils.getPhoneErrorMessage(member.getPhone());
        if (phoneError != null) {
            return phoneError;
        }

        // 职责描述校验（可选）
        if (member.getDuties() != null && !member.getDuties().trim().isEmpty()) {
            if (member.getDuties().length() > 500) {
                return "职责描述不能超过500个字符";
            }

            // 职责描述安全校验
            String dutiesSafetyError = ValidationUtils.getContentSafetyErrorMessage(member.getDuties());
            if (dutiesSafetyError != null) {
                return "职责描述" + dutiesSafetyError;
            }

            // 职责描述HTML校验 - 允许基本HTML标签
            String dutiesHtmlError = ValidationUtils.getHtmlSafetyErrorMessage(
                member.getDuties(), true, "p", "br", "div", "span", "strong", "em", "ul", "ol", "li");
            if (dutiesHtmlError != null) {
                return "职责描述" + dutiesHtmlError;
            }
        }

        // 任职时间校验
        if (member.getJoinTime() != null && member.getJoinTime().isAfter(LocalDateTime.now().plusDays(1))) {
            return "任职时间不能是未来时间";
        }

        return null;
    }

    /**
     * 规范化数据
     */
    private void normalize(CommitteeMember member) {
        if (member.getName() != null) {
            member.setName(member.getName().trim());
        }
        if (member.getPosition() != null) {
            member.setPosition(member.getPosition().trim());
        }
        if (member.getPhone() != null) {
            // 电话号码去除空格和横线
            member.setPhone(member.getPhone().trim().replaceAll("[\s-]", ""));
        }
        if (member.getDuties() != null) {
            member.setDuties(member.getDuties().trim());
        }
        if (member.getIsActive() == null) {
            member.setIsActive(true); // 默认在职
        }
        if (member.getJoinTime() == null) {
            member.setJoinTime(LocalDateTime.now());
        }
    }

    @Transactional
    public CommitteeMember create(CommitteeMember member) {
        validate(member);
        normalize(member);
        committeeMemberMapper.insert(member);
        return member;
    }

    @Transactional
    public boolean update(Long id, CommitteeMember member) {
        validate(member);
        normalize(member);
        member.setId(id);
        return committeeMemberMapper.update(member) > 0;
    }

    @Transactional
    public boolean delete(Long id) {
        return committeeMemberMapper.deleteById(id) > 0;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\service\OperationLogService.java
--------------------------------------------------------------------------------

package com.village.committee.service;

import com.village.committee.common.PageResult;
import com.village.committee.common.Paging;
import com.village.committee.domain.OperationLog;
import com.village.committee.mapper.OperationLogMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpSession;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Map;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

@Service
public class OperationLogService {

    private static final String DEFAULT_OPERATOR = "SYSTEM";

    private final OperationLogMapper operationLogMapper;

    public OperationLogService(OperationLogMapper operationLogMapper) {
        this.operationLogMapper = operationLogMapper;
    }

    @Transactional
    public void log(HttpServletRequest request,
                    String operationType,
                    String targetType,
                    Long targetId,
                    String description) {

        OperationLog log = new OperationLog();
        log.setOperator(resolveOperator(request));
        log.setOperationType(operationType);
        log.setTargetType(targetType);
        log.setTargetId(targetId);
        log.setDescription(description);
        log.setIpAddress(resolveClientIp(request));
        log.setUserAgent(resolveUserAgent(request));
        log.setCreatedAt(LocalDateTime.now());

        operationLogMapper.insert(log);
    }

    @Transactional(readOnly = true)
    public List<OperationLog> list() {
        return operationLogMapper.findAll();
    }

    @Transactional(readOnly = true)
    public OperationLog get(Long id) {
        return operationLogMapper.findById(id);
    }

    @Transactional(readOnly = true)
    public PageResult<OperationLog> page(String q, String operationType, String targetType,
                                          Integer page, Integer size) {
        String query = Paging.normalizeQuery(q);
        String opType = Paging.normalizeQuery(operationType);
        String tgType = Paging.normalizeQuery(targetType);
        int p = Paging.normalizePage(page);
        int s = Paging.normalizeSize(size, 20, 100);

        long total = operationLogMapper.count(query, opType, tgType);
        int offset = Paging.offset(p, s);

        if (total > 0 && offset >= total) {
            return new PageResult<>(List.of(), p, s, total);
        }

        List<OperationLog> items = operationLogMapper.findPage(query, opType, tgType, offset, s);
        return new PageResult<>(items, p, s, total);
    }

    @Transactional(readOnly = true)
    public List<OperationLog> latest(int limit) {
        if (limit <= 0) {
            limit = 10;
        }
        if (limit > 100) {
            limit = 100;
        }
        return operationLogMapper.findLatest(limit);
    }

    @Transactional(readOnly = true)
    public long countSince(LocalDateTime from) {
        return operationLogMapper.countSince(from);
    }

    @Transactional(readOnly = true)
    public long countToday() {
        LocalDateTime startOfToday = LocalDateTime.now()
                .withHour(0).withMinute(0).withSecond(0).withNano(0);
        return operationLogMapper.countSince(startOfToday);
    }

    @Transactional(readOnly = true)
    public List<String> getOperationTypes() {
        return operationLogMapper.findDistinctOperationTypes();
    }

    @Transactional(readOnly = true)
    public List<String> getTargetTypes() {
        return operationLogMapper.findDistinctTargetTypes();
    }

    @Transactional(readOnly = true)
    public long countAll() {
        return operationLogMapper.countAll();
    }

    @Transactional(readOnly = true)
    public long countByOperationType(String operationType) {
        return operationLogMapper.countByOperationType(operationType);
    }

    @Transactional(readOnly = true)
    public long countByTargetType(String targetType) {
        return operationLogMapper.countByTargetType(targetType);
    }

    @Transactional(readOnly = true)
    public List<Map<String, Object>> getRecentOperationStats(int days) {
        return operationLogMapper.getRecentOperationStats(days);
    }

    private String resolveOperator(HttpServletRequest request) {
        if (request == null) {
            return DEFAULT_OPERATOR;
        }

        String remoteUser = request.getRemoteUser();
        if (StringUtils.hasText(remoteUser)) {
            return remoteUser.trim();
        }

        HttpSession session = request.getSession(false);
        if (session != null) {
            Object u1 = session.getAttribute("username");
            if (u1 != null && StringUtils.hasText(String.valueOf(u1))) {
                return String.valueOf(u1).trim();
            }
            Object u2 = session.getAttribute("user");
            if (u2 != null && StringUtils.hasText(String.valueOf(u2))) {
                return String.valueOf(u2).trim();
            }
        }

        String headerOp = request.getHeader("X-Operator");
        if (StringUtils.hasText(headerOp)) {
            return headerOp.trim();
        }

        return DEFAULT_OPERATOR;
    }

    private String resolveClientIp(HttpServletRequest request) {
        if (request == null) {
            return "";
        }

        String xff = request.getHeader("X-Forwarded-For");
        if (StringUtils.hasText(xff)) {
            String first = xff.split(",")[0].trim();
            if (StringUtils.hasText(first)) {
                return first;
            }
        }

        String realIp = request.getHeader("X-Real-IP");
        if (StringUtils.hasText(realIp)) {
            return realIp.trim();
        }

        String ra = request.getRemoteAddr();
        return ra == null ? "" : ra;
    }

    private String resolveUserAgent(HttpServletRequest request) {
        if (request == null) {
            return "";
        }
        String ua = request.getHeader("User-Agent");
        return ua == null ? "" : ua;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\service\ResidentService.java
--------------------------------------------------------------------------------


package com.village.committee.service;

import com.village.committee.common.PageResult;
import com.village.committee.common.Paging;
import com.village.committee.common.ValidationUtils;
import com.village.committee.domain.Resident;
import com.village.committee.mapper.ResidentMapper;
import java.time.LocalDateTime;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

@Service
public class ResidentService {

    private final ResidentMapper residentMapper;

    public ResidentService(ResidentMapper residentMapper) {
        this.residentMapper = residentMapper;
    }

    @Transactional(readOnly = true)
    public List<Resident> list() {
        return residentMapper.findAll();
    }

    @Transactional(readOnly = true)
    public long countAll() {
        return residentMapper.count(null);
    }

    @Transactional(readOnly = true)
    public long countSince(LocalDateTime from) {
        return residentMapper.countSince(from);
    }

    @Transactional(readOnly = true)
    public PageResult<Resident> page(String q, Integer page, Integer size) {
        String query = Paging.normalizeQuery(q);
        int p = Paging.normalizePage(page);
        int s = Paging.normalizeSize(size, 10, 100);

        long total = residentMapper.count(query);
        int offset = Paging.offset(p, s);

        // 超出页码时，返回空列表（不抛异常）
        if (total > 0 && offset >= total) {
            return new PageResult<>(List.of(), p, s, total);
        }

        List<Resident> items = residentMapper.findPage(query, offset, s);
        return new PageResult<>(items, p, s, total);
    }

    @Transactional(readOnly = true)
    public List<Resident> findPage(String q, int offset, int limit) {
        return residentMapper.findPage(q, offset, limit);
    }

    @Transactional(readOnly = true)
    public List<Resident> export(String q) {
        String query = Paging.normalizeQuery(q);
        return residentMapper.findPage(query, 0, 10_000);
    }

    @Transactional(readOnly = true)
    public Resident get(Long id) {
        return residentMapper.findById(id);
    }

    /**
     * 验证村民数据
     * @throws ResponseStatusException 如果验证失败
     */
    public void validate(Resident resident) {
        if (resident == null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "村民信息不能为空");
        }

        // 姓名必填且必须是中文
        if (ValidationUtils.isBlank(resident.getName())) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "姓名不能为空");
        }

        String nameError = ValidationUtils.getChineseNameErrorMessage(resident.getName());
        if (nameError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, nameError);
        }

        // 身份证号校验（可选，但填了就必须正确）
        String idCardError = ValidationUtils.getIdCardErrorMessage(resident.getIdCard());
        if (idCardError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, idCardError);
        }

        // 如果身份证号有效，计算年龄并验证
        if (resident.getIdCard() != null && !resident.getIdCard().trim().isEmpty() && ValidationUtils.isValidIdCard(resident.getIdCard())) {
            Integer age = ValidationUtils.calculateAgeFromIdCard(resident.getIdCard());
            String ageError = ValidationUtils.getAgeErrorMessage(age);
            if (ageError != null) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "根据身份证计算的年龄" + ageError);
            }
        }

        // 电话号码校验（可选，但填了就必须正确）
        String phoneError = ValidationUtils.getPhoneErrorMessage(resident.getPhone());
        if (phoneError != null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, phoneError);
        }

        // 地址校验
        if (resident.getAddress() != null && !resident.getAddress().trim().isEmpty()) {
            if (resident.getAddress().length() > 255) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "地址不能超过255个字符");
            }
            
            String addressError = ValidationUtils.getAddressErrorMessage(resident.getAddress());
            if (addressError != null) {
                throw new ResponseStatusException(HttpStatus.BAD_REQUEST, addressError);
            }
        }
    }

    /**
     * 验证并返回错误消息（用于MVC控制器）
     * @return 错误消息，null表示验证通过
     */
    public String validateAndGetError(Resident resident) {
        if (resident == null) {
            return "村民信息不能为空";
        }

        if (ValidationUtils.isBlank(resident.getName())) {
            return "姓名不能为空";
        }

        String nameError = ValidationUtils.getChineseNameErrorMessage(resident.getName());
        if (nameError != null) {
            return nameError;
        }

        String idCardError = ValidationUtils.getIdCardErrorMessage(resident.getIdCard());
        if (idCardError != null) {
            return idCardError;
        }

        // 如果身份证号有效，计算年龄并验证
        if (resident.getIdCard() != null && !resident.getIdCard().trim().isEmpty() && ValidationUtils.isValidIdCard(resident.getIdCard())) {
            Integer age = ValidationUtils.calculateAgeFromIdCard(resident.getIdCard());
            String ageError = ValidationUtils.getAgeErrorMessage(age);
            if (ageError != null) {
                return "根据身份证计算的年龄" + ageError;
            }
        }

        String phoneError = ValidationUtils.getPhoneErrorMessage(resident.getPhone());
        if (phoneError != null) {
            return phoneError;
        }

        if (resident.getAddress() != null && !resident.getAddress().trim().isEmpty()) {
            if (resident.getAddress().length() > 255) {
                return "地址不能超过255个字符";
            }
            
            String addressError = ValidationUtils.getAddressErrorMessage(resident.getAddress());
            if (addressError != null) {
                return addressError;
            }
        }

        return null;
    }

    /**
     * 规范化村民数据（去除首尾空格、统一大小写等）
     */
    private void normalize(Resident resident) {
        if (resident.getName() != null) {
            resident.setName(resident.getName().trim());
        }
        if (resident.getIdCard() != null) {
            // 身份证号统一大写，去除空格
            resident.setIdCard(resident.getIdCard().trim().toUpperCase());
        }
        if (resident.getPhone() != null) {
            // 电话号码去除空格和横线
            resident.setPhone(resident.getPhone().trim().replaceAll("[\\s-]", ""));
        }
        if (resident.getAddress() != null) {
            resident.setAddress(resident.getAddress().trim());
        }
    }

    @Transactional
    public Resident create(Resident resident) {
        validate(resident);
        normalize(resident);
        residentMapper.insert(resident);
        return resident;
    }

    @Transactional
    public boolean update(Long id, Resident resident) {
        validate(resident);
        normalize(resident);
        resident.setId(id);
        return residentMapper.update(resident) > 0;
    }

    @Transactional
    public boolean delete(Long id) {
        return residentMapper.deleteById(id) > 0;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\AnnouncementController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.common.PageResult;
import com.village.committee.domain.Announcement;
import com.village.committee.service.AnnouncementService;
import com.village.committee.service.OperationLogService;
import jakarta.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

@Controller
@RequestMapping("/announcements")
public class AnnouncementController {

    private final AnnouncementService announcementService;
    private final OperationLogService operationLogService;

    public AnnouncementController(AnnouncementService announcementService,
                                  OperationLogService operationLogService) {
        this.announcementService = announcementService;
        this.operationLogService = operationLogService;
    }

    @GetMapping
    public String list(Model model,
                       @RequestParam(value = "q", required = false) String q,
                       @RequestParam(value = "page", required = false) Integer page,
                       @RequestParam(value = "size", required = false) Integer size,
                       @ModelAttribute("flash") String flash) {

        PageResult<Announcement> result = announcementService.page(q, page, size);

        // 兼容 list.jsp 里使用 ${announcements}
        model.addAttribute("announcements", result.getItems());

        model.addAttribute("page", result);
        model.addAttribute("q", q);
        return "announcements/list";
    }

    @GetMapping("/new")
    public String createForm(ModelMap model) {
        // 支持 redirect 后的 flash 回填（若之前校验失败带回 announcement）
        if (!model.containsAttribute("announcement")) {
            Announcement announcement = new Announcement();
            announcement.setPublishTime(LocalDateTime.now());
            announcement.setStatus(1); // 默认发布状态
            announcement.setIsTop(false);
            model.addAttribute("announcement", announcement);
        } else {
            Object obj = model.get("announcement");
            if (obj instanceof Announcement a) {
                if (a.getPublishTime() == null) a.setPublishTime(LocalDateTime.now());
                if (a.getStatus() == null) a.setStatus(1);
                if (a.getIsTop() == null) a.setIsTop(false);
            }
        }

        model.addAttribute("mode", "create");
        return "announcements/form";
    }

    /**
     * ✅ 关键修复：补上详情页 GET 映射
     * 这样 /announcements/1 不会再 405，也不会再返回 JSON
     */
    @GetMapping("/{id}")
    public String detail(@PathVariable("id") Long id, Model model) {
        Announcement a = announcementService.get(id);
        if (a == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Announcement not found: " + id);
        }
        model.addAttribute("announcement", a);
        return "announcements/detail";
    }

    @PostMapping
    public String create(@ModelAttribute Announcement announcement,
                         @RequestParam(value = "publishTime", required = false) String publishTimeStr,
                         RedirectAttributes ra,
                         HttpServletRequest request) {

        parsePublishTime(announcement, publishTimeStr);

        String error = announcementService.validateAndGetError(announcement);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            ra.addFlashAttribute("announcement", announcement);
            return "redirect:/announcements/new";
        }

        try {
            Announcement created = announcementService.create(announcement);
            operationLogService.log(request, "CREATE", "ANNOUNCEMENT", created.getId(),
                    "新增公告: " + created.getTitle());
            ra.addFlashAttribute("flash", "发布成功，ID=" + created.getId());
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/announcements/new";
        }

        return "redirect:/announcements";
    }

    @GetMapping("/{id}/edit")
    public String editForm(@PathVariable("id") Long id, Model model) {
        Announcement a = announcementService.get(id);
        if (a == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Announcement not found: " + id);
        }
        model.addAttribute("announcement", a);
        model.addAttribute("mode", "edit");
        return "announcements/form";
    }

    @PostMapping("/{id}")
    public String update(@PathVariable("id") Long id,
                         @ModelAttribute Announcement announcement,
                         @RequestParam(value = "publishTime", required = false) String publishTimeStr,
                         RedirectAttributes ra,
                         HttpServletRequest request) {

        parsePublishTime(announcement, publishTimeStr);

        String error = announcementService.validateAndGetError(announcement);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/announcements/" + id + "/edit";
        }

        try {
            boolean ok = announcementService.update(id, announcement);
            if (!ok) {
                throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Announcement not found: " + id);
            }
            operationLogService.log(request, "UPDATE", "ANNOUNCEMENT", id,
                    "更新公告: " + announcement.getTitle());
            ra.addFlashAttribute("flash", "修改成功，ID=" + id);
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            if (e.getStatusCode() == HttpStatus.NOT_FOUND) {
                throw e;
            }
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/announcements/" + id + "/edit";
        }

        return "redirect:/announcements";
    }

    @PostMapping("/{id}/delete")
    public String delete(@PathVariable("id") Long id,
                         RedirectAttributes ra,
                         HttpServletRequest request) {
        Announcement a = announcementService.get(id);
        if (a == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Announcement not found: " + id);
        }

        boolean ok = announcementService.delete(id);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Announcement not found: " + id);
        }

        operationLogService.log(request, "DELETE", "ANNOUNCEMENT", id,
                "删除公告: " + a.getTitle());
        ra.addFlashAttribute("flash", "删除成功，ID=" + id);
        ra.addFlashAttribute("flashType", "success");
        return "redirect:/announcements";
    }

    /**
     * 解析发布时间字符串
     */
    private void parsePublishTime(Announcement announcement, String publishTimeStr) {
        if (publishTimeStr != null && !publishTimeStr.trim().isEmpty()) {
            try {
                // HTML datetime-local 格式: yyyy-MM-ddTHH:mm
                DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm");
                announcement.setPublishTime(LocalDateTime.parse(publishTimeStr.trim(), formatter));
            } catch (DateTimeParseException e) {
                try {
                    DateTimeFormatter formatter2 = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm");
                    announcement.setPublishTime(LocalDateTime.parse(publishTimeStr.trim(), formatter2));
                } catch (DateTimeParseException e2) {
                    announcement.setPublishTime(LocalDateTime.now());
                }
            }
        } else {
            announcement.setPublishTime(LocalDateTime.now());
        }
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\CommitteeMemberController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.common.PageResult;
import com.village.committee.domain.CommitteeMember;
import com.village.committee.service.CommitteeMemberService;
import com.village.committee.service.OperationLogService;
import jakarta.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

/**
 * 村委会成员控制器
 */
@Controller
@RequestMapping("/committee-members")
public class CommitteeMemberController {

    private final CommitteeMemberService committeeMemberService;
    private final OperationLogService operationLogService;

    public CommitteeMemberController(CommitteeMemberService committeeMemberService,
                                     OperationLogService operationLogService) {
        this.committeeMemberService = committeeMemberService;
        this.operationLogService = operationLogService;
    }

    @GetMapping
    public String list(Model model,
                      @RequestParam(value = "q", required = false) String q,
                      @RequestParam(value = "page", required = false) Integer page,
                      @RequestParam(value = "size", required = false) Integer size,
                      @ModelAttribute("flash") String flash) {

        PageResult<CommitteeMember> result = committeeMemberService.page(q, page, size);
        model.addAttribute("page", result);
        model.addAttribute("q", q);
        return "committee-members/list";
    }

    @GetMapping("/new")
    public String createForm(Model model) {
        model.addAttribute("member", new CommitteeMember());
        model.addAttribute("mode", "create");
        return "committee-members/form";
    }

    @GetMapping("/{id}")
    public String detail(@PathVariable("id") Long id, Model model) {
        CommitteeMember member = committeeMemberService.get(id);
        if (member == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }
        model.addAttribute("member", member);
        return "committee-members/detail";
    }

    @PostMapping
    public String create(@ModelAttribute CommitteeMember member,
                        @RequestParam(value = "joinTime", required = false) String joinTimeStr,
                        RedirectAttributes ra,
                        HttpServletRequest request) {

        parseJoinTime(member, joinTimeStr);

        String error = committeeMemberService.validateAndGetError(member);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            ra.addFlashAttribute("member", member);
            return "redirect:/committee-members/new";
        }

        try {
            CommitteeMember created = committeeMemberService.create(member);
            operationLogService.log(request, "CREATE", "COMMITTEE_MEMBER", created.getId(),
                    "新增村委会成员: " + created.getName() + " (" + created.getPosition() + ")");
            ra.addFlashAttribute("flash", "新增成功，ID=" + created.getId());
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/committee-members/new";
        }

        return "redirect:/committee-members";
    }

    @GetMapping("/{id}/edit")
    public String editForm(@PathVariable("id") Long id, Model model) {
        CommitteeMember member = committeeMemberService.get(id);
        if (member == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }
        model.addAttribute("member", member);
        model.addAttribute("mode", "edit");
        return "committee-members/form";
    }

    @PostMapping("/{id}")
    public String update(@PathVariable("id") Long id,
                         @ModelAttribute CommitteeMember member,
                         @RequestParam(value = "joinTime", required = false) String joinTimeStr,
                         RedirectAttributes ra,
                         HttpServletRequest request) {

        parseJoinTime(member, joinTimeStr);

        String error = committeeMemberService.validateAndGetError(member);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/committee-members/" + id + "/edit";
        }

        try {
            boolean ok = committeeMemberService.update(id, member);
            if (!ok) {
                throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
            }
            operationLogService.log(request, "UPDATE", "COMMITTEE_MEMBER", id,
                    "更新村委会成员: " + member.getName() + " (" + member.getPosition() + ")");
            ra.addFlashAttribute("flash", "修改成功，ID=" + id);
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            if (e.getStatusCode() == HttpStatus.NOT_FOUND) {
                throw e;
            }
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/committee-members/" + id + "/edit";
        }

        return "redirect:/committee-members";
    }

    @PostMapping("/{id}/delete")
    public String delete(@PathVariable("id") Long id,
                         RedirectAttributes ra,
                         HttpServletRequest request) {
        CommitteeMember member = committeeMemberService.get(id);
        if (member == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }

        boolean ok = committeeMemberService.delete(id);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }

        operationLogService.log(request, "DELETE", "COMMITTEE_MEMBER", id,
                "删除村委会成员: " + member.getName() + " (" + member.getPosition() + ")");
        ra.addFlashAttribute("flash", "删除成功，ID=" + id);
        ra.addFlashAttribute("flashType", "success");
        return "redirect:/committee-members";
    }

    /**
     * 解析任职时间字符串
     */
    private void parseJoinTime(CommitteeMember member, String joinTimeStr) {
        if (joinTimeStr != null && !joinTimeStr.trim().isEmpty()) {
            try {
                // HTML datetime-local 格式: yyyy-MM-ddTHH:mm
                DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm");
                member.setJoinTime(LocalDateTime.parse(joinTimeStr.trim(), formatter));
            } catch (DateTimeParseException e) {
                try {
                    DateTimeFormatter formatter2 = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm");
                    member.setJoinTime(LocalDateTime.parse(joinTimeStr.trim(), formatter2));
                } catch (DateTimeParseException e2) {
                    member.setJoinTime(LocalDateTime.now());
                }
            }
        } else {
            member.setJoinTime(LocalDateTime.now());
        }
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\DbController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.mapper.HealthMapper;
import com.village.committee.config.DatabaseInitializer;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@RequestMapping("/db")
public class DbController {

    private final HealthMapper healthMapper;
    private final DatabaseInitializer databaseInitializer;

    public DbController(HealthMapper healthMapper, DatabaseInitializer databaseInitializer) {
        this.healthMapper = healthMapper;
        this.databaseInitializer = databaseInitializer;
    }

    @GetMapping(value = "/ping", produces = "text/plain; charset=UTF-8")
    @ResponseBody
    public String ping() {
        try {
            return "DB ping result: " + healthMapper.ping();
        } catch (Exception ex) {
            return "DB ping failed: " + ex.getClass().getSimpleName() + " - " + ex.getMessage();
        }
    }
    
    @GetMapping(value = "/init", produces = "text/plain; charset=UTF-8")
    @ResponseBody
    public String initDatabase() {
        try {
            // 手动触发数据库初始化
            databaseInitializer.init();
            return "Database initialization completed successfully";
        } catch (Exception ex) {
            return "Database initialization failed: " + ex.getClass().getSimpleName() + " - " + ex.getMessage();
        }
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\GlobalMvcExceptionHandler.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.web.filter.RequestIdFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.server.ResponseStatusException;

@ControllerAdvice(annotations = Controller.class)
public class GlobalMvcExceptionHandler {

    @ExceptionHandler(ResponseStatusException.class)
    public String handleRse(ResponseStatusException ex, HttpServletRequest req, HttpServletResponse resp, Model model) {
        int status = ex.getStatusCode().value();
        resp.setStatus(status);

        model.addAttribute("status", status);
        model.addAttribute("error", ex.getStatusCode().toString());
        model.addAttribute("message", ex.getReason());
        model.addAttribute("path", req.getRequestURI());
        model.addAttribute("requestId", req.getAttribute(RequestIdFilter.ATTR_REQUEST_ID));
        return "error";
    }

    @ExceptionHandler(Exception.class)
    public String handleAny(Exception ex, HttpServletRequest req, HttpServletResponse resp, Model model) {
        resp.setStatus(HttpStatus.INTERNAL_SERVER_ERROR.value());

        model.addAttribute("status", 500);
        model.addAttribute("error", "INTERNAL_SERVER_ERROR");
        model.addAttribute("message", ex.getMessage());
        model.addAttribute("path", req.getRequestURI());
        model.addAttribute("requestId", req.getAttribute(RequestIdFilter.ATTR_REQUEST_ID));
        return "error";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\HomeController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.service.AnnouncementService;
import com.village.committee.service.OperationLogService;
import com.village.committee.service.ResidentService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HomeController {

    private final AnnouncementService announcementService;
    private final ResidentService residentService;
    private final OperationLogService operationLogService;

    public HomeController(AnnouncementService announcementService,
                          ResidentService residentService,
                          OperationLogService operationLogService) {
        this.announcementService = announcementService;
        this.residentService = residentService;
        this.operationLogService = operationLogService;
    }

    @GetMapping(value = {"/", "/home"})
    public String home(Model model) {
        model.addAttribute("message", "欢迎使用网上村委会业务办理系统");

        model.addAttribute("residentTotal", residentService.countAll());
        model.addAttribute("announcementTotal", announcementService.countAll());

        // 最近公告（用于"最近公告"板块）
        model.addAttribute("recentAnnouncements", announcementService.latest(5));

        // 最近操作日志（用于"最近操作"板块）
        model.addAttribute("recentLogs", operationLogService.latest(5));

        return "home";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\OperationLogController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.common.PageResult;
import com.village.committee.domain.OperationLog;
import com.village.committee.service.OperationLogService;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;

@Controller
@RequestMapping("/logs")
public class OperationLogController {

    private final OperationLogService operationLogService;

    public OperationLogController(OperationLogService operationLogService) {
        this.operationLogService = operationLogService;
    }

    @GetMapping
    public String list(Model model,
                       @RequestParam(value = "q", required = false) String q,
                       @RequestParam(value = "operationType", required = false) String operationType,
                       @RequestParam(value = "targetType", required = false) String targetType,
                       @RequestParam(value = "page", required = false) Integer page,
                       @RequestParam(value = "size", required = false) Integer size) {

        PageResult<OperationLog> result = operationLogService.page(q, operationType, targetType, page, size);

        model.addAttribute("page", result);
        model.addAttribute("q", q);
        model.addAttribute("operationType", operationType);
        model.addAttribute("targetType", targetType);
        model.addAttribute("operationTypes", operationLogService.getOperationTypes());
        model.addAttribute("targetTypes", operationLogService.getTargetTypes());

        return "logs/list";
    }

    @GetMapping("/{id}")
    public String detail(@PathVariable("id") Long id, Model model) {
        OperationLog log = operationLogService.get(id);
        if (log == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Operation log not found: " + id);
        }
        model.addAttribute("log", log);
        return "logs/detail";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\ResidentController.java
--------------------------------------------------------------------------------


package com.village.committee.web;

import com.village.committee.common.PageResult;
import com.village.committee.common.Paging;
import com.village.committee.domain.Resident;
import com.village.committee.service.OperationLogService;
import com.village.committee.service.ResidentService;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.PrintWriter;
import java.nio.charset.StandardCharsets;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

@Controller
@RequestMapping("/residents")
public class ResidentController {

    private final ResidentService residentService;
    private final OperationLogService operationLogService;

    public ResidentController(ResidentService residentService, OperationLogService operationLogService) {
        this.residentService = residentService;
        this.operationLogService = operationLogService;
    }

    @GetMapping
    public String list(Model model,
                       @RequestParam(value = "q", required = false) String q,
                       @RequestParam(value = "page", required = false) Integer page,
                       @RequestParam(value = "size", required = false) Integer size,
                       @ModelAttribute("flash") String flash) {

        PageResult<Resident> result = residentService.page(q, page, size);
        model.addAttribute("page", result);
        model.addAttribute("q", q);
        return "residents/list";
    }

    @GetMapping(value = "/export.csv")
    public void exportCsv(@RequestParam(value = "q", required = false) String q,
                          HttpServletResponse resp) {
        resp.setCharacterEncoding(StandardCharsets.UTF_8.name());
        resp.setContentType("text/csv; charset=UTF-8");
        resp.setHeader("Content-Disposition", "attachment; filename=\"residents.csv\"");

        try (PrintWriter w = resp.getWriter()) {
            // UTF-8 BOM (Excel 兼容)
            w.write('\uFEFF');
            w.println("id,name,idCard,phone,address,createdAt");

            // 流式查询
            String query = Paging.normalizeQuery(q);
            int batchSize = 1000;
            int offset = 0;

            while (true) {
                List<Resident> batch = residentService.findPage(query, offset, batchSize);
                if (batch.isEmpty()) break;

                for (Resident r : batch) {
                    w.print(csvSafe(r.getId()));
                    w.print(",");
                    w.print(csvSafe(r.getName()));
                    w.print(",");
                    w.print(csvSafe(r.getIdCard()));
                    w.print(",");
                    w.print(csvSafe(r.getPhone()));
                    w.print(",");
                    w.print(csvSafe(r.getAddress()));
                    w.print(",");
                    w.println(csvSafe(r.getCreatedAt()));
                }
                w.flush();
                offset += batchSize;

                // 防止内存占用过大
                if (offset > 100000) break;
            }
        } catch (Exception ex) {
            throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "CSV export failed: " + ex.getMessage(), ex);
        }
    }

    /**
     * CSV 安全转义（防止CSV注入攻击）
     * - 如果值以 =、+、-、@ 开头，添加单引号前缀
     * - 处理逗号、引号、换行
     */
    private String csvSafe(Object v) {
        if (v == null) return "";
        String s = String.valueOf(v);
        if (s.isEmpty()) return "";

        // 防止CSV注入：如果以危险字符开头，添加单引号
        char first = s.charAt(0);
        if (first == '=' || first == '+' || first == '-' || first == '@' || first == '\t' || first == '\r') {
            s = "'" + s;
        }

        boolean needQuote = s.contains(",") || s.contains("\"") || s.contains("\n") || s.contains("\r");
        if (!needQuote) return s;
        return "\"" + s.replace("\"", "\"\"") + "\"";
    }

    @GetMapping("/new")
    public String createForm(Model model) {
        model.addAttribute("resident", new Resident());
        model.addAttribute("mode", "create");
        return "residents/form";
    }

    @PostMapping
    public String create(@ModelAttribute Resident resident, RedirectAttributes ra, HttpServletRequest request) {
        // 使用Service层验证
        String error = residentService.validateAndGetError(resident);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            ra.addFlashAttribute("resident", resident); // 保留用户输入
            return "redirect:/residents/new";
        }

        try {
            Resident created = residentService.create(resident);
            operationLogService.log(request, "CREATE", "RESIDENT", created.getId(), "新增村民: " + created.getName());
            ra.addFlashAttribute("flash", "新增成功，ID=" + created.getId());
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/residents/new";
        }

        return "redirect:/residents";
    }

    @GetMapping("/{id}/edit")
    public String editForm(@PathVariable("id") Long id, Model model) {
        Resident r = residentService.get(id);
        if (r == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }
        model.addAttribute("resident", r);
        model.addAttribute("mode", "edit");
        return "residents/form";
    }

    @PostMapping("/{id}")
    public String update(@PathVariable("id") Long id, @ModelAttribute Resident resident, RedirectAttributes ra, HttpServletRequest request) {
        // 使用Service层验证
        String error = residentService.validateAndGetError(resident);
        if (error != null) {
            ra.addFlashAttribute("flash", error);
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/residents/" + id + "/edit";
        }

        try {
            boolean ok = residentService.update(id, resident);
            if (!ok) {
                throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
            }
            operationLogService.log(request, "UPDATE", "RESIDENT", id, "更新村民: " + resident.getName());
            ra.addFlashAttribute("flash", "修改成功，ID=" + id);
            ra.addFlashAttribute("flashType", "success");
        } catch (ResponseStatusException e) {
            if (e.getStatusCode() == HttpStatus.NOT_FOUND) {
                throw e;
            }
            ra.addFlashAttribute("flash", e.getReason());
            ra.addFlashAttribute("flashType", "danger");
            return "redirect:/residents/" + id + "/edit";
        }

        return "redirect:/residents";
    }

    @PostMapping("/{id}/delete")
    public String delete(@PathVariable("id") Long id, RedirectAttributes ra, HttpServletRequest request) {
        Resident r = residentService.get(id);
        if (r == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }

        boolean ok = residentService.delete(id);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }

        operationLogService.log(request, "DELETE", "RESIDENT", id, "删除村民: " + r.getName());
        ra.addFlashAttribute("flash", "删除成功，ID=" + id);
        ra.addFlashAttribute("flashType", "success");
        return "redirect:/residents";
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\SystemController.java
--------------------------------------------------------------------------------

package com.village.committee.web;

import com.village.committee.service.AnnouncementService;
import com.village.committee.service.CommitteeMemberService;
import com.village.committee.service.OperationLogService;
import com.village.committee.service.ResidentService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * 系统监控控制器
 */
@Controller
@RequestMapping("/system")
public class SystemController {

    private final ResidentService residentService;
    private final AnnouncementService announcementService;
    private final CommitteeMemberService committeeMemberService;
    private final OperationLogService operationLogService;

    public SystemController(ResidentService residentService,
                           AnnouncementService announcementService,
                           CommitteeMemberService committeeMemberService,
                           OperationLogService operationLogService) {
        this.residentService = residentService;
        this.announcementService = announcementService;
        this.committeeMemberService = committeeMemberService;
        this.operationLogService = operationLogService;
    }

    /**
     * 系统监控仪表盘
     */
    @GetMapping("/dashboard")
    public String dashboard(Model model) {
        // 添加基本统计数据
        model.addAttribute("residentCount", residentService.countAll());
        model.addAttribute("announcementCount", announcementService.countAll());
        model.addAttribute("memberCount", committeeMemberService.countAll());
        model.addAttribute("logCount", operationLogService.countAll());

        return "system/dashboard";
    }

    /**
     * 获取系统统计数据（用于图表）
     */
    @GetMapping("/stats")
    @ResponseBody
    public Map<String, Object> getSystemStats() {
        Map<String, Object> result = new HashMap<>();

        // 操作类型统计
        Map<String, Integer> operationTypes = new HashMap<>();
        operationTypes.put("CREATE", (int) operationLogService.countByOperationType("CREATE"));
        operationTypes.put("UPDATE", (int) operationLogService.countByOperationType("UPDATE"));
        operationTypes.put("DELETE", (int) operationLogService.countByOperationType("DELETE"));
        result.put("operationTypes", operationTypes);

        // 目标类型统计
        Map<String, Integer> targetTypes = new HashMap<>();
        targetTypes.put("RESIDENT", (int) operationLogService.countByTargetType("RESIDENT"));
        targetTypes.put("ANNOUNCEMENT", (int) operationLogService.countByTargetType("ANNOUNCEMENT"));
        targetTypes.put("COMMITTEE_MEMBER", (int) operationLogService.countByTargetType("COMMITTEE_MEMBER"));
        result.put("targetTypes", targetTypes);

        // 最近7天操作统计
        List<Map<String, Object>> recentOperations = operationLogService.getRecentOperationStats(7);
        result.put("recentOperations", recentOperations);

        // 系统信息
        Map<String, Object> systemInfo = new HashMap<>();
        systemInfo.put("currentTime", LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
        systemInfo.put("uptime", "5天12小时34分钟"); // 示例数据，实际应从系统获取
        systemInfo.put("memoryUsage", "256MB / 1GB"); // 示例数据，实际应从系统获取
        result.put("systemInfo", systemInfo);

        return result;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\AnnouncementApiController.java
--------------------------------------------------------------------------------

package com.village.committee.web.api;

import com.village.committee.domain.Announcement;
import com.village.committee.service.AnnouncementService;
import java.util.List;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;

import static org.springframework.http.HttpStatus.*;

@RestController
@RequestMapping("/api/announcements")
public class AnnouncementApiController {

    private final AnnouncementService announcementService;

    public AnnouncementApiController(AnnouncementService announcementService) {
        this.announcementService = announcementService;
    }

    @GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)
    public List<Announcement> list() {
        return announcementService.list();
    }

    @GetMapping(value = "/{id}", produces = MediaType.APPLICATION_JSON_VALUE)
    public Announcement get(@PathVariable("id") Long id) {
        Announcement a = announcementService.get(id);
        if (a == null) {
            throw new ResponseStatusException(NOT_FOUND, "Announcement not found: " + id);
        }
        return a;
    }

    @PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity<Announcement> create(@RequestBody Announcement announcement) {
        validate(announcement); // ✅ 关键：调用校验方法，让它“被用起来”
        Announcement created = announcementService.create(announcement);
        return ResponseEntity.status(CREATED).body(created);
    }

    @PutMapping(value = "/{id}", consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public Announcement update(@PathVariable("id") Long id, @RequestBody Announcement announcement) {
        validate(announcement); // ✅ 关键：调用校验方法，让它“被用起来”
        if (!announcementService.update(id, announcement)) {
            throw new ResponseStatusException(NOT_FOUND, "Announcement not found: " + id);
        }
        Announcement updated = announcementService.get(id);
        // 正常情况下 updated 不为空；若极端情况为空，也返回请求体（已更新成功）
        return updated != null ? updated : announcement;
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable("id") Long id) {
        if (!announcementService.delete(id)) {
            throw new ResponseStatusException(NOT_FOUND, "Announcement not found: " + id);
        }
        return ResponseEntity.noContent().build();
    }

    /**
     * 服务端兜底校验（防止绕过前端直接提交空值/超长）
     */
    private void validate(Announcement a) {
        if (a == null) {
            throw new ResponseStatusException(BAD_REQUEST, "Request body is required");
        }

        String title = a.getTitle();
        String content = a.getContent();
        String publisher = a.getPublisher();

        if (isBlank(title)) {
            throw new ResponseStatusException(BAD_REQUEST, "title is required");
        }
        if (title.trim().length() > 100) { // 对应表结构 title VARCHAR(100)
            throw new ResponseStatusException(BAD_REQUEST, "title too long (max 100)");
        }

        if (isBlank(content)) {
            throw new ResponseStatusException(BAD_REQUEST, "content is required");
        }

        if (isBlank(publisher)) {
            throw new ResponseStatusException(BAD_REQUEST, "publisher is required");
        }
        if (publisher.trim().length() > 50) { // 对应表结构 publisher VARCHAR(50)
            throw new ResponseStatusException(BAD_REQUEST, "publisher too long (max 50)");
        }
    }

    private static boolean isBlank(String s) {
        return s == null || s.trim().isEmpty();
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\ApiError.java
--------------------------------------------------------------------------------

package com.village.committee.web.api;

import java.time.Instant;

public record ApiError(
        Instant timestamp,
        int status,
        String error,
        String message,
        String path,
        String requestId
) {}



--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\CommitteeMemberApiController.java
--------------------------------------------------------------------------------

package com.village.committee.web.api;

import com.village.committee.common.PageResult;
import com.village.committee.domain.CommitteeMember;
import com.village.committee.service.CommitteeMemberService;
import jakarta.servlet.http.HttpServletRequest;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;

/**
 * 村委会成员API控制器
 */
@RestController
@RequestMapping("/api/committee-members")
public class CommitteeMemberApiController {

    private final CommitteeMemberService committeeMemberService;

    public CommitteeMemberApiController(CommitteeMemberService committeeMemberService) {
        this.committeeMemberService = committeeMemberService;
    }

    /**
     * 获取所有成员
     */
    @GetMapping
    public ResponseEntity<PageResult<CommitteeMember>> list(
            @RequestParam(value = "q", required = false) String q,
            @RequestParam(value = "page", required = false) Integer page,
            @RequestParam(value = "size", required = false) Integer size) {

        PageResult<CommitteeMember> result = committeeMemberService.page(q, page, size);
        return ResponseEntity.ok(result);
    }

    /**
     * 获取在职成员
     */
    @GetMapping("/active")
    public ResponseEntity<List<CommitteeMember>> listActive() {
        List<CommitteeMember> members = committeeMemberService.listActive();
        return ResponseEntity.ok(members);
    }

    /**
     * 获取单个成员
     */
    @GetMapping("/{id}")
    public ResponseEntity<CommitteeMember> get(@PathVariable("id") Long id) {
        CommitteeMember member = committeeMemberService.get(id);
        if (member == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }
        return ResponseEntity.ok(member);
    }

    /**
     * 创建成员
     */
    @PostMapping
    public ResponseEntity<CommitteeMember> create(@RequestBody CommitteeMember member,
                                                   HttpServletRequest request) {
        committeeMemberService.validate(member);
        CommitteeMember created = committeeMemberService.create(member);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }

    /**
     * 更新成员
     */
    @PutMapping("/{id}")
    public ResponseEntity<CommitteeMember> update(@PathVariable("id") Long id,
                                                   @RequestBody CommitteeMember member) {
        committeeMemberService.validate(member);
        boolean ok = committeeMemberService.update(id, member);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }
        return ResponseEntity.ok(member);
    }

    /**
     * 删除成员
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable("id") Long id) {
        boolean ok = committeeMemberService.delete(id);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Committee member not found: " + id);
        }
        return ResponseEntity.noContent().build();
    }

    /**
     * 处理验证异常
     */
    @ExceptionHandler(ResponseStatusException.class)
    public ResponseEntity<ApiError> handleValidationException(ResponseStatusException ex, HttpServletRequest req) {
        int status = ex.getStatusCode().value();
        ApiError body = new ApiError(
                java.time.Instant.now(),
                status,
                ex.getStatusCode().toString(),
                ex.getReason(),
                req.getRequestURI(),
                null
        );
        return ResponseEntity.status(status).body(body);
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\GlobalApiExceptionHandler.java
--------------------------------------------------------------------------------

package com.village.committee.web.api;

import com.village.committee.web.filter.RequestIdFilter;
import jakarta.servlet.http.HttpServletRequest;
import java.time.Instant;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.server.ResponseStatusException;

@RestControllerAdvice(basePackages = "com.village.committee.web.api")
public class GlobalApiExceptionHandler {

    @ExceptionHandler(ResponseStatusException.class)
    public ResponseEntity<ApiError> handleResponseStatus(ResponseStatusException ex, HttpServletRequest req) {
        int status = ex.getStatusCode().value();
        ApiError body = new ApiError(
                Instant.now(),
                status,
                ex.getStatusCode().toString(),
                ex.getReason(),
                req.getRequestURI(),
                (String) req.getAttribute(RequestIdFilter.ATTR_REQUEST_ID)
        );
        return ResponseEntity.status(status).body(body);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiError> handleAny(Exception ex, HttpServletRequest req) {
        ApiError body = new ApiError(
                Instant.now(),
                500,
                "INTERNAL_SERVER_ERROR",
                ex.getMessage(),
                req.getRequestURI(),
                (String) req.getAttribute(RequestIdFilter.ATTR_REQUEST_ID)
        );
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(body);
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\HealthApiController.java
--------------------------------------------------------------------------------

package com.village.committee.web.api;

import com.village.committee.mapper.HealthMapper;
import java.time.Instant;
import java.util.LinkedHashMap;
import java.util.Map;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HealthApiController {

    private final HealthMapper healthMapper;

    public HealthApiController(HealthMapper healthMapper) {
        this.healthMapper = healthMapper;
    }

    @GetMapping("/api/health")
    public Map<String, Object> health() {
        Map<String, Object> m = new LinkedHashMap<>();
        boolean dbOk = false;

        try {
            String db = healthMapper.ping();
            dbOk = true;
            m.put("dbPing", db);
        } catch (Exception ex) {
            m.put("dbError", ex.getClass().getSimpleName() + ": " + ex.getMessage());
        }

        // 匹配前端期望的格式
        m.put("ok", true); // 应用本身是正常的
        m.put("dbOk", dbOk);
        m.put("version", "1.0.0"); // 添加版本信息
        m.put("uptime", "运行中"); // 添加运行状态信息
        m.put("time", Instant.now().toString());

        return m;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\api\ResidentApiController.java
--------------------------------------------------------------------------------


package com.village.committee.web.api;

import com.village.committee.common.PageResult;
import com.village.committee.domain.Resident;
import com.village.committee.service.ResidentService;
import java.util.List;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ResponseStatusException;

@RestController
@RequestMapping("/api/residents")
public class ResidentApiController {

    private final ResidentService residentService;

    public ResidentApiController(ResidentService residentService) {
        this.residentService = residentService;
    }

    @GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)
    public List<Resident> list() {
        return residentService.list();
    }

    @GetMapping(value = "/page", produces = MediaType.APPLICATION_JSON_VALUE)
    public PageResult<Resident> page(@RequestParam(value = "q", required = false) String q,
                                     @RequestParam(value = "page", required = false) Integer page,
                                     @RequestParam(value = "size", required = false) Integer size) {
        return residentService.page(q, page, size);
    }

    @GetMapping(value = "/{id}", produces = MediaType.APPLICATION_JSON_VALUE)
    public Resident get(@PathVariable("id") Long id) {
        Resident r = residentService.get(id);
        if (r == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }
        return r;
    }

    @PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity<Resident> create(@RequestBody Resident resident) {
        // Service层会自动验证
        Resident created = residentService.create(resident);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }

    @PutMapping(value = "/{id}", consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public Resident update(@PathVariable("id") Long id, @RequestBody Resident resident) {
        // Service层会自动验证
        boolean ok = residentService.update(id, resident);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }
        return residentService.get(id);
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable("id") Long id) {
        boolean ok = residentService.delete(id);
        if (!ok) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Resident not found: " + id);
        }
        return ResponseEntity.noContent().build();
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\filter\CsrfTokenFilter.java
--------------------------------------------------------------------------------

package com.village.committee.web.filter;

import jakarta.servlet.Filter;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.ServletRequest;
import jakarta.servlet.ServletResponse;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.UUID;

public class CsrfTokenFilter implements Filter {

    private static final String SESSION_KEY = "CSRF_TOKEN";
    private static final String PARAM = "_csrf";

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        String path = req.getRequestURI();
        // API 端不做 CSRF，方便你直接 curl / Postman 测试
        if (path != null && path.startsWith(req.getContextPath() + "/api/")) {
            chain.doFilter(request, response);
            return;
        }

        HttpSession session = req.getSession(true);
        String token = (String) session.getAttribute(SESSION_KEY);
        if (token == null || token.isBlank()) {
            token = UUID.randomUUID().toString().replace("-", "");
            session.setAttribute(SESSION_KEY, token);
        }

        // JSP 直接用 ${_csrf}
        req.setAttribute(PARAM, token);

        String method = req.getMethod();
        if (isStateChanging(method)) {
            String got = req.getParameter(PARAM);
            if (got == null || got.isBlank()) {
                got = req.getHeader("X-CSRF-TOKEN");
            }
            if (got == null || !token.equals(got)) {
                resp.setStatus(HttpServletResponse.SC_FORBIDDEN);
                resp.setCharacterEncoding(StandardCharsets.UTF_8.name());
                resp.setContentType("text/plain; charset=UTF-8");
                resp.getWriter().write("Forbidden (CSRF token missing or invalid)");
                return;
            }
        }

        chain.doFilter(request, response);
    }

    private boolean isStateChanging(String method) {
        if (method == null) return false;
        return switch (method) {
            case "POST", "PUT", "DELETE", "PATCH" -> true;
            default -> false;
        };
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\java\com\village\committee\web\filter\RequestIdFilter.java
--------------------------------------------------------------------------------

package com.village.committee.web.filter;

import jakarta.servlet.Filter;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.ServletRequest;
import jakarta.servlet.ServletResponse;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.UUID;
import org.slf4j.MDC;

public class RequestIdFilter implements Filter {

    public static final String ATTR_REQUEST_ID = "requestId";
    public static final String HEADER_REQUEST_ID = "X-Request-Id";

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        String rid = req.getHeader(HEADER_REQUEST_ID);
        if (rid == null || rid.isBlank()) {
            rid = UUID.randomUUID().toString();
        }

        req.setAttribute(ATTR_REQUEST_ID, rid);
        resp.setHeader(HEADER_REQUEST_ID, rid);

        MDC.put(ATTR_REQUEST_ID, rid);
        try {
            chain.doFilter(request, response);
        } finally {
            MDC.remove(ATTR_REQUEST_ID);
        }
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\resources\db.properties
--------------------------------------------------------------------------------

# 先保证能连接上 MySQL（库名随便：village_committee / test 都行）
db.url=jdbc:mysql://localhost:3306/village_committee?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
db.username=root
db.password=
db.driverClassName=com.mysql.cj.jdbc.Driver

db.maxPoolSize=10
db.minIdle=2




--------------------------------------------------------------------------------
文件路径: src\main\resources\schema.sql
--------------------------------------------------------------------------------

-- 先创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS village_committee CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE village_committee;

-- 村民表
CREATE TABLE IF NOT EXISTS residents (
  id BIGINT NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL,
  id_card VARCHAR(18) NULL,
  phone VARCHAR(20) NULL,
  address VARCHAR(255) NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  INDEX idx_name (name),
  INDEX idx_id_card (id_card),
  FULLTEXT INDEX ft_search (name, phone, address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 公告表（增加置顶和状态字段）
CREATE TABLE IF NOT EXISTS announcements (
  id BIGINT NOT NULL AUTO_INCREMENT,
  title VARCHAR(100) NOT NULL,
  content TEXT NOT NULL,
  publisher VARCHAR(50) NOT NULL,
  publish_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_top TINYINT(1) DEFAULT 0 COMMENT '是否置顶',
  status TINYINT(1) DEFAULT 1 COMMENT '0-草稿,1-发布',
  PRIMARY KEY (id),
  INDEX idx_status_publish (status, publish_time DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


-- 操作日志表
CREATE TABLE IF NOT EXISTS operation_logs (
  id BIGINT NOT NULL AUTO_INCREMENT,
  operator VARCHAR(50) NOT NULL COMMENT '操作人',
  operation_type VARCHAR(20) NOT NULL COMMENT '操作类型',
  target_type VARCHAR(20) NOT NULL COMMENT '目标类型',
  target_id BIGINT NOT NULL COMMENT '目标ID',
  description TEXT COMMENT '操作描述',
  ip_address VARCHAR(45) NULL,
  user_agent TEXT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  INDEX idx_operator_time (operator, created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 村委会成员表
CREATE TABLE IF NOT EXISTS committee_members (
  id BIGINT NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL COMMENT '姓名',
  position VARCHAR(50) NOT NULL COMMENT '职务',
  phone VARCHAR(20) NULL COMMENT '联系电话',
  duties TEXT NULL COMMENT '职责描述',
  join_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '任职时间',
  is_active TINYINT(1) DEFAULT 1 COMMENT '是否在职',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  INDEX idx_name (name),
  INDEX idx_position (position),
  INDEX idx_active (is_active),
  INDEX idx_join_time (join_time DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


--------------------------------------------------------------------------------
文件路径: src\main\webapp\static\css\dark-fix.css
--------------------------------------------------------------------------------

/* 暗色模式补丁：覆盖 Bootstrap 5.3 组件颜色与常用区域（尽量不改变布局） */

html[data-theme="dark"] {
  /* ===== 你项目的暗色基调 ===== */
  --yxk-bg: #0b1020;
  --yxk-surface: #111827;
  --yxk-surface-2: #0f172a;
  --yxk-text: #e5e7eb;
  --yxk-muted: #9ca3af;
  --yxk-border: rgba(255, 255, 255, 0.12);

  /* ===== 让 Bootstrap 5.3 组件跟随暗色 ===== */
  color-scheme: dark;
  --bs-body-bg: var(--yxk-bg);
  --bs-body-color: var(--yxk-text);

  --bs-secondary-color: var(--yxk-muted);
  --bs-tertiary-color: rgba(229, 231, 235, 0.65);
  --bs-emphasis-color: var(--yxk-text);

  --bs-border-color: var(--yxk-border);

  --bs-link-color: #93c5fd;
  --bs-link-hover-color: #bfdbfe;

  --bs-card-bg: var(--yxk-surface);
  --bs-card-cap-bg: var(--yxk-surface-2);

  --bs-list-group-bg: var(--yxk-surface);
  --bs-list-group-color: var(--yxk-text);
  --bs-list-group-border-color: var(--yxk-border);

  --bs-table-color: var(--yxk-text);
  --bs-table-bg: transparent;
  --bs-table-border-color: var(--yxk-border);
  --bs-table-striped-bg: rgba(255, 255, 255, 0.04);
  --bs-table-hover-bg: rgba(255, 255, 255, 0.06);

  --bs-pagination-bg: var(--yxk-surface);
  --bs-pagination-border-color: var(--yxk-border);
  --bs-pagination-color: var(--yxk-text);
  --bs-pagination-hover-bg: var(--yxk-surface-2);
  --bs-pagination-hover-color: var(--yxk-text);
  --bs-pagination-active-bg: #2563eb;
  --bs-pagination-active-border-color: #2563eb;
}

/* 页面整体（避免“文字仍是黑色”） */
html[data-theme="dark"] body {
  background-color: var(--bs-body-bg) !important;
  color: var(--bs-body-color) !important;
}

/* 你页面里大量用到的“soft 卡片” */
html[data-theme="dark"] .card,
html[data-theme="dark"] .card.soft {
  background-color: var(--bs-card-bg) !important;
  border-color: var(--bs-border-color) !important;
  color: var(--bs-body-color) !important;
}
html[data-theme="dark"] .card .card-header,
html[data-theme="dark"] .card.soft .card-header {
  background-color: var(--bs-card-cap-bg) !important;
  border-bottom-color: var(--bs-border-color) !important;
  color: var(--bs-body-color) !important;
}

/* 修复：最近公告/最近操作 list-group 背景总是白色 */
html[data-theme="dark"] .list-group-item {
  background-color: var(--bs-list-group-bg) !important;
  color: var(--bs-list-group-color) !important;
  border-color: var(--bs-list-group-border-color) !important;
}
html[data-theme="dark"] .list-group-item a {
  color: inherit;
}
html[data-theme="dark"] .list-group-item a:hover {
  color: var(--bs-link-hover-color);
}

/* 修复：text-muted 在暗色下太暗/发黑 */
html[data-theme="dark"] .text-muted {
  color: var(--bs-secondary-color) !important;
}

/* 修复：主页/列表页里“查看全部”使用 btn-light，暗色下不要刺眼白底 */
html[data-theme="dark"] .btn.btn-light {
  background-color: var(--yxk-surface-2) !important;
  color: var(--bs-body-color) !important;
  border-color: var(--yxk-border) !important;
}
html[data-theme="dark"] .btn.btn-light:hover {
  background-color: rgba(255, 255, 255, 0.10) !important;
}

/* 表格（居民管理页） */
html[data-theme="dark"] .table {
  color: var(--bs-table-color) !important;
}
html[data-theme="dark"] .table thead th {
  border-color: var(--bs-table-border-color) !important;
}
html[data-theme="dark"] .table tbody td,
html[data-theme="dark"] .table tbody th {
  border-color: var(--bs-table-border-color) !important;
}

/* 输入框/选择框（居民管理页的“搜索/每页条数”等） */
html[data-theme="dark"] .form-label {
  color: var(--bs-body-color) !important;
}
html[data-theme="dark"] .form-control,
html[data-theme="dark"] .form-select,
html[data-theme="dark"] input[type="number"].form-control,
html[data-theme="dark"] input[type="text"].form-control {
  background-color: var(--yxk-surface) !important;
  color: var(--bs-body-color) !important;
  border-color: var(--yxk-border) !important;
}
html[data-theme="dark"] .form-control::placeholder {
  color: rgba(229, 231, 235, 0.55) !important;
}
html[data-theme="dark"] .form-control:focus,
html[data-theme="dark"] .form-select:focus {
  border-color: rgba(59, 130, 246, 0.85) !important;
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.20) !important;
}

/* 下拉/模态/提示（尽量覆盖“好多页面不跟随主题”的常见组件） */
html[data-theme="dark"] .dropdown-menu {
  background-color: var(--yxk-surface) !important;
  border-color: var(--yxk-border) !important;
}
html[data-theme="dark"] .dropdown-item {
  color: var(--bs-body-color) !important;
}
html[data-theme="dark"] .dropdown-item:hover,
html[data-theme="dark"] .dropdown-item:focus {
  background-color: rgba(255, 255, 255, 0.08) !important;
}
html[data-theme="dark"] .modal-content {
  background-color: var(--yxk-surface) !important;
  color: var(--bs-body-color) !important;
  border-color: var(--yxk-border) !important;
}
html[data-theme="dark"] .alert {
  border-color: var(--yxk-border) !important;
}

/* 兜底：一些页面用了 bg-light / bg-white，暗色下统一压掉 */
html[data-theme="dark"] .bg-light,
html[data-theme="dark"] .bg-white {
  background-color: var(--yxk-surface) !important;
}
html[data-theme="dark"] .border,
html[data-theme="dark"] .border-top,
html[data-theme="dark"] .border-bottom,
html[data-theme="dark"] .border-start,
html[data-theme="dark"] .border-end {
  border-color: var(--yxk-border) !important;
}


--------------------------------------------------------------------------------
文件路径: src\main\webapp\static\css\main.css
--------------------------------------------------------------------------------

/* =====================================================
   网上村委会 - 主题样式表
   作者：于翔堃
   ===================================================== */

/* ==================== CSS 变量 ==================== */
:root {
    /* 主色调 */
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --primary-color: #667eea;
    --primary-dark: #5a67d8;
    
    /* 背景色 */
    --bg-color: #f8fafc;
    --card-bg: #ffffff;
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    
    /* 文字颜色 */
    --text-color: #1a202c;
    --text-muted: #718096;
    --text-light: #a0aec0;
    
    /* 边框 */
    --border-color: #e2e8f0;
    --border-radius: 16px;
    --border-radius-sm: 8px;
    
    /* 导航栏 */
    --navbar-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --navbar-height: 70px;
    
    /* 页脚 */
    --footer-bg: #1a202c;
    
    /* 统计卡片 */
    --stat-card-bg: #ffffff;
    --stat-card-border: rgba(102, 126, 234, 0.1);
}

/* 暗色主题变量 */
[data-theme="dark"] {
    --bg-color: #0f172a;
    --card-bg: #1e293b;
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    --text-color: #f1f5f9;
    --text-muted: #94a3b8;
    --text-light: #64748b;
    --border-color: #334155;
    --footer-bg: #0f172a;
    --stat-card-bg: #1e293b;
    --stat-card-border: rgba(102, 126, 234, 0.2);
}

/* ==================== 基础样式 ==================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans SC', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
    padding-top: var(--navbar-height);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
}

/* ==================== 导航栏 ==================== */
.navbar {
    background: var(--navbar-bg) !important;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    padding: 0 1rem;
    min-height: var(--navbar-height);
}

.navbar-brand {
    font-size: 1.4rem;
    font-weight: 700;
    color: #fff !important;
    display: flex;
    align-items: center;
}

.navbar-brand i {
    font-size: 1.6rem;
}

.navbar .nav-link {
    color: rgba(255, 255, 255, 0.85) !important;
    font-weight: 500;
    padding: 0.5rem 1rem !important;
    border-radius: var(--border-radius-sm);
    transition: all 0.2s ease;
}

.navbar .nav-link:hover,
.navbar .nav-link.active {
    color: #fff !important;
    background: rgba(255, 255, 255, 0.15);
}

/* ==================== 页面标题区 ==================== */
.page-hero {
    background: var(--primary-gradient);
    padding: 2rem 2.5rem;
    border-radius: var(--border-radius);
    color: #fff;
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
}

.page-hero-title {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.page-hero-subtitle {
    opacity: 0.9;
    font-size: 1rem;
}

/* ==================== 统计卡片 ==================== */
.stat-card {
    display: flex;
    align-items: stretch;
    /* 兜底：确保卡片主体始终有底色（避免出现“只有图标块有背景、文字区透明”的情况） */
    background: var(--stat-card-bg) !important;
    background-color: var(--stat-card-bg) !important;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--stat-card-border);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    min-height: 140px;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
}

.stat-card--glow {
    position: relative;
}

.stat-card--glow::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--primary-gradient);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: var(--border-radius);
    z-index: 0;
}

.stat-card--glow:hover::before {
    opacity: 0.03;
}

.stat-card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100px;
    min-width: 100px;
    font-size: 2.5rem;
    color: #fff;
    flex-shrink: 0;
}

.stat-card-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 1.5rem;
    background: var(--stat-card-bg) !important;
    background-color: var(--stat-card-bg) !important;
    position: relative;
    z-index: 1;
}

.stat-card-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
}

.stat-card-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-color);
    line-height: 1.2;
    margin-bottom: 0.25rem;
}

.stat-card-meta {
    font-size: 0.85rem;
    color: var(--text-light);
}

/* ==================== 卡片通用样式 ==================== */
.card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
}

.card.soft {
    border: none;
}

.card-header {
    background: transparent;
    border-bottom: 1px solid var(--border-color);
    padding: 1.25rem 1.5rem;
}

.card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color);
}

.card-body {
    padding: 1.5rem;
}

/* ==================== 表格样式 ==================== */
.table-wrap {
    overflow-x: auto;
}

.table {
    margin-bottom: 0;
}

.table thead th {
    background: var(--bg-color);
    border-bottom: 2px solid var(--border-color);
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    padding: 1rem 1.25rem;
}

.table tbody td {
    padding: 1rem 1.25rem;
    vertical-align: middle;
    border-bottom: 1px solid var(--border-color);
}

.table-hover tbody tr:hover {
    background-color: rgba(102, 126, 234, 0.05);
}

/* ==================== 按钮样式 ==================== */
.btn-gradient {
    background: var(--primary-gradient);
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 0.6rem 1.5rem;
    border-radius: var(--border-radius-sm);
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-gradient:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    color: #fff;
}

.btn-light {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    color: var(--primary-color);
    font-weight: 600;
}

.btn-light:hover {
    background: #fff;
    color: var(--primary-dark);
}

/* ==================== 空状态 ==================== */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-muted);
}

.empty-state i {
    font-size: 4rem;
    opacity: 0.3;
    margin-bottom: 1rem;
}

/* ==================== Badge 样式 ==================== */
.badge-soft {
    background: rgba(102, 126, 234, 0.1);
    color: var(--primary-color);
    font-weight: 500;
}

/* ==================== 分页样式 ==================== */
.pagination .page-link {
    border: none;
    color: var(--text-color);
    padding: 0.5rem 0.85rem;
    margin: 0 2px;
    border-radius: var(--border-radius-sm);
    transition: all 0.2s ease;
}

.pagination .page-link:hover {
    background: rgba(102, 126, 234, 0.1);
    color: var(--primary-color);
}

.pagination .page-item.active .page-link {
    background: var(--primary-gradient);
    color: #fff;
}

.pagination .page-item.disabled .page-link {
    background: transparent;
    color: var(--text-light);
}

/* ==================== 页脚样式 ==================== */
.footer {
    background: var(--footer-bg);
    color: rgba(255, 255, 255, 0.7);
    padding: 3rem 0 1.5rem;
    margin-top: auto;
}

.footer h5,
.footer h6 {
    color: #fff;
}

.footer-links li {
    margin-bottom: 0.5rem;
}

.footer-links a {
    color: rgba(255, 255, 255, 0.7);
    transition: color 0.2s ease;
}

.footer-links a:hover {
    color: #fff;
}

.footer-bottom {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.9rem;
}

/* ==================== 页脚社交图标与悬浮二维码 ==================== */
.footer-social {
    display: flex;
    align-items: center;
    gap: 12px;
}

.social-icon-wrapper {
    position: relative;
    display: inline-block;
}

.social-icon-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    color: #fff !important;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.social-icon-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-3px);
    color: #fff !important;
}

/* 悬浮二维码弹出框 - 默认完全隐藏 */
.qr-popup-box {
    position: absolute;
    /* 兜底：确保默认不占位、不显示（避免某些环境下 opacity/visibility 未生效导致“总是显示”） */
    display: none;
    bottom: calc(100% + 15px);
    left: 50%;
    transform: translateX(-50%) scale(0.8);
    background: #ffffff;
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.35);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    z-index: 9999;
    pointer-events: none;
    text-align: center;
    white-space: nowrap;
}

/* 小三角箭头 */
.qr-popup-box::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 10px solid transparent;
    border-top-color: #ffffff;
}

/* 二维码图片样式 - 关键：固定尺寸且保持比例 */
.qr-popup-box img {
    width: 160px;
    height: 160px;
    object-fit: contain;
    border-radius: 12px;
    display: block;
    background: #f5f5f5;
}

/* 提示文字 */
.qr-popup-box .qr-tip {
    display: block;
    margin-top: 10px;
    font-size: 13px;
    color: #666;
}

/* 悬浮时显示二维码 */
.social-icon-wrapper:hover .qr-popup-box {
    display: block;
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) scale(1);
    pointer-events: auto;
}

/* Modal中的二维码图片 */
.qr-modal-img {
    max-width: 200px;
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* ==================== 返回顶部按钮 ==================== */
.back-to-top {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--primary-gradient);
    border: none;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    z-index: 1000;
}

.back-to-top.show {
    opacity: 1;
    visibility: visible;
}

.back-to-top:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
}

/* ==================== 动画效果 ==================== */
[data-animate] {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}

[data-animate].animated {
    opacity: 1;
    transform: translateY(0);
}

/* ==================== Alert 样式 ==================== */
.alert {
    border: none;
    border-radius: var(--border-radius-sm);
}

.alert-success {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: #fff;
}

.alert-danger {
    background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
    color: #fff;
}

.alert .btn-close {
    filter: brightness(0) invert(1);
}

/* ==================== 文章内容样式 ==================== */
.article-meta {
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.article-content {
    font-size: 1.05rem;
    line-height: 1.8;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/* ==================== 响应式适配 ==================== */
@media (max-width: 768px) {
    .page-hero {
        padding: 1.5rem;
    }
    
    .page-hero-title {
        font-size: 1.4rem;
    }
    
    .stat-card {
        min-height: 120px;
    }
    
    .stat-card-icon {
        width: 80px;
        min-width: 80px;
        font-size: 2rem;
    }
    
    .stat-card-value {
        font-size: 2rem;
    }
    
    .stat-card-content {
        padding: 1rem;
    }
    
    /* 移动端隐藏悬浮二维码，使用点击Modal */
    .qr-popup-box {
        display: none !important;
    }
    
    .social-icon-btn {
        width: 40px;
        height: 40px;
    }
    
    .back-to-top {
        bottom: 20px;
        right: 20px;
        width: 45px;
        height: 45px;
    }
}

@media (max-width: 576px) {
    .stat-card {
        flex-direction: column;
        text-align: center;
    }
    
    .stat-card-icon {
        width: 100%;
        min-width: 100%;
        padding: 1.25rem;
        font-size: 2.5rem;
    }
    
    .stat-card-content {
        padding: 1.25rem;
    }
}

/* ==================== 打印样式 ==================== */
@media print {
    .navbar,
    .footer,
    .back-to-top,
    .btn {
        display: none !important;
    }
    
    body {
        padding-top: 0;
    }
    
    .card {
        box-shadow: none;
        border: 1px solid #ddd;
    }
}


--------------------------------------------------------------------------------
文件路径: src\main\webapp\static\css\img\QQ.jpg
--------------------------------------------------------------------------------

[二进制文件，无法显示内容]

--------------------------------------------------------------------------------
文件路径: src\main\webapp\static\css\img\WeiXin.jpg
--------------------------------------------------------------------------------

[二进制文件，无法显示内容]

--------------------------------------------------------------------------------
文件路径: src\main\webapp\static\js\main.js
--------------------------------------------------------------------------------

/**
 * 网上村委会 - 主脚本
 * 作者：于翔堃
 */

(function () {
    'use strict';

    // ==================== 返回顶部按钮 ====================
    const backToTopBtn = document.getElementById('backToTop');
    
    if (backToTopBtn) {
        window.addEventListener('scroll', function () {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        backToTopBtn.addEventListener('click', function () {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    // ==================== 滚动动画 ====================
    const animateElements = document.querySelectorAll('[data-animate]');
    
    if (animateElements.length > 0) {
        const observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                    observer.unobserve(entry.target);
                }
            });
        }, {
            threshold: 0.1
        });

        animateElements.forEach(function (el) {
            observer.observe(el);
        });
    }

    // ==================== Alert 自动关闭 ====================
    const alerts = document.querySelectorAll('.alert-dismissible');
    
    alerts.forEach(function (alert) {
        setTimeout(function () {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
            if (bsAlert) {
                bsAlert.close();
            }
        }, 5000);
    });

    // ==================== 二维码功能（悬浮 + 点击Modal） ====================
    (function initQrCode() {
        const socialBtns = document.querySelectorAll('.social-icon-btn');
        const qrModal = document.getElementById('qrModal');
        const qrModalImg = document.getElementById('qrModalImg');
        const qrModalTitle = document.getElementById('qrModalTitle');
        const qrModalHint = document.getElementById('qrModalHint');

        if (!qrModal || socialBtns.length === 0) return;

        let modalInstance = null;
        
        // 延迟初始化Modal，确保Bootstrap已加载
        function getModalInstance() {
            if (!modalInstance) {
                modalInstance = new bootstrap.Modal(qrModal);
            }
            return modalInstance;
        }

        // 配置
        const config = {
            weixin: {
                title: '微信二维码',
                hint: '微信扫码添加好友'
            },
            qq: {
                title: 'QQ二维码',
                hint: 'QQ扫码添加好友'
            }
        };

        socialBtns.forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                
                const contactType = this.getAttribute('data-contact');
                const wrapper = this.closest('.social-icon-wrapper');
                const popupBox = wrapper ? wrapper.querySelector('.qr-popup-box') : null;
                const popupImg = popupBox ? popupBox.querySelector('img') : null;
                
                if (popupImg && qrModalImg) {
                    const cfg = config[contactType] || { title: '二维码', hint: '扫码添加' };
                    
                    qrModalImg.src = popupImg.src;
                    if (qrModalTitle) qrModalTitle.textContent = cfg.title;
                    if (qrModalHint) qrModalHint.textContent = cfg.hint;
                    
                    // 点击图标：统一弹出二维码（满足“点击图标应显示二维码”的需求）
                    // PC 端仍保留悬浮提示框，移动端因 hover 不可靠主要依赖此 Modal。
                    getModalInstance().show();
                }
            });
        });
    })();

    // ==================== 导航栏当前页面高亮 ====================
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

    navLinks.forEach(function (link) {
        const href = link.getAttribute('href');
        if (href && currentPath.includes(href) && href !== '/' && href.length > 1) {
            link.classList.add('active');
        }
    });

    // ==================== 表格行点击效果 ====================
    const tableRows = document.querySelectorAll('.table-hover tbody tr');
    
    tableRows.forEach(function (row) {
        row.style.cursor = 'pointer';
        row.addEventListener('click', function (e) {
            // 如果点击的是按钮或链接，不处理
            if (e.target.closest('a, button, .btn')) {
                return;
            }
            
            // 查找该行的详情链接
            const detailLink = this.querySelector('a[href*="detail"], a[href*="view"]');
            if (detailLink) {
                window.location.href = detailLink.href;
            }
        });
    });

    // ==================== 确认删除对话框 ====================
    // ==================== 确认删除对话框 ====================
    const deleteButtons = document.querySelectorAll('[data-confirm]');
    
    deleteButtons.forEach(function (btn) {
        btn.addEventListener('click', function (e) {
            const message = this.getAttribute('data-confirm') || '确定要执行此操作吗？';
            if (!confirm(message)) {
                e.preventDefault();
            }
        });
    });

    // ==================== 工具提示初始化 ====================
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // ==================== 主题切换 ====================
    const themeToggleBtn = document.getElementById('themeToggle');
    
    if (themeToggleBtn) {
        // 更新按钮图标
        function updateThemeIcon(theme) {
            const icon = themeToggleBtn.querySelector('i');
            if (icon) {
                if (theme === 'dark') {
                    icon.className = 'fa-solid fa-sun';
                } else {
                    icon.className = 'fa-solid fa-moon';
                }
            }
        }
        
        // 初始化图标
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        updateThemeIcon(currentTheme);
        
        // 点击切换主题
        themeToggleBtn.addEventListener('click', function () {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme') || 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', next);
            html.setAttribute('data-bs-theme', next);
            
            // 保存到 localStorage
            try {
                localStorage.setItem('yxk-theme', next);
            } catch (e) {
                // ignore
            }
            
            updateThemeIcon(next);
        });
    }

})();


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\error.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:set var="pageTitle" value="错误 ${status} - 网上村委会"/>
<c:set var="activePage" value=""/>

<%@ include file="common/header.jsp" %>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8" data-animate="fade-up">
            <div class="page-hero mb-4">
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i>发生错误（HTTP ${status}）
                </h1>
                <div class="page-hero-subtitle">请检查请求路径或稍后重试</div>
            </div>

            <div class="card soft">
                <div class="card-body p-4 p-md-5">
                    <div class="alert alert-danger border-0 shadow-sm">
                        <div class="fw-bold mb-2"><i class="fa-solid fa-bug me-2"></i>错误信息</div>
                        <div class="mb-1"><strong>error：</strong> ${error}</div>
                        <div class="mb-1"><strong>message：</strong> ${message}</div>
                        <div class="mb-1"><strong>path：</strong> ${path}</div>
                        <div class="mb-0"><strong>requestId：</strong> ${requestId}</div>
                    </div>

                    <div class="d-flex flex-wrap gap-2">
                        <a href="<c:url value='/'/>" class="btn btn-gradient btn-lg">
                            <i class="fa-solid fa-house me-2"></i>返回首页
                        </a>
                        <a href="javascript:history.back();" class="btn btn-outline-secondary btn-lg">
                            <i class="fa-solid fa-arrow-left me-2"></i>返回上一页
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<%@ include file="common/footer.jsp" %>




--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\home.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="首页 - 网上村委会"/>
<c:set var="activePage" value="home"/>

<%@ include file="common/header.jsp" %>

<div class="container py-4">

    <!-- Hero区域 -->
    <div class="page-hero mb-5" data-animate="fade-up">
        <h1 class="page-hero-title">
            <i class="fa-solid fa-house-chimney me-2"></i>${message}
        </h1>
        <div class="page-hero-subtitle">高效便捷的村务管理平台</div>
    </div>

    <%@ include file="common/flash.jsp" %>

    <!-- 统计卡片（已移除“投诉/统计”模块） -->
    <div class="row g-4 mb-5">
        <div class="col-md-6" data-animate="fade-up" data-delay="100">
            <div class="stat-card stat-card--glow">
                <div class="stat-card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fa-solid fa-people-group"></i>
                </div>
                <div class="stat-card-content">
                    <div class="stat-card-title">居民总数</div>
                    <div class="stat-card-value">${residentTotal}</div>
                    <div class="stat-card-meta">户籍与常住居民</div>
                </div>
            </div>
        </div>

        <div class="col-md-6" data-animate="fade-up" data-delay="200">
            <div class="stat-card stat-card--glow">
                <div class="stat-card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fa-solid fa-bullhorn"></i>
                </div>
                <div class="stat-card-content">
                    <div class="stat-card-title">公告总数</div>
                    <div class="stat-card-value">${announcementTotal}</div>
                    <div class="stat-card-meta">已发布与草稿</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 最新动态 -->
    <div class="row g-4">
        <!-- 最近公告 -->
        <div class="col-lg-6" data-animate="fade-up" data-delay="100">
            <div class="card soft h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-bullhorn me-2"></i>最近公告
                    </h3>
                    <a href="${pageContext.request.contextPath}/announcements" class="btn btn-sm btn-outline-primary">
                        查看全部 <i class="fa-solid fa-arrow-right ms-1"></i>
                    </a>
                </div>
                <div class="card-body p-0">
                    <c:if test="${not empty recentAnnouncements}">
                        <ul class="list-group list-group-flush">
                            <c:forEach items="${recentAnnouncements}" var="ann">
                                <li class="list-group-item d-flex justify-content-between align-items-center px-4 py-3">
                                    <div>
                                        <div class="fw-semibold">
                                            <a href="${pageContext.request.contextPath}/announcements/view?id=${ann.id}" class="text-decoration-none">
                                                ${ann.title}
                                            </a>
                                        </div>
                                        <small class="text-muted">
                                            <c:choose>
                                                <c:when test="${not empty ann.publishTime}">
                                                    ${fn:substring(fn:replace(ann.publishTime, 'T', ' '), 0, 10)}
                                                </c:when>
                                                <c:otherwise>-</c:otherwise>
                                            </c:choose>
                                        </small>
                                    </div>
                                    <span class="badge 
                                        <c:choose>
                                            <c:when test="${ann.published}">bg-success</c:when>
                                            <c:when test="${empty ann.status || ann.status == 0}">bg-warning text-dark</c:when>
                                            <c:otherwise>bg-secondary</c:otherwise>
                                        </c:choose>
                                    ">${ann.statusText}</span>
                                </li>
                            </c:forEach>
                        </ul>
                    </c:if>
                    <c:if test="${empty recentAnnouncements}">
                        <div class="empty-state py-5">
                            <i class="fa-solid fa-bullhorn"></i>
                            <div class="mt-2">暂无公告</div>
                        </div>
                    </c:if>
                </div>
            </div>
        </div>

        <!-- 最近操作 -->
        <div class="col-lg-6" data-animate="fade-up" data-delay="200">
            <div class="card soft h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-clock-rotate-left me-2"></i>最近操作
                    </h3>
                    <a href="${pageContext.request.contextPath}/logs" class="btn btn-sm btn-outline-primary">
                        查看日志 <i class="fa-solid fa-arrow-right ms-1"></i>
                    </a>
                </div>
                <div class="card-body p-0">
                    <c:if test="${not empty recentLogs}">
                        <ul class="list-group list-group-flush">
                            <c:forEach items="${recentLogs}" var="log">
                                <li class="list-group-item px-4 py-3">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="fw-semibold">
                                                <c:choose>
                                                    <c:when test="${not empty log.description}">
                                                        ${log.description}
                                                    </c:when>
                                                    <c:otherwise>-</c:otherwise>
                                                </c:choose>
                                            </div>
                                            <small class="text-muted">
                                                <c:choose>
                                                    <c:when test="${not empty log.operator}">
                                                        ${log.operator}
                                                    </c:when>
                                                    <c:otherwise>-</c:otherwise>
                                                </c:choose>
                                            </small>
                                        </div>
                                        <small class="text-muted">
                                            <c:choose>
                                                <c:when test="${not empty log.createdAt}">
                                                    ${fn:substring(fn:replace(log.createdAt, 'T', ' '), 0, 16)}
                                                </c:when>
                                                <c:otherwise>-</c:otherwise>
                                            </c:choose>
                                        </small>
                                    </div>
                                </li>
                            </c:forEach>
                        </ul>
                    </c:if>
                    <c:if test="${empty recentLogs}">
                        <div class="empty-state py-5">
                            <i class="fa-solid fa-clipboard-list"></i>
                            <div class="mt-2">暂无操作记录</div>
                        </div>
                    </c:if>
                </div>
            </div>
        </div>
    </div>

</div>

<%@ include file="common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\announcements\detail.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:set var="pageTitle" value="公告详情 - 网上村委会"/>
<c:set var="activePage" value="announcements"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-bullhorn me-2"></i>公告详情
                </h1>
                <div class="page-hero-subtitle">查看公告内容与发布信息</div>

                <div class="article-meta">
                    <span class="badge rounded-pill badge-soft">
                        <i class="fa-solid fa-user me-1"></i>${announcement.publisher}
                    </span>
                    <span class="badge rounded-pill badge-soft">
                        <i class="fa-solid fa-clock me-1"></i>
                        ${fn:substring(fn:replace(announcement.publishTime, 'T', ' '), 0, 16)}
                    </span>
                    <span class="badge rounded-pill badge-soft">
                        <i class="fa-solid fa-hashtag me-1"></i>ID：${announcement.id}
                    </span>
                </div>
            </div>

            <div class="text-md-end">
                <a href="<c:url value='/announcements'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
            </div>
        </div>
    </div>

    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-4 p-md-5">
            <h2 class="fw-bold mb-3">${announcement.title}</h2>
            <div class="article-content"><c:out value="${announcement.content}"/></div>

            <hr class="my-4">

            <div class="d-flex flex-wrap gap-2">
                <a href="<c:url value='/announcements/${announcement.id}/edit'/>" class="btn btn-outline-primary">
                    <i class="fa-solid fa-pen-to-square me-2"></i>编辑
                </a>

                <form action="<c:url value='/announcements/${announcement.id}/delete'/>" method="post"
                      onsubmit="return confirm('确定要删除这条公告吗？');" style="display:inline;">
                    <input type="hidden" name="_csrf" value="${_csrf}"/>
                    <button type="submit" class="btn btn-outline-danger">
                        <i class="fa-solid fa-trash me-2"></i>删除
                    </button>
                </form>

                <a href="<c:url value='/announcements/new'/>" class="btn btn-gradient">
                    <i class="fa-solid fa-plus me-2"></i>发布新公告
                </a>
            </div>
        </div>
    </div>
</div>

<%@ include file="../common/footer.jsp" %>




--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\announcements\form.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="${mode == 'edit' ? '编辑公告' : '发布新公告'} - 网上村委会"/>
<c:set var="activePage" value="announcements"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <!-- Hero区域 -->
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-bullhorn me-2"></i>${mode == 'edit' ? '编辑公告' : '发布新公告'}
                </h1>
                <div class="page-hero-subtitle">
                    ${mode == 'edit' ? '修改公告内容与发布设置' : '填写公告信息并发布'}
                </div>
            </div>
            <div class="text-md-end">
                <a href="<c:url value='/announcements'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <!-- 表单卡片 -->
    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-4 p-md-5">
            <form id="announcementForm" method="post"
                  action="${pageContext.request.contextPath}/announcements<c:if test='${mode == "edit"}'>/${announcement.id}</c:if>"
                  novalidate>

                <%-- CSRF Token --%>
                <input type="hidden" name="_csrf" value="${_csrf}"/>

                <div class="row">
                    <!-- 左侧主要内容 -->
                    <div class="col-lg-8">
                        <%-- 标题 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="title">
                                <i class="fa-solid fa-heading me-2 text-primary"></i>公告标题 
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control form-control-lg" id="title" name="title"
                                   value="${announcement.title}" required maxlength="100"
                                   placeholder="请输入公告标题（简洁明了）">
                            <div class="invalid-feedback">请输入标题（1-100个字符）</div>
                            <div class="form-text d-flex justify-content-between">
                                <span>标题将显示在公告列表中</span>
                                <span class="char-counter"><span id="titleCount">0</span>/100</span>
                            </div>
                        </div>

                        <%-- 内容 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="content">
                                <i class="fa-solid fa-file-lines me-2 text-primary"></i>公告内容 
                                <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" id="content" name="content"
                                      rows="12" required maxlength="10000"
                                      placeholder="请输入公告的详细内容...">${announcement.content}</textarea>
                            <div class="invalid-feedback">请输入内容（1-10000个字符）</div>
                            <div class="form-text d-flex justify-content-between">
                                <span>支持换行，内容将原样显示</span>
                                <span class="char-counter"><span id="contentCount">0</span>/10000</span>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧设置面板 -->
                    <div class="col-lg-4">
                        <div class="card bg-light border-0 mb-4">
                            <div class="card-header bg-transparent border-0 pb-0">
                                <h6 class="mb-0 fw-bold">
                                    <i class="fa-solid fa-sliders me-2"></i>发布设置
                                </h6>
                            </div>
                            <div class="card-body">
                                <%-- 发布人 --%>
                                <div class="mb-3">
                                    <label class="form-label fw-bold" for="publisher">
                                        发布人 <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fa-solid fa-user"></i>
                                        </span>
                                        <input type="text" class="form-control" id="publisher" name="publisher"
                                               value="${announcement.publisher}" required maxlength="50"
                                               placeholder="发布人姓名">
                                    </div>
                                    <div class="invalid-feedback">请输入发布人（1-50个字符）</div>
                                </div>

                                <%-- 发布时间 --%>
                                <div class="mb-3">
                                    <label class="form-label fw-bold" for="publishTime">发布时间</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fa-solid fa-calendar"></i>
                                        </span>
                                        <input type="datetime-local" class="form-control" id="publishTime" name="publishTime"
                                               value="${not empty announcement.publishTime ? fn:substring(announcement.publishTime, 0, 16) : ''}">
                                    </div>
                                    <div class="form-text">留空则使用当前时间</div>
                                </div>

                                <%-- 状态 --%>
                                <div class="mb-3">
                                    <label class="form-label fw-bold" for="status">发布状态</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="1" ${announcement.status == 1 ? 'selected' : ''}>
                                            ✅ 立即发布
                                        </option>
                                        <option value="0" ${announcement.status == 0 ? 'selected' : ''}>
                                            📝 保存为草稿
                                        </option>
                                    </select>
                                </div>

                                <%-- 置顶 --%>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input type="checkbox" class="form-check-input" id="isTop" name="isTop" value="true"
                                               ${announcement.isTop ? 'checked' : ''}>
                                        <label class="form-check-label fw-bold" for="isTop">
                                            <i class="fa-solid fa-thumbtack me-1"></i>置顶显示
                                        </label>
                                    </div>
                                    <div class="form-text">置顶公告将显示在列表最前面</div>
                                </div>
                            </div>
                        </div>

                        <!-- 操作提示 -->
                        <div class="alert alert-info border-0 shadow-sm">
                            <h6 class="alert-heading mb-2">
                                <i class="fa-solid fa-lightbulb me-2"></i>温馨提示
                            </h6>
                            <ul class="mb-0 ps-3 small">
                                <li>标题应简洁明了，便于村民快速了解内容</li>
                                <li>重要公告建议开启置顶功能</li>
                                <li>草稿状态的公告不会在前台显示</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <hr class="my-4">

                <%-- 操作按钮 --%>
                <div class="d-flex flex-wrap gap-3 justify-content-between align-items-center">
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-gradient btn-lg" id="submitBtn">
                            <span class="spinner-border spinner-border-sm d-none me-2" id="spinner"></span>
                            <i class="fa-solid fa-paper-plane me-2" id="submitIcon"></i>
                            ${mode == 'edit' ? '保存修改' : '确认发布'}
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" id="previewBtn">
                            <i class="fa-solid fa-eye me-2"></i>预览
                        </button>
                    </div>
                    <a href="${pageContext.request.contextPath}/announcements" class="btn btn-light btn-lg">
                        <i class="fa-solid fa-xmark me-2"></i>取消
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<%-- 预览模态框 --%>
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 bg-light">
                <h5 class="modal-title">
                    <i class="fa-solid fa-eye me-2"></i>公告预览
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-3">
                    <span class="badge bg-primary me-2" id="previewStatus">已发布</span>
                    <span class="badge bg-warning text-dark d-none" id="previewTop">
                        <i class="fa-solid fa-thumbtack me-1"></i>置顶
                    </span>
                </div>
                <h3 id="previewTitle" class="fw-bold mb-3"></h3>
                <div class="text-muted mb-4 d-flex gap-3 flex-wrap">
                    <span><i class="fa-solid fa-user me-1"></i><span id="previewPublisher"></span></span>
                    <span><i class="fa-solid fa-clock me-1"></i><span id="previewTime"></span></span>
                </div>
                <hr>
                <div id="previewContent" class="article-content" style="white-space: pre-wrap; min-height: 200px;"></div>
            </div>
            <div class="modal-footer border-0 bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark me-2"></i>关闭
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.char-counter {
    font-size: 0.8rem;
    color: var(--bs-secondary);
    font-weight: 500;
}
.char-counter.warning { color: var(--bs-warning); }
.char-counter.danger { color: var(--bs-danger); }

.form-control:focus, .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.form-control.is-valid {
    border-color: var(--bs-success);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.form-control.is-invalid {
    border-color: var(--bs-danger);
}

textarea.form-control {
    min-height: 250px;
}

[data-theme="dark"] .card.bg-light {
    background-color: rgba(255, 255, 255, 0.05) !important;
}

[data-theme="dark"] .modal-header.bg-light,
[data-theme="dark"] .modal-footer.bg-light {
    background-color: rgba(255, 255, 255, 0.05) !important;
}
</style>

<script>
(function() {
    'use strict';

    const form = document.getElementById('announcementForm');
    const titleInput = document.getElementById('title');
    const contentInput = document.getElementById('content');
    const publisherInput = document.getElementById('publisher');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const submitIcon = document.getElementById('submitIcon');

    // ==================== 字符计数器 ====================
    function updateCounter(input, counterId, max) {
        const counter = document.getElementById(counterId);
        const count = input.value.length;
        counter.textContent = count;

        const wrapper = counter.parentElement;
        wrapper.classList.remove('warning', 'danger');
        if (count > max * 0.9) {
            wrapper.classList.add('danger');
        } else if (count > max * 0.7) {
            wrapper.classList.add('warning');
        }
    }

    titleInput.addEventListener('input', function() {
        updateCounter(this, 'titleCount', 100);
    });

    contentInput.addEventListener('input', function() {
        updateCounter(this, 'contentCount', 10000);
    });

    // 初始化计数
    updateCounter(titleInput, 'titleCount', 100);
    updateCounter(contentInput, 'contentCount', 10000);

    // ==================== 验证状态 ====================
    function setInvalid(input) {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
    }

    function setValid(input) {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }

    function clearState(input) {
        input.classList.remove('is-invalid', 'is-valid');
    }

    titleInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0 || val.length > 100) setInvalid(this);
        else setValid(this);
    });

    titleInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    contentInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0) setInvalid(this);
        else setValid(this);
    });

    contentInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    publisherInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0 || val.length > 50) setInvalid(this);
        else setValid(this);
    });

    publisherInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    // ==================== 表单提交 ====================
    form.addEventListener('submit', function(e) {
        let isValid = true;

        if (titleInput.value.trim().length === 0 || titleInput.value.trim().length > 100) {
            setInvalid(titleInput);
            isValid = false;
        }
        if (contentInput.value.trim().length === 0) {
            setInvalid(contentInput);
            isValid = false;
        }
        if (publisherInput.value.trim().length === 0 || publisherInput.value.trim().length > 50) {
            setInvalid(publisherInput);
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            const firstError = form.querySelector('.is-invalid');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
            return false;
        }

        submitBtn.disabled = true;
        spinner.classList.remove('d-none');
        submitIcon.classList.add('d-none');
    });

    // ==================== 预览功能 ====================
    const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));

    document.getElementById('previewBtn').addEventListener('click', function() {
        document.getElementById('previewTitle').textContent = titleInput.value || '（无标题）';
        document.getElementById('previewPublisher').textContent = publisherInput.value || '（未填写）';

        const timeInput = document.getElementById('publishTime');
        const timeVal = timeInput.value
            ? new Date(timeInput.value).toLocaleString('zh-CN')
            : new Date().toLocaleString('zh-CN');
        document.getElementById('previewTime').textContent = timeVal;

        document.getElementById('previewContent').textContent = contentInput.value || '（无内容）';

        // 状态显示
        const statusSelect = document.getElementById('status');
        const previewStatus = document.getElementById('previewStatus');
        if (statusSelect.value === '1') {
            previewStatus.textContent = '已发布';
            previewStatus.className = 'badge bg-success me-2';
        } else {
            previewStatus.textContent = '草稿';
            previewStatus.className = 'badge bg-secondary me-2';
        }

        // 置顶显示
        const isTopCheck = document.getElementById('isTop');
        const previewTop = document.getElementById('previewTop');
        if (isTopCheck.checked) {
            previewTop.classList.remove('d-none');
        } else {
            previewTop.classList.add('d-none');
        }

        previewModal.show();
    });

    // ==================== 离开提示 ====================
    let formChanged = false;

    form.querySelectorAll('input, textarea, select').forEach(function(el) {
        el.addEventListener('change', function() {
            formChanged = true;
        });
    });

    window.addEventListener('beforeunload', function(e) {
        if (formChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    form.addEventListener('submit', function() {
        formChanged = false;
    });

})();
</script>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\announcements\list.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:set var="pageTitle" value="公告管理 - 网上村委会"/>
<c:set var="activePage" value="announcements"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-bullhorn me-2"></i>公告管理
                </h1>
                <div class="page-hero-subtitle">发布、编辑与管理通知公告</div>
            </div>

            <div class="text-md-end">
                <a href="<c:url value='/announcements/new'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-plus me-2"></i>发布公告
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-0">
            <c:if test="${not empty announcements}">
                <div class="table-wrap table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th style="width: 90px;">ID</th>
                            <th>标题</th>
                            <th style="width: 160px;">发布人</th>
                            <th style="width: 180px;">发布时间</th>
                            <th style="width: 160px;">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <c:forEach var="a" items="${announcements}">
                            <tr>
                                <td class="fw-bold">#${a.id}</td>
                                <td>
                                    <a href="<c:url value='/announcements/${a.id}'/>" class="fw-bold">
                                        ${a.title}
                                    </a>
                                </td>
                                <td>${a.publisher}</td>
                                <td>
                                    ${fn:substring(fn:replace(a.publishTime, 'T', ' '), 0, 16)}
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <a href="<c:url value='/announcements/${a.id}'/>"
                                           class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-eye"></i>
                                        </a>

                                        <a href="<c:url value='/announcements/${a.id}/edit'/>"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </a>

                                        <form action="<c:url value='/announcements/${a.id}/delete'/>"
                                              method="post" style="display:inline;"
                                              onsubmit="return confirm('确定要删除这条公告吗？');">
                                            <input type="hidden" name="_csrf" value="${_csrf}"/>
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        </c:forEach>
                        </tbody>
                    </table>
                </div>
            </c:if>

            <c:if test="${empty announcements}">
                <div class="empty-state">
                    <i class="fa-solid fa-inbox"></i>
                    <div class="mt-2">暂无公告</div>
                </div>
            </c:if>
        </div>
    </div>
</div>

<%@ include file="../common/footer.jsp" %>




--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\committee-members\detail.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="村委会成员详情 - 网上村委会"/>
<c:set var="activePage" value="committee-members"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-user-tie me-2"></i>村委会成员详情
                </h1>
                <div class="page-hero-subtitle">查看成员详细信息</div>
            </div>

            <div class="text-md-end d-flex gap-2 flex-wrap justify-content-md-end">
                <a href="<c:url value='/committee-members'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
                <a href="<c:url value='/committee-members/${member.id}/edit'/>" class="btn btn-primary btn-lg">
                    <i class="fa-solid fa-pen-to-square me-2"></i>编辑
                </a>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- 成员基本信息卡片 -->
        <div class="col-lg-8" data-animate="fade-up" data-delay="100">
            <div class="card soft h-100">
                <div class="card-header bg-gradient-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-user me-2"></i>基本信息
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <div class="avatar-lg me-3">
                                    <div class="avatar-initial rounded-circle bg-primary text-white fs-2">
                                        ${fn:substring(member.name, 0, 1)}
                                    </div>
                                </div>
                                <div>
                                    <h4 class="mb-1">${member.name}</h4>
                                    <div class="badge ${member.isActiveMember ? 'bg-success' : 'bg-secondary'} fs-6">
                                        ${member.isActiveMember ? '在职' : '离职'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="mb-2">
                                <span class="text-muted">ID:</span>
                                <span class="ms-2 fw-bold">#${member.id}</span>
                            </div>
                            <div class="mb-2">
                                <span class="text-muted">性别:</span>
                                <span class="ms-2">${member.gender}</span>
                            </div>
                            <div>
                                <span class="text-muted">身份证号:</span>
                                <span class="ms-2">${member.idCard}</span>
                            </div>
                        </div>
                        <div class="col-12">
                            <hr>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fa-solid fa-phone me-2"></i>联系电话
                                </div>
                                <div class="info-value">${member.phone}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fa-solid fa-briefcase me-2"></i>职务
                                </div>
                                <div class="info-value">${member.position}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fa-solid fa-calendar-check me-2"></i>任职时间
                                </div>
                                <div class="info-value">
                                    <fmt:formatDate value="${member.joinTime}" pattern="yyyy-MM-dd HH:mm"/>
                                </div>
                            </div>
                        </div>
                        <c:if test="${not empty member.leaveTime}">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fa-solid fa-calendar-xmark me-2"></i>离职时间
                                    </div>
                                    <div class="info-value">
                                        <fmt:formatDate value="${member.leaveTime}" pattern="yyyy-MM-dd HH:mm"/>
                                    </div>
                                </div>
                            </div>
                        </c:if>
                        <c:if test="${not empty member.responsibilities}">
                            <div class="col-12 mt-3">
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fa-solid fa-clipboard-list me-2"></i>职责描述
                                    </div>
                                    <div class="info-value">${member.responsibilities}</div>
                                </div>
                            </div>
                        </c:if>
                    </div>
                </div>
            </div>
        </div>

        <!-- 附加信息卡片 -->
        <div class="col-lg-4" data-animate="fade-up" data-delay="200">
            <!-- 状态信息 -->
            <div class="card soft mb-4">
                <div class="card-header bg-gradient-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-chart-line me-2"></i>状态信息
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>当前状态</span>
                            <span class="badge ${member.isActiveMember ? 'bg-success' : 'bg-secondary'}">
                                ${member.isActiveMember ? '在职' : '离职'}
                            </span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar ${member.isActiveMember ? 'bg-success' : 'bg-secondary'}" 
                                 style="width: ${member.isActiveMember ? '100' : '0'}%"></div>
                        </div>
                    </div>

                    <c:if test="${member.isActiveMember}">
                        <div class="alert alert-success d-flex align-items-center" role="alert">
                            <i class="fa-solid fa-circle-check me-2"></i>
                            <div>
                                该成员目前在职，正常履行职责
                            </div>
                        </div>
                    </c:if>

                    <c:if test="${not member.isActiveMember}">
                        <div class="alert alert-warning d-flex align-items-center" role="alert">
                            <i class="fa-solid fa-triangle-exclamation me-2"></i>
                            <div>
                                该成员已离职，不再履行职责
                            </div>
                        </div>
                    </c:if>
                </div>
            </div>

            <!-- 操作记录 -->
            <div class="card soft">
                <div class="card-header bg-gradient-secondary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-clock-rotate-left me-2"></i>操作记录
                    </h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-primary"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">创建记录</h6>
                                <p class="text-muted mb-0">
                                    <fmt:formatDate value="${member.createdAt}" pattern="yyyy-MM-dd HH:mm"/>
                                </p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-info"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">任职时间</h6>
                                <p class="text-muted mb-0">
                                    <fmt:formatDate value="${member.joinTime}" pattern="yyyy-MM-dd HH:mm"/>
                                </p>
                            </div>
                        </div>
                        <c:if test="${not empty member.updatedAt}">
                            <div class="timeline-item">
                                <div class="timeline-marker bg-warning"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">最后更新</h6>
                                    <p class="text-muted mb-0">
                                        <fmt:formatDate value="${member.updatedAt}" pattern="yyyy-MM-dd HH:mm"/>
                                    </p>
                                </div>
                            </div>
                        </c:if>
                        <c:if test="${not empty member.leaveTime}">
                            <div class="timeline-item">
                                <div class="timeline-marker bg-danger"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">离职时间</h6>
                                    <p class="text-muted mb-0">
                                        <fmt:formatDate value="${member.leaveTime}" pattern="yyyy-MM-dd HH:mm"/>
                                    </p>
                                </div>
                            </div>
                        </c:if>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%@ include file="../common/footer.jsp" %>

<style>
/* 详情页样式 */
.avatar-lg {
    width: 80px;
    height: 80px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.avatar-initial {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.info-item {
    margin-bottom: 1.5rem;
}

.info-label {
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-value {
    font-size: 1.1rem;
    font-weight: 500;
}

/* 时间线样式 */
.timeline {
    position: relative;
    padding-left: 25px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 0;
    height: 100%;
    width: 2px;
    background: var(--border-color);
}

.timeline-item {
    position: relative;
    margin-bottom: 1.5rem;
}

.timeline-item:last-child {
    margin-bottom: 0;
}

.timeline-marker {
    position: absolute;
    left: -17px;
    top: 5px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid var(--card-bg);
}

.timeline-content h6 {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.timeline-content p {
    font-size: 0.85rem;
}

/* 渐变背景 */
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
}

.bg-gradient-secondary {
    background: linear-gradient(135deg, #434343 0%, #000000 100%);
}
</style>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\committee-members\form.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="${mode == 'edit' ? '编辑村委会成员' : '新增村委会成员'} - 网上村委会"/>
<c:set var="activePage" value="committee-members"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <!-- Hero区域 -->
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-user-tie me-2"></i>${mode == 'edit' ? '编辑村委会成员信息' : '新增村委会成员'}
                </h1>
                <div class="page-hero-subtitle">
                    ${mode == 'edit' ? '修改村委会成员的基本信息' : '录入新村委会成员的基本信息'}
                </div>
            </div>
            <div class="text-md-end">
                <a href="<c:url value='/committee-members'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <div class="row">
        <!-- 表单卡片 -->
        <div class="col-lg-8" data-animate="fade-up">
            <div class="card soft">
                <div class="card-body p-4 p-md-5">
                    <form id="memberForm" method="post"
                          action="${pageContext.request.contextPath}/committee-members${mode == 'edit' ? '/' += member.id : ''}"
                          novalidate>

                        <%-- CSRF Token --%>
                        <input type="hidden" name="_csrf" value="${_csrf}"/>
                        
                        <%-- 编辑模式额外参数 --%>
                        <c:if test="${mode == 'edit'}">
                            <input type="hidden" name="_method" value="put">
                        </c:if>

                        <%-- 姓名 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="name">
                                <i class="fa-solid fa-user me-2 text-primary"></i>姓名
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control form-control-lg" id="name" name="name"
                                   value="${member.name}" required maxlength="50"
                                   placeholder="请输入成员姓名">
                            <div class="invalid-feedback">请输入有效的姓名（1-50个字符）</div>
                            <div class="form-text d-flex justify-content-between">
                                <span>请输入真实姓名</span>
                                <span class="char-counter"><span id="nameCount">0</span>/50</span>
                            </div>
                        </div>

                        <%-- 性别 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="gender">
                                <i class="fa-solid fa-venus-mars me-2 text-primary"></i>性别
                                <span class="text-danger">*</span>
                            </label>
                            <select class="form-select form-select-lg" id="gender" name="gender" required>
                                <option value="">请选择性别</option>
                                <option value="男" ${member.gender == '男' ? 'selected' : ''}>男</option>
                                <option value="女" ${member.gender == '女' ? 'selected' : ''}>女</option>
                            </select>
                            <div class="invalid-feedback">请选择性别</div>
                        </div>

                        <%-- 身份证号 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="idCard">
                                <i class="fa-solid fa-id-card me-2 text-primary"></i>身份证号
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">
                                    <i class="fa-solid fa-fingerprint"></i>
                                </span>
                                <input type="text" class="form-control" id="idCard" name="idCard"
                                       value="${member.idCard}" maxlength="18"
                                       placeholder="18位身份证号码" required>
                            </div>
                            <div class="invalid-feedback" id="idCardError">身份证号格式不正确</div>
                            <div class="form-text">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                18位有效身份证号码，系统将自动校验
                            </div>
                        </div>

                        <%-- 电话 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="phone">
                                <i class="fa-solid fa-phone me-2 text-primary"></i>联系电话
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">
                                    <i class="fa-solid fa-mobile-screen"></i>
                                </span>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                       value="${member.phone}" maxlength="20"
                                       placeholder="手机号或座机号" required>
                            </div>
                            <div class="invalid-feedback" id="phoneError">电话号码格式不正确</div>
                            <div class="form-text">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                支持11位手机号或座机号（如 010-12345678）
                            </div>
                        </div>

                        <hr class="my-4">

                        <%-- 职务 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="position">
                                <i class="fa-solid fa-briefcase me-2 text-primary"></i>职务
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control form-control-lg" id="position" name="position"
                                   value="${member.position}" required maxlength="50"
                                   placeholder="请输入职务名称">
                            <div class="invalid-feedback">请输入有效的职务名称（1-50个字符）</div>
                            <div class="form-text d-flex justify-content-between">
                                <span>如：村长、书记、会计等</span>
                                <span class="char-counter"><span id="positionCount">0</span>/50</span>
                            </div>
                        </div>

                        <%-- 任职时间 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="joinTime">
                                <i class="fa-solid fa-calendar-days me-2 text-primary"></i>任职时间
                                <span class="text-danger">*</span>
                            </label>
                            <input type="datetime-local" class="form-control form-control-lg" id="joinTime" name="joinTime"
                                   value="<fmt:formatDate value="${member.joinTime}" pattern="yyyy-MM-dd'T'HH:mm"/>"
                                   required>
                            <div class="invalid-feedback">请选择任职时间</div>
                        </div>

                        <%-- 职责描述 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="responsibilities">
                                <i class="fa-solid fa-clipboard-list me-2 text-primary"></i>职责描述
                            </label>
                            <textarea class="form-control" id="responsibilities" name="responsibilities"
                                      rows="3" maxlength="255"
                                      placeholder="请描述该成员的主要职责（选填）">${member.responsibilities}</textarea>
                            <div class="form-text d-flex justify-content-between">
                                <span>请填写该成员的主要工作职责</span>
                                <span class="char-counter"><span id="responsibilitiesCount">0</span>/255</span>
                            </div>
                        </div>

                        <hr class="my-4">

                        <%-- 在职状态 --%>
                        <div class="mb-4">
                            <div class="form-check form-switch form-check-lg">
                                <input class="form-check-input" type="checkbox" id="isActiveMember" name="isActiveMember"
                                       ${member.isActiveMember ? 'checked' : ''}>
                                <label class="form-check-label fw-bold" for="isActiveMember">
                                    <i class="fa-solid fa-toggle-on me-2 text-primary"></i>在职状态
                                </label>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                取消勾选表示该成员已离职
                            </div>
                        </div>

                        <%-- 离职时间 --%>
                        <div class="mb-4" id="leaveTimeContainer" style="${member.isActiveMember ? 'display: none;' : ''}">
                            <label class="form-label fw-bold" for="leaveTime">
                                <i class="fa-solid fa-calendar-xmark me-2 text-primary"></i>离职时间
                            </label>
                            <input type="datetime-local" class="form-control form-control-lg" id="leaveTime" name="leaveTime"
                                   value="<fmt:formatDate value="${member.leaveTime}" pattern="yyyy-MM-dd'T'HH:mm"/>"
                                   ${member.isActiveMember ? 'disabled' : ''}>
                            <div class="form-text">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                请选择离职时间（仅离职成员需要填写）
                            </div>
                        </div>

                        <hr class="my-4">

                        <%-- 操作按钮 --%>
                        <div class="d-flex flex-wrap gap-3 justify-content-between align-items-center">
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-gradient btn-lg" id="submitBtn">
                                    <span class="spinner-border spinner-border-sm d-none me-2" id="spinner"></span>
                                    <i class="fa-solid fa-check me-2" id="submitIcon"></i>
                                    ${mode == 'edit' ? '保存修改' : '确认新增'}
                                </button>
                                <button type="reset" class="btn btn-outline-secondary btn-lg">
                                    <i class="fa-solid fa-rotate-left me-2"></i>重置
                                </button>
                            </div>
                            <a href="${pageContext.request.contextPath}/committee-members" class="btn btn-light btn-lg">
                                <i class="fa-solid fa-xmark me-2"></i>取消
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 右侧提示面板 -->
        <div class="col-lg-4 mt-4 mt-lg-0" data-animate="fade-up" data-delay="100">
            <!-- 填写说明 -->
            <div class="card soft mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-circle-info me-2"></i>填写说明
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-3 d-flex">
                            <span class="badge bg-danger rounded-pill me-2" style="height: fit-content;">必填</span>
                            <div>
                                <strong>基本信息</strong><br>
                                <small class="text-muted">姓名、性别、身份证号和联系电话为必填项</small>
                            </div>
                        </li>
                        <li class="mb-3 d-flex">
                            <span class="badge bg-danger rounded-pill me-2" style="height: fit-content;">必填</span>
                            <div>
                                <strong>职务信息</strong><br>
                                <small class="text-muted">职务和任职时间为必填项，职责描述为选填</small>
                            </div>
                        </li>
                        <li class="mb-3 d-flex">
                            <span class="badge bg-secondary rounded-pill me-2" style="height: fit-content;">选填</span>
                            <div>
                                <strong>在职状态</strong><br>
                                <small class="text-muted">默认为在职状态，离职后需填写离职时间</small>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 数据安全提示 -->
            <div class="alert alert-warning border-0 shadow-sm">
                <h6 class="alert-heading mb-2">
                    <i class="fa-solid fa-shield-halved me-2"></i>数据安全提示
                </h6>
                <p class="mb-0 small">
                    村委会成员信息属于敏感数据，请确保信息准确性，系统将对数据进行加密存储和访问控制。
                </p>
            </div>

            <!-- 快速操作 -->
            <div class="card soft">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-bolt me-2"></i>快速操作
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="${pageContext.request.contextPath}/committee-members" class="btn btn-outline-primary">
                            <i class="fa-solid fa-list me-2"></i>查看成员列表
                        </a>
                        <c:if test="${mode == 'edit'}">
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                <i class="fa-solid fa-trash me-2"></i>删除此成员
                            </button>
                        </c:if>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%-- 删除确认模态框（仅编辑模式） --%>
<c:if test="${mode == 'edit'}">
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i>确认删除
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center p-4">
                <div class="mb-3">
                    <i class="fa-solid fa-user-xmark fa-4x text-danger"></i>
                </div>
                <h5>确定要删除村委会成员 "${member.name}" 吗？</h5>
                <p class="text-muted mb-0">此操作不可恢复，请谨慎操作。</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark me-2"></i>取消
                </button>
                <form action="${pageContext.request.contextPath}/committee-members/${member.id}/delete" method="post" class="d-inline">
                    <input type="hidden" name="_csrf" value="${_csrf}"/>
                    <button type="submit" class="btn btn-danger btn-lg">
                        <i class="fa-solid fa-trash me-2"></i>确认删除
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
</c:if>

<style>
.char-counter {
    font-size: 0.8rem;
    color: var(--bs-secondary);
    font-weight: 500;
}
.char-counter.warning { color: var(--bs-warning); }
.char-counter.danger { color: var(--bs-danger); }

.form-control:focus, .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.form-control.is-valid {
    border-color: var(--bs-success);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.form-control.is-invalid {
    border-color: var(--bs-danger);
}

.input-group-text {
    background-color: var(--bs-light);
    border-color: var(--bs-border-color);
}

[data-theme="dark"] .input-group-text {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--bs-body-color);
}

[data-theme="dark"] .modal-header.bg-danger {
    background-color: var(--bs-danger) !important;
}
</style>

<script>
(function() {
    'use strict';

    const form = document.getElementById('memberForm');
    const nameInput = document.getElementById('name');
    const idCardInput = document.getElementById('idCard');
    const phoneInput = document.getElementById('phone');
    const positionInput = document.getElementById('position');
    const responsibilitiesInput = document.getElementById('responsibilities');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const submitIcon = document.getElementById('submitIcon');
    const isActiveMemberCheckbox = document.getElementById('isActiveMember');
    const leaveTimeInput = document.getElementById('leaveTime');
    const leaveTimeContainer = document.getElementById('leaveTimeContainer');

    // ==================== 字符计数器 ====================
    function updateCounter(input, counterId, max) {
        const counter = document.getElementById(counterId);
        if (!counter) return;
        const count = input.value.length;
        counter.textContent = count;

        const wrapper = counter.parentElement;
        wrapper.classList.remove('warning', 'danger');
        if (count > max * 0.9) {
            wrapper.classList.add('danger');
        } else if (count > max * 0.7) {
            wrapper.classList.add('warning');
        }
    }

    nameInput.addEventListener('input', function() {
        updateCounter(this, 'nameCount', 50);
    });

    positionInput.addEventListener('input', function() {
        updateCounter(this, 'positionCount', 50);
    });

    responsibilitiesInput.addEventListener('input', function() {
        updateCounter(this, 'responsibilitiesCount', 255);
    });

    // 初始化计数
    updateCounter(nameInput, 'nameCount', 50);
    updateCounter(positionInput, 'positionCount', 50);
    updateCounter(responsibilitiesInput, 'responsibilitiesCount', 255);

    // ==================== 在职状态切换 ====================
    function toggleLeaveTimeField() {
        if (isActiveMemberCheckbox.checked) {
            leaveTimeContainer.style.display = 'none';
            leaveTimeInput.disabled = true;
            leaveTimeInput.value = '';
        } else {
            leaveTimeContainer.style.display = 'block';
            leaveTimeInput.disabled = false;
        }
    }

    isActiveMemberCheckbox.addEventListener('change', toggleLeaveTimeField);

    // ==================== 验证函数 ====================
    function setInvalid(input, message) {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
        const feedback = input.parentElement.querySelector('.invalid-feedback')
                        || input.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback') && message) {
            feedback.textContent = message;
        }
    }

    function setValid(input) {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }

    function clearState(input) {
        input.classList.remove('is-invalid', 'is-valid');
    }

    // ==================== 身份证校验 ====================
    function validateIdCard(idCard) {
        if (!idCard || idCard.length === 0) return { valid: false, message: '身份证号不能为空' };

        if (!/^\d{17}[\dXx]$/.test(idCard)) {
            return { valid: false, message: '身份证号必须是18位数字（最后一位可为X）' };
        }

        // 校验码验证
        const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
        const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
        let sum = 0;
        for (let i = 0; i < 17; i++) {
            sum += parseInt(idCard.charAt(i)) * weights[i];
        }
        const checkCode = checkCodes[sum % 11];
        if (idCard.charAt(17).toUpperCase() !== checkCode) {
            return { valid: false, message: '身份证号校验码不正确' };
        }

        // 简单的出生日期验证
        const year = parseInt(idCard.substring(6, 10));
        const month = parseInt(idCard.substring(10, 12));
        const day = parseInt(idCard.substring(12, 14));
        const birthDate = new Date(year, month - 1, day);
        if (birthDate.getFullYear() !== year ||
            birthDate.getMonth() !== month - 1 ||
            birthDate.getDate() !== day) {
            return { valid: false, message: '身份证号中的出生日期无效' };
        }

        return { valid: true };
    }

    // ==================== 电话校验 ====================
    function validatePhone(phone) {
        if (!phone || phone.length === 0) return { valid: false, message: '联系电话不能为空' };

        // 手机号：11位数字，以1开头
        const mobilePattern = /^1[3-9]\d{9}$/;
        // 座机号：区号-号码
        const landlinePattern = /^0\d{2,3}-?\d{7,8}$/;

        if (mobilePattern.test(phone) || landlinePattern.test(phone)) {
            return { valid: true };
        }
        return { valid: false, message: '请输入有效的手机号或座机号' };
    }

    // ==================== 输入验证 ====================
    nameInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0) {
            setInvalid(this, '姓名不能为空');
        } else if (val.length > 50) {
            setInvalid(this, '姓名不能超过50个字符');
        } else {
            setValid(this);
        }
    });

    nameInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    positionInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0) {
            setInvalid(this, '职务不能为空');
        } else if (val.length > 50) {
            setInvalid(this, '职务不能超过50个字符');
        } else {
            setValid(this);
        }
    });

    positionInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    idCardInput.addEventListener('blur', function() {
        const result = validateIdCard(this.value.trim());
        if (!result.valid) {
            setInvalid(this, result.message);
        } else {
            setValid(this);
        }
    });

    idCardInput.addEventListener('input', function() {
        // 自动转换X为大写
        this.value = this.value.toUpperCase();
        if (this.value.length === 18) {
            const result = validateIdCard(this.value);
            if (result.valid) setValid(this);
            else setInvalid(this, result.message);
        } else {
            clearState(this);
        }
    });

    phoneInput.addEventListener('blur', function() {
        const result = validatePhone(this.value.trim());
        if (!result.valid) {
            setInvalid(this, result.message);
        } else {
            setValid(this);
        }
    });

    phoneInput.addEventListener('input', function() {
        clearState(this);
    });

    // ==================== 表单提交 ====================
    form.addEventListener('submit', function(e) {
        let isValid = true;

        // 验证姓名（必填）
        const nameVal = nameInput.value.trim();
        if (nameVal.length === 0 || nameVal.length > 50) {
            setInvalid(nameInput, nameVal.length === 0 ? '姓名不能为空' : '姓名不能超过50个字符');
            isValid = false;
        }

        // 验证职务（必填）
        const positionVal = positionInput.value.trim();
        if (positionVal.length === 0 || positionVal.length > 50) {
            setInvalid(positionInput, positionVal.length === 0 ? '职务不能为空' : '职务不能超过50个字符');
            isValid = false;
        }

        // 验证身份证（必填）
        const idCardResult = validateIdCard(idCardInput.value.trim());
        if (!idCardResult.valid) {
            setInvalid(idCardInput, idCardResult.message);
            isValid = false;
        }

        // 验证电话（必填）
        const phoneResult = validatePhone(phoneInput.value.trim());
        if (!phoneResult.valid) {
            setInvalid(phoneInput, phoneResult.message);
            isValid = false;
        }

        // 验证性别
        const genderSelect = document.getElementById('gender');
        if (!genderSelect.value) {
            setInvalid(genderSelect, '请选择性别');
            isValid = false;
        }

        // 验证任职时间
        const joinTimeInput = document.getElementById('joinTime');
        if (!joinTimeInput.value) {
            setInvalid(joinTimeInput, '请选择任职时间');
            isValid = false;
        }

        // 如果是离职状态，验证离职时间
        if (!isActiveMemberCheckbox.checked && !leaveTimeInput.value) {
            setInvalid(leaveTimeInput, '离职成员必须填写离职时间');
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            const firstError = form.querySelector('.is-invalid');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
            return false;
        }

        submitBtn.disabled = true;
        spinner.classList.remove('d-none');
        submitIcon.classList.add('d-none');
    });

    // ==================== 重置表单 ====================
    form.addEventListener('reset', function() {
        setTimeout(function() {
            form.querySelectorAll('.is-valid, .is-invalid').forEach(function(el) {
                el.classList.remove('is-valid', 'is-invalid');
            });
            updateCounter(nameInput, 'nameCount', 50);
            updateCounter(positionInput, 'positionCount', 50);
            updateCounter(responsibilitiesInput, 'responsibilitiesCount', 255);
            toggleLeaveTimeField();
        }, 10);
    });

    // ==================== 离开提示 ====================
    let formChanged = false;

    form.querySelectorAll('input, textarea, select').forEach(function(el) {
        el.addEventListener('change', function() {
            formChanged = true;
        });
    });

    window.addEventListener('beforeunload', function(e) {
        if (formChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    form.addEventListener('submit', function() {
        formChanged = false;
    });

    form.addEventListener('reset', function() {
        formChanged = false;
    });

})();
</script>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\committee-members\list.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="村委会成员管理 - 网上村委会"/>
<c:set var="activePage" value="committee-members"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">

    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-user-tie me-2"></i>村委会成员管理
                </h1>
                <div class="page-hero-subtitle">管理村委会成员信息，包括添加、编辑和删除</div>
            </div>

            <div class="text-md-end d-flex gap-2 flex-wrap justify-content-md-end">
                <a href="<c:url value='/committee-members/new'/>" class="btn btn-primary btn-lg">
                    <i class="fa-solid fa-user-plus me-2"></i>新增成员
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <!-- 搜索表单 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body">
            <form method="get" action="<c:url value='/committee-members'/>">
                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">搜索</label>
                        <input type="text" name="q" value="${q}"
                               class="form-control"
                               placeholder="姓名 / 职务 / 联系电话">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">每页条数</label>
                        <input type="number" name="size" value="${page.size}"
                               min="1" max="100" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-gradient w-100">
                            <i class="fa-solid fa-magnifying-glass me-2"></i>查询
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 分页信息 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div>
                <i class="fa-solid fa-circle-info me-2 text-primary"></i>
                共 <strong>${page.total}</strong> 条记录，
                当前第 <strong>${page.page}</strong> 页，
                共 <strong>${page.totalPages}</strong> 页
            </div>

            <div class="d-flex gap-2">
                <span class="badge rounded-pill badge-soft">q：${empty q ? '（无）' : q}</span>
                <span class="badge rounded-pill badge-soft">size：${page.size}</span>
            </div>
        </div>
    </div>

    <!-- 数据表格 -->
    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-0">

            <c:if test="${not empty page.items}">
                <div class="table-wrap table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th style="width: 90px;">ID</th>
                            <th style="width: 140px;">姓名</th>
                            <th>职务</th>
                            <th style="width: 160px;">联系电话</th>
                            <th style="width: 140px;">任职时间</th>
                            <th style="width: 100px;">状态</th>
                            <th style="width: 180px;">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <c:forEach var="member" items="${page.items}">
                            <tr>
                                <td class="fw-bold">#${member.id}</td>
                                <td class="fw-bold">${member.name}</td>
                                <td>${member.position}</td>
                                <td>${member.phone}</td>
                                <td>
                                    <c:choose>
                                        <c:when test="${not empty member.joinTime}">
                                            <fmt:formatDate value="${member.joinTime}" pattern="yyyy-MM-dd"/>
                                        </c:when>
                                        <c:otherwise>-</c:otherwise>
                                    </c:choose>
                                </td>
                                <td>
                                    <c:if test="${member.isActiveMember}">
                                        <span class="badge bg-success">在职</span>
                                    </c:if>
                                    <c:if test="${!member.isActiveMember}">
                                        <span class="badge bg-secondary">离职</span>
                                    </c:if>
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <a href="<c:url value='/committee-members/${member.id}'/>"
                                           class="btn btn-sm btn-outline-info" title="查看详情">
                                            <i class="fa-solid fa-eye"></i>
                                        </a>
                                        <a href="<c:url value='/committee-members/${member.id}/edit'/>"
                                           class="btn btn-sm btn-outline-primary" title="编辑">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </a>
                                        <form action="<c:url value='/committee-members/${member.id}/delete'/>"
                                              method="post" style="display:inline;"
                                              onsubmit="return confirm('确定要删除成员 ${member.name} 吗？');">
                                            <input type="hidden" name="_csrf" value="${_csrf}"/>
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="删除">
                                                <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        </c:forEach>
                        </tbody>
                    </table>
                </div>

                <!-- 分页导航 -->
                <c:if test="${page.totalPages > 1}">
                    <%@ include file="../common/pagination.jsp" %>
                </c:if>
            </c:if>

            <c:if test="${empty page.items}">
                <div class="empty-state">
                    <i class="fa-solid fa-user-tie"></i>
                    <div class="mt-2">暂无村委会成员数据</div>
                </div>
            </c:if>

        </div>
    </div>

</div>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\flash.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:if test="${not empty flash}">
    <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert" data-animate="fade-up">
        <i class="fa-solid fa-circle-check me-2"></i>${flash}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</c:if>




--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\footer.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<!-- 页脚 -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <h5 class="mb-3">
                    <i class="fas fa-landmark me-2"></i>网上村委会
                </h5>
                <p class="text-light mb-2">为村民提供便捷、高效的在线服务，推进乡村治理现代化。</p>
                <div class="mt-3 footer-social">
                    <!-- 微信 -->
                    <div class="social-icon-wrapper">
                        <a href="javascript:void(0)" class="social-icon-btn" 
                           data-contact="weixin" title="微信二维码">
                            <i class="fa-brands fa-weixin fa-lg"></i>
                        </a>
                        <div class="qr-popup-box">
                            <img src="<c:url value='/static/css/img/WeiXin.jpg'/>" alt="微信二维码" />
                            <span class="qr-tip">微信扫码添加</span>
                        </div>
                    </div>
                    <!-- QQ -->
                    <div class="social-icon-wrapper">
                        <a href="javascript:void(0)" class="social-icon-btn"
                           data-contact="qq" title="QQ二维码">
                            <i class="fa-brands fa-qq fa-lg"></i>
                        </a>
                        <div class="qr-popup-box">
                            <img src="<c:url value='/static/css/img/QQ.jpg'/>" alt="QQ二维码" />
                            <span class="qr-tip">QQ扫码添加</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <h6 class="text-uppercase text-light mb-3">快速链接</h6>
                        <ul class="list-unstyled footer-links">
                            <li><a href="<c:url value='/'/>">首页</a></li>
                            <li><a href="<c:url value='/residents'/>">村民管理</a></li>
                            <li><a href="<c:url value='/announcements'/>">公告管理</a></li>
                            <li><a href="<c:url value='/logs'/>">操作日志</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6 mb-4">
                        <h6 class="text-uppercase text-light mb-3">联系信息</h6>
                        <ul class="list-unstyled footer-links">
                            <li><i class="fa-solid fa-location-dot me-2"></i>中国 · 天津静海</li>
                            <li><i class="fa-solid fa-envelope me-2"></i>3062949899@qq.com</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom text-center mt-4 pt-3">
            <span>© <script>document.write(new Date().getFullYear())</script> 网上村委会 · 作者：于翔堃</span>
        </div>
    </div>
</footer>

<!-- 二维码Modal（移动端点击使用） -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="qrModalTitle">联系我们</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
            </div>
            <div class="modal-body text-center pb-4">
                <img id="qrModalImg" class="qr-modal-img" src="" alt="二维码" />
                <p class="mt-3 mb-0 text-muted" id="qrModalHint">扫码添加好友</p>
            </div>
        </div>
    </div>
</div>

<!-- 返回顶部按钮 -->
<button type="button" class="back-to-top" id="backToTop" aria-label="Back to top">
    <i class="fa-solid fa-arrow-up"></i>
</button>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- 全站自定义 JS -->
<script src="<c:url value='/static/js/main.js?v=20251221_01'/>"></script>

</body>
</html>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\header.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>
<!DOCTYPE html>
<html lang="zh-CN" data-theme="light" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">

    <script>
        // 主题初始化：尽可能早设置，避免闪烁
        (function () {
            try {
                var saved = localStorage.getItem('yxk-theme');
                var theme = saved ? saved : ((window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light');
                document.documentElement.setAttribute('data-theme', theme);
                document.documentElement.setAttribute('data-bs-theme', theme);
            } catch (e) { /* ignore */ }
        })();
    </script>

    <title>
        <c:out value="${empty pageTitle ? '网上村委会业务办理系统' : pageTitle}"/>
    </title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">

    <!-- 全站自定义主题 -->
    <link href="<c:url value='/static/css/main.css?v=20251221_01'/>" rel="stylesheet">
    <!-- 暗色模式补丁 -->
    <link href="<c:url value='/static/css/dark-fix.css?v=20251221_01'/>" rel="stylesheet">

    <script>
        window.__CTX = '${pageContext.request.contextPath}';
    </script>
</head>
<body>
<c:set var="_active" value="${empty activePage ? '' : activePage}" />

<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="<c:url value="/"/>">
            <i class="fas fa-landmark me-2"></i>网上村委会
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-lg-center">
                <li class="nav-item">
                    <a class="nav-link ${_active == 'home' ? 'active' : ''}" href="<c:url value="/"/>">
                        <i class="fas fa-home me-1"></i>首页
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == 'announcements' ? 'active' : ''}" href="<c:url value="/announcements"/>">
                        <i class="fas fa-bullhorn me-1"></i>公告
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == 'residents' ? 'active' : ''}" href="<c:url value="/residents"/>">
                        <i class="fas fa-users me-1"></i>村民管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "committee-members" ? "active" : ""}" href="<c:url value="/committee-members"/>">
                        <i class="fas fa-user-tie me-1"></i>村委会成员
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "logs" ? "active" : ""}" href="<c:url value="/logs"/>">
                        <i class="fas fa-clipboard-list me-1"></i>操作日志
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "dashboard" ? "active" : ""}" href="<c:url value="/system/dashboard"/>">
                        <i class="fas fa-gauge-high me-1"></i>系统监控
                    </a>
                </li>

                <li class="nav-item ms-lg-3 mt-2 mt-lg-0">
                    <button type="button" id="themeToggle" class="btn btn-sm btn-outline-light">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\navbar.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="_active" value="${empty activePage ? '' : activePage}" />

<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="<c:url value="/"/>">
            <i class="fas fa-landmark me-2"></i>网上村委会
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-lg-center">
                <li class="nav-item">
                    <a class="nav-link ${_active == 'home' ? 'active' : ''}" href="<c:url value="/"/>">
                        <i class="fas fa-home me-1"></i>首页
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == 'announcements' ? 'active' : ''}" href="<c:url value="/announcements"/>">
                        <i class="fas fa-bullhorn me-1"></i>公告
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == 'residents' ? 'active' : ''}" href="<c:url value="/residents"/>">
                        <i class="fas fa-users me-1"></i>村民管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "committee-members" ? "active" : ""}" href="<c:url value="/committee-members"/>">
                        <i class="fas fa-user-tie me-1"></i>村委会成员
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "logs" ? "active" : ""}" href="<c:url value="/logs"/>">
                        <i class="fas fa-clipboard-list me-1"></i>操作日志
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ${_active == "dashboard" ? "active" : ""}" href="<c:url value="/system/dashboard"/>">
                        <i class="fas fa-gauge-high me-1"></i>系统监控
                    </a>
                </li>

                <li class="nav-item ms-lg-3 mt-2 mt-lg-0">
                    <button type="button" id="themeToggle" class="btn btn-sm btn-outline-light">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\pagination.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:if test="${page.totalPages > 1}">
    <c:set var="current" value="${page.page}"/>
    <c:set var="totalPages" value="${page.totalPages}"/>
    <c:set var="start" value="${current - 2}"/>
    <c:set var="end" value="${current + 2}"/>

    <c:if test="${start < 1}">
        <c:set var="start" value="1"/>
    </c:if>
    <c:if test="${end > totalPages}">
        <c:set var="end" value="${totalPages}"/>
    </c:if>

    <nav class="p-3" aria-label="分页导航">
        <ul class="pagination justify-content-center mb-0">

            <c:if test="${page.hasPrev}">
                <li class="page-item">
                    <a class="page-link" href="?page=${page.page - 1}&size=${page.size}">
                        <i class="fa-solid fa-chevron-left"></i>
                    </a>
                </li>
            </c:if>

            <!-- 首页 -->
            <c:if test="${start > 1}">
                <li class="page-item">
                    <a class="page-link" href="?page=1&size=${page.size}">1</a>
                </li>
                <c:if test="${start > 2}">
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                </c:if>
            </c:if>

            <!-- 窗口 -->
            <c:forEach begin="${start}" end="${end}" var="i">
                <li class="page-item ${page.page == i ? 'active' : ''}">
                    <a class="page-link" href="?page=${i}&size=${page.size}">${i}</a>
                </li>
            </c:forEach>

            <!-- 末页 -->
            <c:if test="${end < totalPages}">
                <c:if test="${end < totalPages - 1}">
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                </c:if>
                <li class="page-item">
                    <a class="page-link" href="?page=${totalPages}&size=${page.size}">
                        ${totalPages}
                    </a>
                </li>
            </c:if>

            <c:if test="${page.hasNext}">
                <li class="page-item">
                    <a class="page-link" href="?page=${page.page + 1}&size=${page.size}">
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </li>
            </c:if>
        </ul>
    </nav>
</c:if>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\common\taglibs.jsp
--------------------------------------------------------------------------------

<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\logs\detail.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="日志详情 - 网上村委会"/>
<c:set var="activePage" value="logs"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-clipboard-list me-2"></i>日志详情
                </h1>
                <div class="page-hero-subtitle">操作日志 #${log.id}</div>
            </div>

            <div class="text-md-end">
                <a href="<c:url value='/logs'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
            </div>
        </div>
    </div>

    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-4 p-md-5">
            <div class="row g-4">
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">操作人</h6>
                    <p class="fs-5 fw-bold">${log.operator}</p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">操作类型</h6>
                    <p>
                        <span class="badge fs-6
                            <c:choose>
                                <c:when test="${log.operationType == 'CREATE'}">bg-success</c:when>
                                <c:when test="${log.operationType == 'UPDATE'}">bg-primary</c:when>
                                <c:when test="${log.operationType == 'DELETE'}">bg-danger</c:when>
                                <c:otherwise>bg-info</c:otherwise>
                            </c:choose>
                        ">${log.operationType}</span>
                    </p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">目标类型</h6>
                    <p class="fs-5">${log.targetType}</p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">目标ID</h6>
                    <p class="fs-5">${log.targetId}</p>
                </div>
                <div class="col-12">
                    <h6 class="text-muted mb-1">描述</h6>
                    <p class="fs-5">${log.description}</p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">IP地址</h6>
                    <p><code>${log.ipAddress}</code></p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-1">操作时间</h6>
                    <p>
                        <c:choose>
                            <c:when test="${not empty log.createdAt}">
                                ${fn:substring(fn:replace(log.createdAt, 'T', ' '), 0, 19)}
                            </c:when>
                            <c:otherwise>-</c:otherwise>
                        </c:choose>
                    </p>
                </div>
                <div class="col-12">
                    <h6 class="text-muted mb-1">User-Agent</h6>
                    <p class="text-break small text-muted">${log.userAgent}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<%@ include file="../common/footer.jsp" %>



--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\logs\list.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="操作日志 - 网上村委会"/>
<c:set var="activePage" value="logs"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">

    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-clipboard-list me-2"></i>操作日志
                </h1>
                <div class="page-hero-subtitle">查看系统所有操作记录</div>
            </div>

            <div class="text-md-end">
                <a href="<c:url value='/'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回首页
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <!-- 搜索表单 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body">
            <form method="get" action="<c:url value='/logs'/>">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label fw-bold">关键词搜索</label>
                        <input type="text" name="q" value="${q}"
                               class="form-control"
                               placeholder="操作人 / 描述">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-bold">操作类型</label>
                        <select name="operationType" class="form-select">
                            <option value="">全部</option>
                            <c:forEach var="type" items="${operationTypes}">
                                <option value="${type}" ${operationType == type ? 'selected' : ''}>${type}</option>
                            </c:forEach>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-bold">目标类型</label>
                        <select name="targetType" class="form-select">
                            <option value="">全部</option>
                            <c:forEach var="type" items="${targetTypes}">
                                <option value="${type}" ${targetType == type ? 'selected' : ''}>${type}</option>
                            </c:forEach>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-bold">每页条数</label>
                        <input type="number" name="size" value="${page.size}"
                               min="1" max="100" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-gradient w-100">
                            <i class="fa-solid fa-magnifying-glass me-2"></i>查询
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 分页信息 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div>
                <i class="fa-solid fa-circle-info me-2 text-primary"></i>
                共 <strong>${page.total}</strong> 条记录，
                当前第 <strong>${page.page}</strong> 页，
                共 <strong>${page.totalPages}</strong> 页
            </div>

            <div class="d-flex gap-2">
                <c:if test="${not empty q}">
                    <span class="badge rounded-pill badge-soft">关键词：${q}</span>
                </c:if>
                <c:if test="${not empty operationType}">
                    <span class="badge rounded-pill badge-soft">操作：${operationType}</span>
                </c:if>
                <c:if test="${not empty targetType}">
                    <span class="badge rounded-pill badge-soft">目标：${targetType}</span>
                </c:if>
            </div>
        </div>
    </div>

    <!-- 数据表格 -->
    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-0">

            <c:if test="${not empty page.items}">
                <div class="table-wrap table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th style="width: 80px;">ID</th>
                            <th style="width: 100px;">操作人</th>
                            <th style="width: 100px;">操作类型</th>
                            <th style="width: 100px;">目标类型</th>
                            <th style="width: 80px;">目标ID</th>
                            <th>描述</th>
                            <th style="width: 130px;">IP地址</th>
                            <th style="width: 160px;">操作时间</th>
                        </tr>
                        </thead>
                        <tbody>
                        <c:forEach var="log" items="${page.items}">
                            <tr>
                                <td class="fw-bold">#${log.id}</td>
                                <td>
                                    <span class="badge bg-secondary">${log.operator}</span>
                                </td>
                                <td>
                                    <span class="badge 
                                        <c:choose>
                                            <c:when test="${log.operationType == 'CREATE'}">bg-success</c:when>
                                            <c:when test="${log.operationType == 'UPDATE'}">bg-primary</c:when>
                                            <c:when test="${log.operationType == 'DELETE'}">bg-danger</c:when>
                                            <c:otherwise>bg-info</c:otherwise>
                                        </c:choose>
                                    ">${log.operationType}</span>
                                </td>
                                <td>
                                    <span class="badge bg-outline-secondary border">${log.targetType}</span>
                                </td>
                                <td>${log.targetId}</td>
                                <td>
                                    <span class="text-truncate d-inline-block" style="max-width: 300px;" 
                                          title="${log.description}">
                                        ${log.description}
                                    </span>
                                </td>
                                <td>
                                    <code class="small">${log.ipAddress}</code>
                                </td>
                                <td>
                                    <c:choose>
                                        <c:when test="${not empty log.createdAt}">
                                            ${fn:substring(fn:replace(log.createdAt, 'T', ' '), 0, 19)}
                                        </c:when>
                                        <c:otherwise>-</c:otherwise>
                                    </c:choose>
                                </td>
                            </tr>
                        </c:forEach>
                        </tbody>
                    </table>
                </div>

                <!-- 分页导航 -->
                <c:if test="${page.totalPages > 1}">
                    <c:set var="current" value="${page.page}"/>
                    <c:set var="totalPages" value="${page.totalPages}"/>
                    <c:set var="start" value="${current - 2}"/>
                    <c:set var="end" value="${current + 2}"/>

                    <c:if test="${start < 1}">
                        <c:set var="start" value="1"/>
                    </c:if>
                    <c:if test="${end > totalPages}">
                        <c:set var="end" value="${totalPages}"/>
                    </c:if>

                    <nav class="p-3" aria-label="日志分页">
                        <ul class="pagination justify-content-center mb-0">

                            <c:if test="${page.hasPrev}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=${page.page - 1}&size=${page.size}&q=${q}&operationType=${operationType}&targetType=${targetType}">
                                        <i class="fa-solid fa-chevron-left"></i>
                                    </a>
                                </li>
                            </c:if>

                            <!-- 首页 -->
                            <c:if test="${start > 1}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=1&size=${page.size}&q=${q}&operationType=${operationType}&targetType=${targetType}">1</a>
                                </li>
                                <c:if test="${start > 2}">
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                </c:if>
                            </c:if>

                            <!-- 窗口 -->
                            <c:forEach begin="${start}" end="${end}" var="i">
                                <li class="page-item ${page.page == i ? 'active' : ''}">
                                    <a class="page-link" href="?page=${i}&size=${page.size}&q=${q}&operationType=${operationType}&targetType=${targetType}">${i}</a>
                                </li>
                            </c:forEach>

                            <!-- 末页 -->
                            <c:if test="${end < totalPages}">
                                <c:if test="${end < totalPages - 1}">
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                </c:if>
                                <li class="page-item">
                                    <a class="page-link" href="?page=${totalPages}&size=${page.size}&q=${q}&operationType=${operationType}&targetType=${targetType}">
                                        ${totalPages}
                                    </a>
                                </li>
                            </c:if>

                            <c:if test="${page.hasNext}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=${page.page + 1}&size=${page.size}&q=${q}&operationType=${operationType}&targetType=${targetType}">
                                        <i class="fa-solid fa-chevron-right"></i>
                                    </a>
                                </li>
                            </c:if>
                        </ul>
                    </nav>
                </c:if>
            </c:if>

            <c:if test="${empty page.items}">
                <div class="empty-state">
                    <i class="fa-solid fa-clipboard-list"></i>
                    <div class="mt-2">暂无操作日志</div>
                </div>
            </c:if>

        </div>
    </div>

</div>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\residents\form.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

<c:set var="pageTitle" value="${mode == 'edit' ? '编辑村民' : '新增村民'} - 网上村委会"/>
<c:set var="activePage" value="residents"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <!-- Hero区域 -->
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-user-plus me-2"></i>${mode == 'edit' ? '编辑村民信息' : '新增村民'}
                </h1>
                <div class="page-hero-subtitle">
                    ${mode == 'edit' ? '修改村民的基本信息' : '录入新村民的基本信息'}
                </div>
            </div>
            <div class="text-md-end">
                <a href="<c:url value='/residents'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i>返回列表
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <div class="row">
        <!-- 表单卡片 -->
        <div class="col-lg-8" data-animate="fade-up">
            <div class="card soft">
                <div class="card-body p-4 p-md-5">
                    <form id="residentForm" method="post"
                          action="${pageContext.request.contextPath}/residents${mode == 'edit' ? '/' += resident.id : ''}"
                          novalidate>

                        <%-- CSRF Token --%>
                        <input type="hidden" name="_csrf" value="${_csrf}"/>

                        <%-- 姓名 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="name">
                                <i class="fa-solid fa-user me-2 text-primary"></i>姓名 
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control form-control-lg" id="name" name="name"
                                   value="${resident.name}" required maxlength="50"
                                   placeholder="请输入村民姓名">
                            <div class="invalid-feedback">请输入有效的姓名（1-50个字符）</div>
                            <div class="form-text d-flex justify-content-between">
                                <span>请输入真实姓名</span>
                                <span class="char-counter"><span id="nameCount">0</span>/50</span>
                            </div>
                        </div>

                        <%-- 身份证号 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="idCard">
                                <i class="fa-solid fa-id-card me-2 text-primary"></i>身份证号
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">
                                    <i class="fa-solid fa-fingerprint"></i>
                                </span>
                                <input type="text" class="form-control" id="idCard" name="idCard"
                                       value="${resident.idCard}" maxlength="18"
                                       placeholder="18位身份证号码（选填）">
                            </div>
                            <div class="invalid-feedback" id="idCardError">身份证号格式不正确</div>
                            <div class="form-text">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                18位有效身份证号码，系统将自动校验
                            </div>
                        </div>

                        <%-- 电话 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="phone">
                                <i class="fa-solid fa-phone me-2 text-primary"></i>联系电话
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">
                                    <i class="fa-solid fa-mobile-screen"></i>
                                </span>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                       value="${resident.phone}" maxlength="20"
                                       placeholder="手机号或座机号（选填）">
                            </div>
                            <div class="invalid-feedback" id="phoneError">电话号码格式不正确</div>
                            <div class="form-text">
                                <i class="fa-solid fa-circle-info me-1"></i>
                                支持11位手机号或座机号（如 010-12345678）
                            </div>
                        </div>

                        <%-- 地址 --%>
                        <div class="mb-4">
                            <label class="form-label fw-bold" for="address">
                                <i class="fa-solid fa-location-dot me-2 text-primary"></i>住址
                            </label>
                            <textarea class="form-control" id="address" name="address"
                                      rows="3" maxlength="255"
                                      placeholder="详细住址（选填）">${resident.address}</textarea>
                            <div class="form-text d-flex justify-content-between">
                                <span>请填写详细地址，便于联系</span>
                                <span class="char-counter"><span id="addressCount">0</span>/255</span>
                            </div>
                        </div>

                        <hr class="my-4">

                        <%-- 操作按钮 --%>
                        <div class="d-flex flex-wrap gap-3 justify-content-between align-items-center">
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-gradient btn-lg" id="submitBtn">
                                    <span class="spinner-border spinner-border-sm d-none me-2" id="spinner"></span>
                                    <i class="fa-solid fa-check me-2" id="submitIcon"></i>
                                    ${mode == 'edit' ? '保存修改' : '确认新增'}
                                </button>
                                <button type="reset" class="btn btn-outline-secondary btn-lg">
                                    <i class="fa-solid fa-rotate-left me-2"></i>重置
                                </button>
                            </div>
                            <a href="${pageContext.request.contextPath}/residents" class="btn btn-light btn-lg">
                                <i class="fa-solid fa-xmark me-2"></i>取消
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 右侧提示面板 -->
        <div class="col-lg-4 mt-4 mt-lg-0" data-animate="fade-up" data-delay="100">
            <!-- 填写说明 -->
            <div class="card soft mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-circle-info me-2"></i>填写说明
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-3 d-flex">
                            <span class="badge bg-danger rounded-pill me-2" style="height: fit-content;">必填</span>
                            <div>
                                <strong>姓名</strong><br>
                                <small class="text-muted">村民的真实姓名，最多50个字符</small>
                            </div>
                        </li>
                        <li class="mb-3 d-flex">
                            <span class="badge bg-secondary rounded-pill me-2" style="height: fit-content;">选填</span>
                            <div>
                                <strong>身份证号</strong><br>
                                <small class="text-muted">18位有效身份证，系统自动校验格式及校验码</small>
                            </div>
                        </li>
                        <li class="mb-3 d-flex">
                            <span class="badge bg-secondary rounded-pill me-2" style="height: fit-content;">选填</span>
                            <div>
                                <strong>联系电话</strong><br>
                                <small class="text-muted">手机号或座机号，便于日常联系</small>
                            </div>
                        </li>
                        <li class="d-flex">
                            <span class="badge bg-secondary rounded-pill me-2" style="height: fit-content;">选填</span>
                            <div>
                                <strong>住址</strong><br>
                                <small class="text-muted">详细的居住地址</small>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 数据安全提示 -->
            <div class="alert alert-warning border-0 shadow-sm">
                <h6 class="alert-heading mb-2">
                    <i class="fa-solid fa-shield-halved me-2"></i>数据安全提示
                </h6>
                <p class="mb-0 small">
                    村民信息属于敏感数据，请确保信息准确性，系统将对数据进行加密存储和访问控制。
                </p>
            </div>

            <!-- 快速操作 -->
            <div class="card soft">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fa-solid fa-bolt me-2"></i>快速操作
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="${pageContext.request.contextPath}/residents" class="btn btn-outline-primary">
                            <i class="fa-solid fa-list me-2"></i>查看村民列表
                        </a>
                        <c:if test="${mode == 'edit'}">
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                <i class="fa-solid fa-trash me-2"></i>删除此村民
                            </button>
                        </c:if>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%-- 删除确认模态框（仅编辑模式） --%>
<c:if test="${mode == 'edit'}">
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i>确认删除
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center p-4">
                <div class="mb-3">
                    <i class="fa-solid fa-user-xmark fa-4x text-danger"></i>
                </div>
                <h5>确定要删除村民 "${resident.name}" 吗？</h5>
                <p class="text-muted mb-0">此操作不可恢复，请谨慎操作。</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark me-2"></i>取消
                </button>
                <form action="${pageContext.request.contextPath}/residents/${resident.id}/delete" method="post" class="d-inline">
                    <input type="hidden" name="_csrf" value="${_csrf}"/>
                    <button type="submit" class="btn btn-danger btn-lg">
                        <i class="fa-solid fa-trash me-2"></i>确认删除
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
</c:if>

<style>
.char-counter {
    font-size: 0.8rem;
    color: var(--bs-secondary);
    font-weight: 500;
}
.char-counter.warning { color: var(--bs-warning); }
.char-counter.danger { color: var(--bs-danger); }

.form-control:focus, .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.form-control.is-valid {
    border-color: var(--bs-success);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.form-control.is-invalid {
    border-color: var(--bs-danger);
}

.input-group-text {
    background-color: var(--bs-light);
    border-color: var(--bs-border-color);
}

[data-theme="dark"] .input-group-text {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--bs-body-color);
}

[data-theme="dark"] .modal-header.bg-danger {
    background-color: var(--bs-danger) !important;
}
</style>

<script>
(function() {
    'use strict';

    const form = document.getElementById('residentForm');
    const nameInput = document.getElementById('name');
    const idCardInput = document.getElementById('idCard');
    const phoneInput = document.getElementById('phone');
    const addressInput = document.getElementById('address');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const submitIcon = document.getElementById('submitIcon');

    // ==================== 字符计数器 ====================
    function updateCounter(input, counterId, max) {
        const counter = document.getElementById(counterId);
        if (!counter) return;
        const count = input.value.length;
        counter.textContent = count;

        const wrapper = counter.parentElement;
        wrapper.classList.remove('warning', 'danger');
        if (count > max * 0.9) {
            wrapper.classList.add('danger');
        } else if (count > max * 0.7) {
            wrapper.classList.add('warning');
        }
    }

    nameInput.addEventListener('input', function() {
        updateCounter(this, 'nameCount', 50);
    });

    addressInput.addEventListener('input', function() {
        updateCounter(this, 'addressCount', 255);
    });

    // 初始化计数
    updateCounter(nameInput, 'nameCount', 50);
    updateCounter(addressInput, 'addressCount', 255);

    // ==================== 验证函数 ====================
    function setInvalid(input, message) {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
        const feedback = input.parentElement.querySelector('.invalid-feedback') 
                        || input.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback') && message) {
            feedback.textContent = message;
        }
    }

    function setValid(input) {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }

    function clearState(input) {
        input.classList.remove('is-invalid', 'is-valid');
    }

    // ==================== 身份证校验 ====================
    function validateIdCard(idCard) {
        if (!idCard || idCard.length === 0) return { valid: true }; // 选填，为空则有效

        if (!/^\d{17}[\dXx]$/.test(idCard)) {
            return { valid: false, message: '身份证号必须是18位数字（最后一位可为X）' };
        }

        // 校验码验证
        const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
        const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
        let sum = 0;
        for (let i = 0; i < 17; i++) {
            sum += parseInt(idCard.charAt(i)) * weights[i];
        }
        const checkCode = checkCodes[sum % 11];
        if (idCard.charAt(17).toUpperCase() !== checkCode) {
            return { valid: false, message: '身份证号校验码不正确' };
        }

        // 简单的出生日期验证
        const year = parseInt(idCard.substring(6, 10));
        const month = parseInt(idCard.substring(10, 12));
        const day = parseInt(idCard.substring(12, 14));
        const birthDate = new Date(year, month - 1, day);
        if (birthDate.getFullYear() !== year || 
            birthDate.getMonth() !== month - 1 || 
            birthDate.getDate() !== day) {
            return { valid: false, message: '身份证号中的出生日期无效' };
        }

        return { valid: true };
    }

    // ==================== 电话校验 ====================
    function validatePhone(phone) {
        if (!phone || phone.length === 0) return { valid: true }; // 选填

        // 手机号：11位数字，以1开头
        const mobilePattern = /^1[3-9]\d{9}$/;
        // 座机号：区号-号码
        const landlinePattern = /^0\d{2,3}-?\d{7,8}$/;

        if (mobilePattern.test(phone) || landlinePattern.test(phone)) {
            return { valid: true };
        }
        return { valid: false, message: '请输入有效的手机号或座机号' };
    }

    // ==================== 输入验证 ====================
    nameInput.addEventListener('blur', function() {
        const val = this.value.trim();
        if (val.length === 0) {
            setInvalid(this, '姓名不能为空');
        } else if (val.length > 50) {
            setInvalid(this, '姓名不能超过50个字符');
        } else {
            setValid(this);
        }
    });

    nameInput.addEventListener('input', function() {
        if (this.value.trim().length > 0) clearState(this);
    });

    idCardInput.addEventListener('blur', function() {
        const result = validateIdCard(this.value.trim());
        if (!result.valid) {
            setInvalid(this, result.message);
        } else if (this.value.trim().length > 0) {
            setValid(this);
        } else {
            clearState(this);
        }
    });

    idCardInput.addEventListener('input', function() {
        // 自动转换X为大写
        this.value = this.value.toUpperCase();
        if (this.value.length === 18) {
            const result = validateIdCard(this.value);
            if (result.valid) setValid(this);
            else setInvalid(this, result.message);
        } else {
            clearState(this);
        }
    });

    phoneInput.addEventListener('blur', function() {
        const result = validatePhone(this.value.trim());
        if (!result.valid) {
            setInvalid(this, result.message);
        } else if (this.value.trim().length > 0) {
            setValid(this);
        } else {
            clearState(this);
        }
    });

    phoneInput.addEventListener('input', function() {
        clearState(this);
    });

    // ==================== 表单提交 ====================
    form.addEventListener('submit', function(e) {
        let isValid = true;

        // 验证姓名（必填）
        const nameVal = nameInput.value.trim();
        if (nameVal.length === 0 || nameVal.length > 50) {
            setInvalid(nameInput, nameVal.length === 0 ? '姓名不能为空' : '姓名不能超过50个字符');
            isValid = false;
        }

        // 验证身份证（选填但格式需正确）
        const idCardResult = validateIdCard(idCardInput.value.trim());
        if (!idCardResult.valid) {
            setInvalid(idCardInput, idCardResult.message);
            isValid = false;
        }

        // 验证电话（选填但格式需正确）
        const phoneResult = validatePhone(phoneInput.value.trim());
        if (!phoneResult.valid) {
            setInvalid(phoneInput, phoneResult.message);
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            const firstError = form.querySelector('.is-invalid');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
            return false;
        }

        submitBtn.disabled = true;
        spinner.classList.remove('d-none');
        submitIcon.classList.add('d-none');
    });

    // ==================== 重置表单 ====================
    form.addEventListener('reset', function() {
        setTimeout(function() {
            form.querySelectorAll('.is-valid, .is-invalid').forEach(function(el) {
                el.classList.remove('is-valid', 'is-invalid');
            });
            updateCounter(nameInput, 'nameCount', 50);
            updateCounter(addressInput, 'addressCount', 255);
        }, 10);
    });

    // ==================== 离开提示 ====================
    let formChanged = false;

    form.querySelectorAll('input, textarea').forEach(function(el) {
        el.addEventListener('change', function() {
            formChanged = true;
        });
    });

    window.addEventListener('beforeunload', function(e) {
        if (formChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    form.addEventListener('submit', function() {
        formChanged = false;
    });

    form.addEventListener('reset', function() {
        formChanged = false;
    });

})();
</script>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\residents\list.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:set var="pageTitle" value="村民信息管理 - 网上村委会"/>
<c:set var="activePage" value="residents"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">

    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-users me-2"></i>村民信息管理
                </h1>
                <div class="page-hero-subtitle">搜索、分页、编辑、导出一站式管理</div>
            </div>

            <div class="text-md-end d-flex gap-2 flex-wrap justify-content-md-end">
                <a href="<c:url value='/residents/new'/>" class="btn btn-light btn-lg">
                    <i class="fa-solid fa-user-plus me-2"></i>新增村民
                </a>

                <c:url var="exportUrl" value="/residents/export.csv">
                    <c:param name="q" value="${q}"/>
                </c:url>
                <a href="${exportUrl}" class="btn btn-outline-success btn-lg">
                    <i class="fa-solid fa-download me-2"></i>导出 CSV
                </a>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <!-- 搜索表单 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body">
            <form method="get" action="<c:url value='/residents'/>">
                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">搜索</label>
                        <input type="text" name="q" value="${q}"
                               class="form-control"
                               placeholder="姓名 / 身份证 / 电话 / 地址">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">每页条数</label>
                        <input type="number" name="size" value="${page.size}"
                               min="1" max="100" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-gradient w-100">
                            <i class="fa-solid fa-magnifying-glass me-2"></i>查询
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 分页信息 -->
    <div class="card soft mb-4" data-animate="fade-up">
        <div class="card-body d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div>
                <i class="fa-solid fa-circle-info me-2 text-primary"></i>
                共 <strong>${page.total}</strong> 条记录，
                当前第 <strong>${page.page}</strong> 页，
                共 <strong>${page.totalPages}</strong> 页
            </div>

            <div class="d-flex gap-2">
                <span class="badge rounded-pill badge-soft">q：${empty q ? '（无）' : q}</span>
                <span class="badge rounded-pill badge-soft">size：${page.size}</span>
            </div>
        </div>
    </div>

    <!-- 数据表格 -->
    <div class="card soft" data-animate="fade-up">
        <div class="card-body p-0">

            <c:if test="${not empty page.items}">
                <div class="table-wrap table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th style="width: 90px;">ID</th>
                            <th style="width: 140px;">姓名</th>
                            <th>身份证号</th>
                            <th style="width: 160px;">电话</th>
                            <th>地址</th>
                            <th style="width: 180px;">创建时间</th>
                            <th style="width: 160px;">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <c:forEach var="r" items="${page.items}">
                            <tr>
                                <td class="fw-bold">#${r.id}</td>
                                <td class="fw-bold">${r.name}</td>
                                <td>${r.idCard}</td>
                                <td>${r.phone}</td>
                                <td>${r.address}</td>
                                <td>
                                    <c:choose>
                                        <c:when test="${not empty r.createdAt}">
                                            ${fn:substring(fn:replace(r.createdAt, 'T', ' '), 0, 16)}
                                        </c:when>
                                        <c:otherwise>-</c:otherwise>
                                    </c:choose>
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <a href="<c:url value='/residents/${r.id}/edit'/>"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </a>

                                        <form action="<c:url value='/residents/${r.id}/delete'/>"
                                              method="post" style="display:inline;"
                                              onsubmit="return confirm('确定要删除村民 ${r.name} 吗？');">
                                            <input type="hidden" name="_csrf" value="${_csrf}"/>
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        </c:forEach>
                        </tbody>
                    </table>
                </div>

                <!-- 分页导航（窗口化渲染） -->
                <c:if test="${page.totalPages > 1}">
                    <c:set var="current" value="${page.page}"/>
                    <c:set var="totalPages" value="${page.totalPages}"/>
                    <c:set var="start" value="${current - 2}"/>
                    <c:set var="end" value="${current + 2}"/>

                    <c:if test="${start < 1}">
                        <c:set var="start" value="1"/>
                    </c:if>
                    <c:if test="${end > totalPages}">
                        <c:set var="end" value="${totalPages}"/>
                    </c:if>

                    <nav class="p-3" aria-label="村民分页">
                        <ul class="pagination justify-content-center mb-0">

                            <c:if test="${page.hasPrev}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=${page.page - 1}&size=${page.size}&q=${q}">
                                        <i class="fa-solid fa-chevron-left"></i>
                                    </a>
                                </li>
                            </c:if>

                            <!-- 首页 -->
                            <c:if test="${start > 1}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=1&size=${page.size}&q=${q}">1</a>
                                </li>
                                <c:if test="${start > 2}">
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                </c:if>
                            </c:if>

                            <!-- 窗口 -->
                            <c:forEach begin="${start}" end="${end}" var="i">
                                <li class="page-item ${page.page == i ? 'active' : ''}">
                                    <a class="page-link" href="?page=${i}&size=${page.size}&q=${q}">${i}</a>
                                </li>
                            </c:forEach>

                            <!-- 末页 -->
                            <c:if test="${end < totalPages}">
                                <c:if test="${end < totalPages - 1}">
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                </c:if>
                                <li class="page-item">
                                    <a class="page-link" href="?page=${totalPages}&size=${page.size}&q=${q}">
                                        ${totalPages}
                                    </a>
                                </li>
                            </c:if>

                            <c:if test="${page.hasNext}">
                                <li class="page-item">
                                    <a class="page-link" href="?page=${page.page + 1}&size=${page.size}&q=${q}">
                                        <i class="fa-solid fa-chevron-right"></i>
                                    </a>
                                </li>
                            </c:if>
                        </ul>
                    </nav>
                </c:if>
            </c:if>

            <c:if test="${empty page.items}">
                <div class="empty-state">
                    <i class="fa-solid fa-users"></i>
                    <div class="mt-2">暂无村民数据</div>
                </div>
            </c:if>

        </div>
    </div>

</div>

<%@ include file="../common/footer.jsp" %>


--------------------------------------------------------------------------------
文件路径: src\main\webapp\WEB-INF\views\system\dashboard.jsp
--------------------------------------------------------------------------------

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<c:set var="pageTitle" value="系统监控 - 网上村委会"/>
<c:set var="activePage" value="dashboard"/>

<%@ include file="../common/header.jsp" %>

<div class="container py-4">
    <div class="page-hero mb-4" data-animate="fade-up">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
            <div>
                <h1 class="page-hero-title">
                    <i class="fa-solid fa-gauge-high me-2"></i>系统监控
                </h1>
                <div class="page-hero-subtitle">系统状态与性能监控</div>
            </div>

            <div class="text-md-end">
                <button class="btn btn-light btn-lg" onclick="refreshDashboard()">
                    <i class="fa-solid fa-arrows-rotate me-2"></i>刷新数据
                </button>
            </div>
        </div>
    </div>

    <%@ include file="../common/flash.jsp" %>

    <!-- 系统状态卡片 -->
    <div class="row g-4 mb-5">
        <!-- 数据库状态 -->
        <div class="col-lg-6" data-animate="fade-up" data-delay="100">
            <div class="card soft h-100">
                <div class="card-header bg-gradient-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-database me-2"></i>数据库状态
                    </h3>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="status-indicator me-3" id="dbStatusIndicator">
                            <div class="status-pulse"></div>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">数据库连接</h5>
                            <p class="text-muted mb-0" id="dbStatusText">检查中...</p>
                        </div>
                        <div class="text-end">
                            <button class="btn btn-sm btn-outline-primary" onclick="checkDbStatus()">
                                <i class="fa-solid fa-plug me-1"></i>检查连接
                            </button>
                        </div>
                    </div>

                    <div class="info-box bg-light rounded p-3 mb-3">
                        <div class="d-flex justify-content-between">
                            <span>上次检查时间</span>
                            <span id="lastCheckTime">未检查</span>
                        </div>
                    </div>

                    <div class="info-box bg-light rounded p-3">
                        <div class="d-flex justify-content-between">
                            <span>连接状态</span>
                            <span id="connectionStatus">未知</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 系统信息 -->
        <div class="col-lg-6" data-animate="fade-up" data-delay="200">
            <div class="card soft h-100">
                <div class="card-header bg-gradient-info text-white">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-server me-2"></i>系统信息
                    </h3>
                </div>
                <div class="card-body">
                    <div class="info-item">
                        <div class="info-label">应用名称</div>
                        <div class="info-value">网上村委会业务办理系统</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">版本</div>
                        <div class="info-value">v1.0.0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">服务器时间</div>
                        <div class="info-value" id="serverTime">获取中...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">运行环境</div>
                        <div class="info-value">Java Spring Boot</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统活动图表 -->
    <div class="row g-4">
        <div class="col-lg-8" data-animate="fade-up" data-delay="100">
            <div class="card soft h-100">
                <div class="card-header bg-gradient-success text-white">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-chart-line me-2"></i>系统活动
                    </h3>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <ul class="nav nav-pills nav-pills-sm" id="activityTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="operations-tab" data-bs-toggle="tab" data-bs-target="#operations" type="button" role="tab">
                                    操作统计
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                                    用户活动
                                </button>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content" id="activityTabsContent">
                        <div class="tab-pane fade show active" id="operations" role="tabpanel">
                            <div class="chart-container" style="position: relative; height:300px;">
                                <canvas id="operationsChart"></canvas>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="users" role="tabpanel">
                            <div class="chart-container" style="position: relative; height:300px;">
                                <canvas id="usersChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 快速操作 -->
        <div class="col-lg-4" data-animate="fade-up" data-delay="200">
            <div class="card soft h-100">
                <div class="card-header bg-gradient-warning text-white">
                    <h3 class="card-title mb-0">
                        <i class="fa-solid fa-bolt me-2"></i>快速操作
                    </h3>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="${pageContext.request.contextPath}/announcements" class="btn btn-outline-primary">
                            <i class="fa-solid fa-bullhorn me-2"></i>管理公告
                        </a>
                        <a href="${pageContext.request.contextPath}/residents" class="btn btn-outline-primary">
                            <i class="fa-solid fa-users me-2"></i>管理村民
                        </a>
                        <a href="${pageContext.request.contextPath}/committee-members" class="btn btn-outline-primary">
                            <i class="fa-solid fa-user-tie me-2"></i>管理成员
                        </a>
                        <a href="${pageContext.request.contextPath}/logs" class="btn btn-outline-primary">
                            <i class="fa-solid fa-clipboard-list me-2"></i>查看日志
                        </a>
                        <button class="btn btn-outline-danger" onclick="clearCache()">
                            <i class="fa-solid fa-trash me-2"></i>清除缓存
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%@ include file="../common/footer.jsp" %>

<style>
/* 状态指示器样式 */
.status-indicator {
    width: 40px;
    height: 40px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.status-pulse {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: var(--text-light);
    position: relative;
}

.status-pulse::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: inherit;
    animation: pulse 2s infinite;
}

.status-indicator.online .status-pulse {
    background-color: #10b981;
}

.status-indicator.offline .status-pulse {
    background-color: #ef4444;
    animation: none;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.5);
        opacity: 0.5;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* 信息项样式 */
.info-item {
    margin-bottom: 1.5rem;
}

.info-label {
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-value {
    font-size: 1.1rem;
    font-weight: 500;
}

/* 标签页样式 */
.nav-pills-sm .nav-link {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // 初始化页面
    document.addEventListener('DOMContentLoaded', function() {
        updateServerTime();
        checkDbStatus();
        initCharts();

        // 每分钟更新服务器时间
        setInterval(updateServerTime, 60000);
    });

    // 更新服务器时间
    function updateServerTime() {
        const now = new Date();
        document.getElementById('serverTime').textContent = now.toLocaleString('zh-CN');
    }

    // 检查数据库状态
    function checkDbStatus() {
        const indicator = document.getElementById('dbStatusIndicator');
        const statusText = document.getElementById('dbStatusText');
        const lastCheckTime = document.getElementById('lastCheckTime');
        const connectionStatus = document.getElementById('connectionStatus');

        // 显示检查中状态
        indicator.className = 'status-indicator checking';
        statusText.textContent = '检查中...';

        fetch('${pageContext.request.contextPath}/db/ping')
            .then(response => response.text())
            .then(data => {
                // 检查成功
                indicator.className = 'status-indicator online';
                statusText.textContent = '数据库连接正常';
                connectionStatus.textContent = '已连接';
                connectionStatus.className = 'text-success';

                // 更新最后检查时间
                const now = new Date();
                lastCheckTime.textContent = now.toLocaleTimeString('zh-CN');
            })
            .catch(error => {
                // 检查失败
                indicator.className = 'status-indicator offline';
                statusText.textContent = '数据库连接失败';
                connectionStatus.textContent = '连接失败';
                connectionStatus.className = 'text-danger';

                // 更新最后检查时间
                const now = new Date();
                lastCheckTime.textContent = now.toLocaleTimeString('zh-CN');

                console.error('数据库检查失败:', error);
            });
    }

    // 刷新仪表盘
    function refreshDashboard() {
        updateServerTime();
        checkDbStatus();
        updateCharts();

        // 显示刷新提示
        const toast = document.createElement('div');
        toast.className = 'position-fixed bottom-0 end-0 p-3';
        toast.style.zIndex = '11';
        toast.innerHTML = `
            <div class="toast show" role="alert">
                <div class="toast-header">
                    <i class="fa-solid fa-check-circle text-success me-2"></i>
                    <strong class="me-auto">系统提示</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    仪表盘数据已刷新
                </div>
            </div>
        `;
        document.body.appendChild(toast);

        // 3秒后自动移除提示
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 3000);
    }

    // 清除缓存
    function clearCache() {
        if (confirm('确定要清除系统缓存吗？')) {
            // 这里可以添加实际的清除缓存逻辑
            const toast = document.createElement('div');
            toast.className = 'position-fixed bottom-0 end-0 p-3';
            toast.style.zIndex = '11';
            toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-header">
                        <i class="fa-solid fa-check-circle text-success me-2"></i>
                        <strong class="me-auto">系统提示</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        缓存已清除
                    </div>
                </div>
            `;
            document.body.appendChild(toast);

            // 3秒后自动移除提示
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }
    }

    // 初始化图表
    let operationsChart, usersChart;

    function initCharts() {
        // 操作统计图表
        const operationsCtx = document.getElementById('operationsChart').getContext('2d');
        operationsChart = new Chart(operationsCtx, {
            type: 'line',
            data: {
                labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                datasets: [{
                    label: '新增操作',
                    data: [12, 19, 8, 15, 22, 18, 25],
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.3
                }, {
                    label: '更新操作',
                    data: [15, 12, 18, 14, 20, 22, 16],
                    borderColor: 'rgb(255, 205, 86)',
                    backgroundColor: 'rgba(255, 205, 86, 0.2)',
                    tension: 0.3
                }, {
                    label: '删除操作',
                    data: [3, 5, 2, 4, 3, 6, 4],
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: '本周操作统计'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // 用户活动图表
        const usersCtx = document.getElementById('usersChart').getContext('2d');
        usersChart = new Chart(usersCtx, {
            type: 'doughnut',
            data: {
                labels: ['公告管理', '村民管理', '成员管理', '其他操作'],
                datasets: [{
                    data: [30, 45, 15, 10],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(240, 147, 251, 0.8)',
                        'rgba(245, 87, 108, 0.8)'
                    ],
                    borderColor: [
                        'rgb(102, 126, 234)',
                        'rgb(118, 75, 162)',
                        'rgb(240, 147, 251)',
                        'rgb(245, 87, 108)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    title: {
                        display: true,
                        text: '功能模块使用比例'
                    }
                }
            }
        });
    }

    // 更新图表数据
    function updateCharts() {
        // 这里可以添加从服务器获取最新数据的逻辑
        // 然后更新图表
        console.log('更新图表数据');
    }
</script>


